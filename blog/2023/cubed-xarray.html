<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Cubed: Bounded-memory serverless array processing in xarray - Welcome</title><meta property="og:title" content="Cubed: Bounded-memory serverless array processing in xarray - Welcome"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><meta name="image" content="/build/e35ec725ea00fd2a6250d35dd849930e.png"/><meta property="og:image" content="/build/e35ec725ea00fd2a6250d35dd849930e.png"/><link rel="stylesheet" href="/build/_assets/app-HG4THSM4.css"/><link rel="stylesheet" href="/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Tom Nicholas</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"><div class="relative inline-block mx-2 grow-0"><a class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" href="/about">About</a></div><div class="relative inline-block mx-2 grow-0"><a aria-current="page" class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 border-b border-stone-200" href="/blog">Blog</a></div></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3iop:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode." aria-label="Toggle theme between light and dark mode."><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white"><a class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded" href="/about">About</a><a aria-current="page" class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded active" href="/blog">Blog</a></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="Welcome" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/">Welcome</a><a title="About me" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/about">About me</a><div data-state="open" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Blog" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 active" href="/blog">Blog</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rfd8p:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:Rfd8p:" class="pl-3 pr-[2px] collapsible-content"><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2025" class="block break-words rounded py-2 grow cursor-pointer">2025</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R6vd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R6vd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2024" class="block break-words rounded py-2 grow cursor-pointer">2024</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Ravd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Ravd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="open" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2023" class="block break-words rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 cursor-pointer">2023</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Revd8p:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:Revd8p:" class="pl-3 pr-[2px] collapsible-content"><a title="Cubed: Bounded-memory serverless array processing in xarray" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg bg-blue-300/30 active" href="/blog/2023/cubed-xarray">Cubed: Bounded-memory serverless array processing in xarray</a><a title="Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/blog/2023/dask-distributed">Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration</a></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2022" class="block break-words rounded py-2 grow cursor-pointer">2022</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rivd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rivd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2020" class="block break-words rounded py-2 grow cursor-pointer">2020</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmvd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmvd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2019" class="block break-words rounded py-2 grow cursor-pointer">2019</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rqvd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rqvd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://github.com/TomNicholas/tomnicholas.github.io" title="GitHub Repository: TomNicholas/tomnicholas.github.io" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rd4fop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Cubed: Bounded-memory serverless array processing in xarray</h1><header class="mt-4 not-prose"><div><span class="font-semibold text-sm inline-block"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3kfop:" data-state="closed">Tom Nicholas</button><a class="ml-1" href="https://orcid.org/0000-0002-2176-0530" target="_blank" rel="noopener noreferrer" title="ORCID (Open Researcher and Contributor ID)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1rem" height="1rem" class="inline-block text-gray-400 hover:text-[#A9C751] -translate-y-[0.1em]"><path d="M21.8 12c0 5.4-4.4 9.8-9.8 9.8S2.2 17.4 2.2 12 6.6 2.2 12 2.2s9.8 4.4 9.8 9.8zM8.2 5.8c-.4 0-.8.3-.8.8s.3.8.8.8.8-.4.8-.8-.3-.8-.8-.8zm2.3 9.6h1.2v-6h1.8c2.3 0 3.3 1.4 3.3 3s-1.5 3-3.3 3h-3v1.1H9V8.3H7.7v8.2h5.9c3.3 0 4.5-2.2 4.5-4.1s-1.2-4.1-4.3-4.1h-3.2l-.1 7.1z"></path></svg></a></span></div></header><div class="flex mt-2 text-sm font-light"><time dateTime="2023-06-01" class="">June 1, 2023</time></div></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><p>_TLDR: Xarray can now wrap a range of parallel computation backends, including <a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed" class="">Cubed</a>, a distributed serverless framework designed to limit memory usage.</p><h2 id="introduction" class="relative group"><span class="heading-text">Introduction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introduction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>One of Xarray’s most powerful features is parallel computing on larger-than-memory datasets through its <a target="_blank" rel="noreferrer" href="https://docs.xarray.dev/en/stable/user-guide/dask.html" class="">integration with Dask</a>.
We love Dask - it’s an incredibly powerful tool, a big part of Xarray’s appeal, and central to the scalability of the <a target="_blank" rel="noreferrer" href="https://pangeo.io/architecture.html" class="">Pangeo stack</a>.</p><p>However, the vision of seamlessly processing any array workload at arbitrary scale is <em>incredibly</em> challenging, and its good to explore alternative implementations that might complement Dask’s approach.</p><p><a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed" class="">Cubed</a> is one such alternative - a serverless framework for array processing developed by Tom White.
Tom comes to the Xarray community via working on the statistical genetics toolkit, <a target="_blank" rel="noreferrer" href="https://github.com/pystatgen/sgkit" class="">sgkit</a>, and brings with him <a target="_blank" rel="noreferrer" href="http://www.hadoopbook.com/" class="">considerable experience</a> with distributed systems.
We will discuss how Cubed works, what its novel design can offer, and demo using it on a realistic problem.</p><p>We will also explain how Xarray has been <a href="https://github.com/pydata/xarray/pull/7019" class="italic" target="_blank" rel="noreferrer" data-state="closed">generalized to support wrapping Cubed</a>, opening the door to yet more alternative implementations of chunked parallel array computing in Xarray.</p><h2 id="the-challenge-of-managing-memory-usage" class="relative group"><span class="heading-text">The challenge of managing memory usage</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#the-challenge-of-managing-memory-usage" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Managing RAM usage in big computations is very hard.
In the wider world there are many different frameworks for performing distributed computations, but most of them can’t make strict guarantees about limiting memory usage.
In practice this means that configuring workers or adjusting details of the computation plan to avoid accidentally exceeding memory limits is often the bottleneck for getting real-world computations to run successfully.</p><p>The Dask developers have been making great progress on this problem, releasing big <a target="_blank" rel="noreferrer" href="https://medium.com/pangeo/dask-distributed-and-pangeo-better-performance-for-everyone-thanks-to-science-software-63f85310a36b" class="">changes to the distributed scheduler</a>, and recently a new approach to <a target="_blank" rel="noreferrer" href="https://blog.coiled.io/blog/shuffling-large-data-at-constant-memory" class="">rechunking using a P2P algorithm</a>.</p><p>We’ve been working on a different approach: <a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed" class="">Cubed</a>’s framework is specifically designed from the ground up to avoid this memory problem.</p><h2 id="what-is-cubed" class="relative group"><span class="heading-text">What is Cubed?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#what-is-cubed" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Cubed is a library for processing N-dimensional distributed arrays using a bounded-memory serverless model.
What does that mean?
Let’s take these terms one at a time:</p><p><strong>N-dimensional arrays</strong></p><p>Cubed provides a <code>cubed.Array</code> class which <a target="_blank" rel="noreferrer" href="https://tom-e-white.com/cubed/array_api.html" class="">implements</a> the <a target="_blank" rel="noreferrer" href="https://data-apis.org/array-api/latest/" class="">Python Array API Standard</a>.
Like <code>numpy</code>/<code>cupy</code>/<code>dask</code> arrays etc., Cubed arrays understand basic N-dimensional operations such as indexing, aggregations, and linear algebra.
Note that Cubed does <em>not</em> understand data structures other than arrays, for example DataFrames.</p><p><strong>Distributed</strong></p><p>Cubed Arrays are divided into chunks, allowing the work of processing your dataset to be split up and distributed across many machines.</p><p>As well as exposing a <code>.chunks</code> attribute in exactly the same way as Dask, cubed provides functions for applying chunk-aware operations such as <code>map_blocks</code>, <code>blockwise</code>, and <code>apply_gufunc</code>.
Cubed owes another huge debt to Dask here for developing and exposing these useful abstractions.</p><p><strong>Bounded-memory</strong></p><p>Cubed aims to perform operations without exceeding a pre-set bound on the total RAM usage of the computation.
By building all common chunked array operations out of basic operations with known memory requirements, Cubed guarantees that the entire computation executes in a series of bounded-memory steps.</p><p>Cubed implements all chunked array operations in terms of just two “primitive operations”: <a target="_blank" rel="noreferrer" href="https://tom-e-white.com/cubed/operations.html#blockwise" class="">blockwise</a> and <a target="_blank" rel="noreferrer" href="https://tom-e-white.com/cubed/operations.html#rechunk" class="">rechunk</a>.
Blockwise applies an in-memory function across multiple blocks of multiple inputs, and can be used to express a range of tensor operations.
Rechunk simply changes the chunking pattern of an array without altering its shape.</p><img id="INwnqJ19Vx" style="margin:0 auto" src="/build/e35ec725ea00fd2a6250d35dd849930e.png" data-canonical-url="https://hackmd.io/_uploads/S1ci7nXI2.png"/><p>FIGURE: Dependency tree for chunked array operations within Cubed, <a target="_blank" rel="noreferrer" href="https://tom-e-white.com/cubed/operations.html#dependency-tree" class="">from cubed’s documentation</a>.
Notice that all array API operations (white) can be implemented for chunked arrays in terms of “core ops” (orange) and eventually just two “primitive ops” - blockwise and rechunk.</p><p>Both blockwise and rechunk can be performed using algorithms which only require loading one chunk from each input array into memory at any time.
In the case of rechunk the <a target="_blank" rel="noreferrer" href="https://rechunker.readthedocs.io/en/latest/algorithm.html" class="">algorithm comes from the Pangeo Rechunker package</a>, whose model was a direct inspiration for Cubed.
As each chunk is of known size, the RAM usage for processing each chunk can be reliably estimated in advance.</p><p>Therefore the expected RAM usage of any Cubed computation can be projected in advance, and compared against the known system resources available (specified via the <a target="_blank" rel="noreferrer" href="https://tom-e-white.com/cubed/generated/cubed.Spec.html#cubed.Spec" class=""><code>cubed.Spec</code></a> object).</p><p><strong>Serverless</strong></p><p><a target="_blank" rel="noreferrer" href="https://www.cloudflare.com/en-gb/learning/serverless/what-is-serverless/" class="">Serverless computing</a> is a model in which some service runs a users tasks for them on an on-demand basis, allowing the user to avoid worrying about the details of how in fact their tasks are being run on real servers somewhere.</p><p>Cubed breaks down every array operation into a set of independent tasks, each of which reads one chunk from cloud storage and operates on it. These tasks are a good fit for a serverless cloud computing model.</p><p>However, unlike on a cluster the serverless functions cannot communicate with each other directly over the network.
Cubed instead writes an intermediate result to persistent storage between each array operation, saving a history of steps via Zarr.
This approach is a generalisation of the way Rechunker’s algorithm writes and reads data to an intermediate Zarr store as it executes.
(Cubed actually implements some optimizations to avoid writing every intermediate array to disk, but <a href="https://github.com/tomwhite/cubed/issues/136" class="italic" target="_blank" rel="noreferrer" data-state="closed">more are possible</a>.)</p><p>The benefit of serverless for analytics jobs is that instead of the user creating, managing, and shutting down a cluster manually (which lives either locally or on one or more remote servers), they simply specify the tasks they want performed and hand those tasks off to some paid-for serverless cloud computing service, such as Google Cloud Functions or AWS Lambda.
The tradeoff is that this approach is much more I/O intensive, and serverless nodes are generally more expensive than cluster nodes.</p><p>Cubed interfaces with a range of serverless cloud services and uses them to execute the chunk-level operations required to process the whole array.
This also provides chunk-level parallelism - all the tasks for creating one array are embarrasingly parallel so can be run simultaneously.
In other words, if your Cubed operation is writing its result to a Zarr store with 1000 chunks, Cubed will compute that step with 1000 parallel processes simultaneously by default.</p><img id="Cj1u2dBJgj" style="margin:0 auto" src="/build/38104a5b3b7bf2e45b4bdcea86a517d7.png" data-canonical-url="https://hackmd.io/_uploads/rJMd7-VLh.png"/><p>FIGURE: There are a large number of commercial cloud services which offer serverless computing services.
All of the services pictured here are supported by the <a target="_blank" rel="noreferrer" href="https://lithops-cloud.github.io/docs/#use-any-cloud" class="">Lithops</a> framework, which is only one of many tools Cubed can use to execute computations.
So far, using the Lithops executor, <a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed/tree/main/examples" class="">Cubed has been tested</a> on both AWS Lambda and Google Cloud Functions.
(It has also been run on <a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed/tree/main/examples/modal" class="">AWS using Modal</a> and <a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed/tree/main/examples/dataflow" class="">Dataflow using the Beam executor</a>.)</p><h2 id="sounds-cool-how-do-i-try-it" class="relative group"><span class="heading-text">Sounds cool, how do I try it?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#sounds-cool-how-do-i-try-it" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>You can try using Cubed arrays directly or you can use them seamlessly through Xarray, in the same way you use Dask.</p><p>First <code>conda install -c conda-forge cubed-xarray</code>, which will install Cubed, the latest version of Xarray (v2023.5.0), and the glue package <a target="_blank" rel="noreferrer" href="https://github.com/xarray-contrib/cubed-xarray" class=""><code>cubed-xarray</code></a>.</p><p>To run Cubed in serverless mode you need to <a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed/tree/main/examples#which-cloud-service-should-i-use" class="">set up integration with a cloud service</a>.
Alternatively you can just run Cubed locally, but you won’t see many of the benefits (local execution is the default if you don’t specify an <code>executor</code> below).</p><p>Before creating a Cubed array you need a <code>Spec</code>, which tells Cubed (a) how much RAM you think a process should need to compute any one chunk, and (b) where to store all the temporary files it will create as it executes.
This location can be a local directory or a cloud bucket.</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from cubed import Spec

spec = Spec(work_dir=&#x27;tmp&#x27;, allowed_mem=&#x27;1GB&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Now you can create a cubed-backed Xarray object in the same way you would create a dask-backed one:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ds = open_dataset(
    &#x27;data.zarr&#x27;, 
    chunked_array_type=&#x27;cubed&#x27;,
    from_array_kwargs={&#x27;spec&#x27;: spec})
    chunks={},
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>The only difference is the addition of the new <code>chunked_array_type</code> kwarg (which defaults to <code>&#x27;dask&#x27;</code>), and the new <code>from_array_kwargs</code> dict, which allows passing arbitrary kwargs down to the constructor that creates the underlying chunked array.
The <code>chunks</code> kwarg plays exactly the same role as it does when creating Dask arrays. (This also works with the <code>.chunk</code> methods on <code>Dataset</code>/<code>DataArray</code>, using the same keyword arguments.)</p><p>Now you specify your analysis using normal Xarray code, right up until you need to compute the result.
In a similar way to how Dask’s <code>.compute</code> method accepts a <code>scheduler</code> argument, Cubed’s <code>.compute</code> accepts an <code>executor</code> argument.
You need to specify which executor to use by importing it, and configuration options for the cloud service would also be passed at this point.</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from cubed.runtime.executors.lithops import LithopsDagExecutor

ds.compute(executor=LithopsDagExecutor())</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="how-does-this-integration-work" class="relative group"><span class="heading-text">How does this integration work?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#how-does-this-integration-work" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Xarray has been coupled to Dask <a target="_blank" rel="noreferrer" href="http://stephanhoyer.com/2015/06/11/xray-dask-out-of-core-labeled-arrays/" class="">since</a> <a href="https://github.com/pydata/xarray/issues/328" class="italic" target="_blank" rel="noreferrer" data-state="closed">2015</a>. How did we generalize it?</p><p>Much of the integration works immediately because Cubed implements the <a target="_blank" rel="noreferrer" href="https://data-apis.org/array-api/latest/" class="">Python Array API Standard</a>, and Xarray can <a target="_blank" rel="noreferrer" href="https://docs.xarray.dev/en/stable/roadmap.html#flexible-arrays" class="">wrap any numpy-like array</a> (see the blog post on <a target="_blank" rel="noreferrer" href="https://xarray.dev/blog/introducing-pint-xarray" class="">wrapping <code>pint.Quantity</code> arrays</a>).</p><p>Chunked arrays implement additional attributes (e.g. <code>.chunks</code>) and methods (e.g. <code>.rechunk</code>), but also require special functions (e.g. <code>blockwise</code>, <code>map_blocks</code>) for mapping in-memory numpy functions over different chunks.
These key functions are useful abstractions invented within Dask, and <a target="_blank" rel="noreferrer" href="https://tom-e-white.com/cubed/operations.html" class="">Cubed implements its own versions</a> of each of them.</p><p>Chunked array implementations specify how to dispatch computations to the correct implementation of these functions by subclassing a new <code>ChunkManagerEntrypoint</code> base class.
Any array library implementing an array-like API and defining chunk-aware functions can hook in.
Using entrypoints means the possible backends can be automatically discovered, which is why we don’t need to explicitly import anything from the <code>cubed-xarray</code> package.</p><h2 id="demo-the-quadratic-means-problem" class="relative group"><span class="heading-text">Demo: The “Quadratic Means” problem</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#demo-the-quadratic-means-problem" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>(<a target="_blank" rel="noreferrer" href="https://gist.github.com/TomNicholas/c6a28f7c22c6981f75bce280d3e28283" class="">Full notebook here</a>)</p><p>To succinctly demonstrate the relative advantages of Cubed, we’ll choose a workload which is representative of what happens when cluster-based frameworks struggle with memory management.</p><p>The “Quadratic Means” problem is a simplified version of calculating the cross-product mean from the climatological anomalies of two variables.
It requires taking products of two chunked scalar variables <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span></span></span> and <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span> and then aggregating the result along the chunked dimension.
It is a good example of problem that is simple to express, but creates a dask graph complex enough to trigger suboptimal performance of the distributed scheduler.</p><h3 id="dask-results" class="relative group"><span class="heading-text">Dask results</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#dask-results" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><img id="LnAFx7Vhhi" style="margin:0 auto" src="/build/341652a6372b2e2339d98c8b0d90f3be.png" data-canonical-url="https://hackmd.io/_uploads/S1h5o6OO2.png"/><p>FIGURE: Dask’s memory usage for a simplified version of the “quadratic means” workload, at a number of different scales.
Notice the RAM usage increasing proportially with dataset size, until the workers spill to disk for the largest dataset (1.5TB).
If the workload were much larger, or the cluster much smaller, this would have crashed. This was run on 20 16GB RAM workers using Coiled.</p><p>We ran this workload on Coiled, for datasets of increasing size, using the latest version of <code>dask.distributed</code>, both with and without P2P rechunking.
We see that as the problem size increases, the peak memory required by the dask cluster increases too.
Once the peak memory required is larger than the RAM available to the workers, they continue loading data, but spill it to disk (spilled memory not shown in the plot).
If the total memory available is smaller than the dataset size, the cluster will crash (here we used 20 workers to ensure there was enough disk space to complete the 1.5TB workload).</p><p>This type of failure occurs sometimes for real array workloads when using dask, but is a symptom of the general difficulty of memory management when using any cluster-based framework.
(The performance of on this particular case could almost certainly be improved by changes to dask’s distributed scheduler, and indeed <a target="_blank" rel="noreferrer" href="https://medium.com/pangeo/dask-distributed-and-pangeo-better-performance-for-everyone-thanks-to-science-software-63f85310a36b" class=""><code>dask.distributed</code> has gotten hugely better at memory management recently</a>.
Here though we are just using this case as a specific example of a type of failure that is very difficult to solve in general.)</p><h3 id="cubed-results" class="relative group"><span class="heading-text">Cubed results</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#cubed-results" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p><a target="_blank" rel="noreferrer" href="https://gist.github.com/TomNicholas/c6a28f7c22c6981f75bce280d3e28283" class="">Trying this problem with Cubed</a> (using the Lithops executor and Google Cloud Functions), we find that Cubed successfully completed the workload at all scales, including the 1.5TB workload.
Remarkably, it did so using only 1.3GB of RAM per serverless container, staying below the threshold of 2GB we set in the <code>cubed.Spec</code>.</p><p>If we take just the largest version of this workload (1.5TB), we can visualize the relationship between the various types of memory Cubed accounts for over the course of the computation.</p><img id="HygMo8JINp" style="margin:0 auto" src="/build/7869d86d159257fc5b3170da07bf7bc3.png" data-canonical-url="https://hackmd.io/_uploads/rylFHft_n.png"/><p>FIGURE: Cubed’s actual memory usage vs projected memory usage, for the largest workload (1.5TB). Cubed successfully processed 1.5TB of data whilst only using a maximum of 1.3GB of RAM per serverless container, staying well below the given limit of 2GB of RAM.
This was run using Lithops on Google Cloud Functions, which provisioned thousands of serverless containers each with 2048MB of RAM.</p><p>You can see again that the <a target="_blank" rel="noreferrer" href="https://tom-e-white.com/cubed/user-guide/memory.html" class="">projected memory</a> usage is below the allowed memory usage (else Cubed would have raised an exception before the job even started running), and the actual peak memory used was lower still. We’ve also plotted the reserved memory, which is a parameter intended to account for the memory usage of the executor itself (i.e. Lithops here), and was estimated by measuring beforehand using <a target="_blank" rel="noreferrer" href="https://tom-e-white.com/cubed/generated/cubed.measure_reserved_memory.html#cubed.measure_reserved_memory" class=""><code>cubed.measure_reserved_memory()</code></a>.</p><p>One obvious tradeoff for this memory stability is that Cubed took <strong>a lot longer</strong> to complete - roughly 4x longer then dask for the 1.5TB workload (45m 22s vs 11m 26s). We will come back to discuss this shortly.</p><p>Finally it’s interesting to look at Cubed’s equivalent of the task graph. To calculate one array (the product <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>U</mi><mi>V</mi><msub><mo>&gt;</mo><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">&lt;UV&gt;_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel">&gt;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> from the quadratic means problem), Cubed’s “Plan” for processing 1.5TB of data looks like this:</p><img id="ByyA1ix3IA" style="margin:0 auto" src="/build/e90396280f74e96480e285d35ee8ca0f.png" data-canonical-url="https://hackmd.io/_uploads/SJcShLyvn.png"/><p>FIGURE: Cubed <code>Plan</code> (i.e. task graph) for processing 1.5TB of array data.
This graph corresponds to a single xarray variable (<code>UV</code>) in the “quadratic means” workload. Each node corresponds to an intermediate Zarr array that gets written to disk as the computation progresses, separated by either rechunk (rc) or blockwise (bw) steps.
Notice that the number of nodes in the graph is not proportional to the number of chunks in the array.</p><p>The task graph is at the array-level, meaning that it does not grow proportionally to the number of chunks.
The final linear series of steps does get longer with problem scale, but only logarithmically, as it represents the number of steps in a <a target="_blank" rel="noreferrer" href="https://tom-e-white.com/cubed/operations.html#reduction-and-arg-reduction" class="">tree-like reduction</a> necessary to reduce that quantity of data.
(This <code>Plan</code> is somewhat similar to Dask’s <a target="_blank" rel="noreferrer" href="https://docs.dask.org/en/stable/high-level-graphs.html" class="">“High Level Graph”</a>, but array-native, and designed to avoid the problem of over-burdening a scheduler.)</p><h2 id="pros-and-cons-of-cubeds-model" class="relative group"><span class="heading-text">Pros and cons of Cubed’s model</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#pros-and-cons-of-cubeds-model" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Cubed uses a completely different paradigm to Dask (and other frameworks), and so has various advantages and disadvantages. Let’s discuss the obvious disadvantages first.</p><h3 id="disadvantages" class="relative group"><span class="heading-text">Disadvantages</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#disadvantages" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ol start="1"><li><strong>Writing to persistent storage is slow</strong>
In general writing and reading to persistent storage (disk or object store) is slow, and doing it repeatedly even more so.
Whilst there is scope for considerable <a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed/issues?q=is%3Aissue+is%3Aopen+label%3Aoptimization" class="">optimization within Cubed</a>, the model of communicating between processes by writing to disk will likely always be slower for many problems than communicating using RAM like dask does.
One idea for mitigating this might be to use a very fast storage technology like Redis to store intermediate results.</li><li><strong>Spinning up cloud services can be slow</strong>
There is also a time cost to spinning up the containers in which each task is performed, which can vary considerably between cloud services.</li><li><strong>Higher monetary cost</strong>
We estimate that Cubed cost about an order of magnitude more to run than Dask on Coiled did for this 1.5TB workload (order <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mi>v</mi><mi>s</mi><mi>o</mi><mi>r</mi><mi>d</mi><mi>e</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">10 vs order </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">10</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.02778em;">sor</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span></span></span></span></span>1).
Specific numbers and lengthier discussion are given in the <a target="_blank" rel="noreferrer" href="https://gist.github.com/TomNicholas/c6a28f7c22c6981f75bce280d3e28283" class="">accompanying notebook</a>.
This is not very suprising, but the lesson should also be that (like performance) estimating cloud costs is complicated, workload-specific, provider-specific, and contextual.
It is also worth noting that costs for both could be lowered.
Future optimizations to Cubed could reduce the number of intermediate Zarr steps required, and in a serverless paradigm you cannot accidentally be charged for a cluster you leave running idle.
On the other hand <a target="_blank" rel="noreferrer" href="https://blog.coiled.io/blog/dask-graviton.html" class="">Coiled can use ARM chips</a>, as well as <a target="_blank" rel="noreferrer" href="https://www.coiled.io/blog/save-money-with-spot" class="">spot instances</a>, both of which could lower its cost further.</li><li><strong>Still a prototype</strong>
Cubed is still young, and whilst fairly feature-complete it has not been rigorously tested on very large datasets, or on several of the cloud services it could theoretically run on.
There will be bugs, or things which are simply not yet implemented.
The <a target="_blank" rel="noreferrer" href="https://github.com/xarray-contrib/cubed-xarray" class="">cubed-xarray integration</a> is similarly experimental, and any <a href="https://github.com/xarray-contrib/cubed-xarray/blob/main/README.md#sharp-edges-" class="italic" target="_blank" rel="noreferrer" data-state="closed">present incompatibilities</a> will likely cause silent coercion to numpy arrays.
Contributions to Cubed to are welcome!</li><li><strong>Only array processing</strong>
Cubed is far less general than other parallel processing frameworks like Dask, Spark, or Apache Beam.
It only supports array processing, and cannot support other data structures like Dataframes, <a target="_blank" rel="noreferrer" href="https://docs.dask.org/en/stable/custom-collections.html" class="">custom collections</a>, or <a target="_blank" rel="noreferrer" href="https://docs.dask.org/en/stable/custom-graphs.html" class="">arbitrary computation graphs</a>.</li></ol><h3 id="advantages" class="relative group"><span class="heading-text">Advantages</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#advantages" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ol start="1"><li><strong>Bounded-memory</strong>
We’ve already seen how this works, but being able to complete a large-scale job that previously crashed or had to be manually split up would be an extremely useful feature on its own.</li><li><strong>Resumable</strong>
Saving each intermediate result to disk means the progress of the computation is saved even if the cluster goes down or power is lost.
Cubed allows you to resume a stalled computation in a new process to finish a long job.</li><li><strong>No cluster to manage</strong>
A serverless design means that the user does not having to deploy and manage a cluster at all.
Arguably conceptually simpler, this model also means less boilerplate code, no error-prone deployment step, and only paying for computation you actually do, not for the time the cluster is up.</li><li><strong>Horizontal scalability</strong>
Cubed is designed with “<a target="_blank" rel="noreferrer" href="https://www.section.io/blog/scaling-horizontally-vs-vertically/" class="">horizontal scaling</a>” in mind, meaning bringing many machines to bear on the problem at once.
(As opposed to “vertical scaling” - utilizing a bigger machine.)
Zarr can support as many concurrent writes as there are chunks, and the serverless framework should be able to smoothly launch and manage almost any number of parallel workers.
This has yet to be tested at truly massive scale however.
Cubed also avoids another potential scaling bottleneck of having too many individual tasks for a single scheduler process to manage.
The computation is represented as an array-level graph, so the graph size doesn’t scale with the number of chunks, and there is no complex scheduler to over-burden.</li><li><strong>Various runtimes</strong>
Cubed can execute its computation plans using a range of executors, opening up a big space of possibilities.
As well as running locally, Cubed can convert its plans into <a target="_blank" rel="noreferrer" href="https://beam.apache.org/documentation/basics/" class="">Beam Pipelines</a> and run on Google Cloud Dataflow, use <a target="_blank" rel="noreferrer" href="https://lithops-cloud.github.io/docs/#use-any-cloud" class="">Lithops</a> to dispatch to a range of serverless providers, or use the <a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed/tree/main/examples/modal" class="">Modal client</a> to start-up containers in literally a second.
It should even be possible to write a <a href="https://github.com/tomwhite/cubed/issues/161" class="italic" target="_blank" rel="noreferrer" data-state="closed">Dask executor for Cubed</a>, similar to what exists in the Rechunker package.
This might go some way to giving the benefits of Cubed but with lower cost and speed.
One could also imagine <a href="https://github.com/tomwhite/cubed/issues/224" class="italic" target="_blank" rel="noreferrer" data-state="closed">running Cubed on another type of cluster</a>.</li></ol><p>Overall one could think of different parallel array processing libraries as complementary, best-suited to different problems or to running on different systems.</p><h2 id="range-of-options" class="relative group"><span class="heading-text">Range of options</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#range-of-options" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>There is a saying that there are <a target="_blank" rel="noreferrer" href="https://medium.com/machine-words/the-three-numbers-b41009ffa236" class="">only three important numbers in programming</a>: 0, 1, and infinity.
Having gone from 1 to 2 options of parallel backends, can we go to N?</p><p>That is the situation in the database analytics world.
There SQL (Structured Query Language) queries form a common high-level way of expressing user intent, but the actual execution of a query on a database can be performed using a huge range of technologies, known as <a target="_blank" rel="noreferrer" href="https://howqueryengineswork.com/01-what-is-a-query-engine.html" class="">Query Engines</a>.
These projects compete to determine which can get the best performance on <a target="_blank" rel="noreferrer" href="https://howqueryengineswork.com/15-benchmarks.html#transaction-processing-council-tpc-benchmarks" class="">various standardised benchmarks</a>.
In the example above Xarray is playing a similar role to SQL as a high-level query language, allowing users to easily try out different array backends depending on their problem.</p><p>Here we’ve focused on Cubed, but this work opens the door to using other alternative distributed array processing frameworks such as <a target="_blank" rel="noreferrer" href="https://github.com/Python-for-HPC/ramba" class="">Ramba</a>, <a target="_blank" rel="noreferrer" href="https://github.com/Bears-R-Us/arkouda" class="">Arkouda</a>, <a target="_blank" rel="noreferrer" href="https://github.com/aesara-devs/aesara" class="">Aesara</a>, or even others yet to be developed...
We’re discussing this dream in the <a target="_blank" rel="noreferrer" href="https://discourse.pangeo.io/t/new-working-group-for-distributed-array-computing/2734" class="">Pangeo Distributed Arrays Working Group</a>, so if this inspires you then please join us!</p><h2 id="conclusion" class="relative group"><span class="heading-text">Conclusion</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#conclusion" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li>Xarray can now wrap multiple chunked array backends.</li><li>Cubed is a serverless prototype which you can try out today.</li><li>We hope this integration work leads to a range of new parallel backend options for users.</li><li>Please come and help out on the <a target="_blank" rel="noreferrer" href="https://github.com/tomwhite/cubed" class="">Cubed repository</a>, and join the <a target="_blank" rel="noreferrer" href="https://discourse.pangeo.io/t/new-working-group-for-distributed-array-computing/2734" class="">Distributed Arrays Working Group</a>!</li></ul><div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/blog/2024/datatree"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">2024</div>Xarray x NASA: xarray.DataTree for hierarchical data structures</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/blog/2023/dask-distributed"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">2023</div>Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/build/_shared/chunk-IZFMW3M4.js"/><link rel="modulepreload" href="/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/build/_shared/chunk-CPTH56EW.js"/><link rel="modulepreload" href="/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/build/_shared/chunk-S4SWV34C.js"/><link rel="modulepreload" href="/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/build/root-QGLRP2PL.js"/><link rel="modulepreload" href="/build/_shared/chunk-CB3BH7WY.js"/><link rel="modulepreload" href="/build/routes/$-7JYT5576.js"/><script>window.__remixContext = {"url":"/blog/2023/cubed-xarray","state":{"loaderData":{"root":{"config":{"version":1,"myst":"1.3.25","options":{"favicon":"/build/profile-color-circle-ca8fbded50b8385ad3ee7f612833be43.png","logo_text":"Tom Nicholas","folders":true},"nav":[{"title":"About","url":"/about"},{"title":"Blog","url":"/blog"}],"actions":[],"projects":[{"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"title":"Welcome","thumbnail":"/build/profile-color-circle-098ce1dbdd1469313afcdeb609cd4bf4.png","authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","references":{"ttw":{"url":"https://book.the-turing-way.org"}},"toc":[{"file":"index.md"},{"file":"about.md"},{"children":[{"children":[{"pattern":"blog/2025/**{.ipynb,.md}"}],"title":"2025"},{"children":[{"pattern":"blog/2024/**{.ipynb,.md}"}],"title":"2024"},{"children":[{"pattern":"blog/2023/**{.ipynb,.md}"}],"title":"2023"},{"children":[{"pattern":"blog/2022/**{.ipynb,.md}"}],"title":"2022"},{"children":[{"pattern":"blog/2020/**{.ipynb,.md}"}],"title":"2020"},{"children":[{"pattern":"blog/2019/**{.ipynb,.md}"}],"title":"2019"}],"file":"blog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"about","title":"About me","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"blog","title":"Blog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":2,"title":"2025"},{"slug":"blog.2025.science-needs-a-social-network","title":"Science needs a social network for sharing big data","description":"","date":"2025-01-18","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["open-science","frost"],"level":3},{"level":2,"title":"2024"},{"slug":"blog.2024.datatree","title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","description":"","date":"2024-12-19","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science"],"level":3},{"level":2,"title":"2023"},{"slug":"blog.2023.cubed-xarray","title":"Cubed: Bounded-memory serverless array processing in xarray","description":"","date":"2023-06-01","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","dask","cubed","open-science"],"level":3},{"slug":"blog.2023.dask-distributed","title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","description":"","date":"2023-01-04","thumbnail":"/build/f8821db67c2a5f1f07b570e6bed342cc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","dask","open-science"],"level":3},{"level":2,"title":"2022"},{"slug":"blog.2022.easy-ipcc-datatree","title":"Easy IPCC part 1: Multi-Model Datatree","description":"","date":"2022-08-29","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science","climate-science","datatree"],"level":3},{"slug":"blog.2022.pint-xarray","title":"Unit-aware arithmetic in Xarray, via pint","description":"","date":"2022-08-30","thumbnail":"/build/undefined","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","pint","open-science","physical-units"],"level":3},{"level":2,"title":"2020"},{"slug":"blog.2020.covid19-model","title":"Coronavirus: The Simplest Model","description":"","date":"2020-03-20","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","modelling","covid-19"],"level":3},{"slug":"blog.2020.deep-pseudoscience","title":"The faulty science, doomism, and flawed conclusions of Deep Adaptation","description":"","date":"2020-07-14","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate-science","misinformation"],"level":3},{"slug":"blog.2020.oxford-divests","title":"Oxford University Divestment Explained","description":"","date":"2020-04-22","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate","oxford"],"level":3},{"level":2,"title":"2019"},{"slug":"blog.2019.theconversation-fusion","title":"Nuclear Fusion: too late for the climate","description":"","date":"2019-09-30","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["fusion","energy","climate"],"level":3}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static"},"routes/$":{"config":{"version":1,"myst":"1.3.25","options":{"favicon":"/build/profile-color-circle-ca8fbded50b8385ad3ee7f612833be43.png","logo_text":"Tom Nicholas","folders":true},"nav":[{"title":"About","url":"/about"},{"title":"Blog","url":"/blog"}],"actions":[],"projects":[{"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"title":"Welcome","thumbnail":"/build/profile-color-circle-098ce1dbdd1469313afcdeb609cd4bf4.png","authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","references":{"ttw":{"url":"https://book.the-turing-way.org"}},"toc":[{"file":"index.md"},{"file":"about.md"},{"children":[{"children":[{"pattern":"blog/2025/**{.ipynb,.md}"}],"title":"2025"},{"children":[{"pattern":"blog/2024/**{.ipynb,.md}"}],"title":"2024"},{"children":[{"pattern":"blog/2023/**{.ipynb,.md}"}],"title":"2023"},{"children":[{"pattern":"blog/2022/**{.ipynb,.md}"}],"title":"2022"},{"children":[{"pattern":"blog/2020/**{.ipynb,.md}"}],"title":"2020"},{"children":[{"pattern":"blog/2019/**{.ipynb,.md}"}],"title":"2019"}],"file":"blog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"about","title":"About me","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"blog","title":"Blog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":2,"title":"2025"},{"slug":"blog.2025.science-needs-a-social-network","title":"Science needs a social network for sharing big data","description":"","date":"2025-01-18","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["open-science","frost"],"level":3},{"level":2,"title":"2024"},{"slug":"blog.2024.datatree","title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","description":"","date":"2024-12-19","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science"],"level":3},{"level":2,"title":"2023"},{"slug":"blog.2023.cubed-xarray","title":"Cubed: Bounded-memory serverless array processing in xarray","description":"","date":"2023-06-01","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","dask","cubed","open-science"],"level":3},{"slug":"blog.2023.dask-distributed","title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","description":"","date":"2023-01-04","thumbnail":"/build/f8821db67c2a5f1f07b570e6bed342cc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","dask","open-science"],"level":3},{"level":2,"title":"2022"},{"slug":"blog.2022.easy-ipcc-datatree","title":"Easy IPCC part 1: Multi-Model Datatree","description":"","date":"2022-08-29","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science","climate-science","datatree"],"level":3},{"slug":"blog.2022.pint-xarray","title":"Unit-aware arithmetic in Xarray, via pint","description":"","date":"2022-08-30","thumbnail":"/build/undefined","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","pint","open-science","physical-units"],"level":3},{"level":2,"title":"2020"},{"slug":"blog.2020.covid19-model","title":"Coronavirus: The Simplest Model","description":"","date":"2020-03-20","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","modelling","covid-19"],"level":3},{"slug":"blog.2020.deep-pseudoscience","title":"The faulty science, doomism, and flawed conclusions of Deep Adaptation","description":"","date":"2020-07-14","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate-science","misinformation"],"level":3},{"slug":"blog.2020.oxford-divests","title":"Oxford University Divestment Explained","description":"","date":"2020-04-22","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate","oxford"],"level":3},{"level":2,"title":"2019"},{"slug":"blog.2019.theconversation-fusion","title":"Nuclear Fusion: too late for the climate","description":"","date":"2019-09-30","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["fusion","energy","climate"],"level":3}]}]},"page":{"version":1,"kind":"Notebook","sha256":"dfb78e1ad6609dc8616762ec5a47a7acbec603cb198bb07bf1d78fbab7d0dc09","slug":"blog.2023.cubed-xarray","location":"/blog/2023/cubed-xarray.md","dependencies":[],"frontmatter":{"title":"Cubed: Bounded-memory serverless array processing in xarray","tags":["code","python","xarray","dask","cubed","open-science"],"date":"2023-06-01","kernelspec":{"name":"python3","display_name":"Python 3"},"authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"numbering":{"title":{"offset":2}},"edit_url":"https://github.com/TomNicholas/tomnicholas.github.io/blob/main/blog/2023/cubed-xarray.md","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","exports":[{"format":"md","filename":"cubed-xarray.md","url":"/build/cubed-xarray-7dfbf78a1f00aa3ae53b6371df785f6a.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"_TLDR: Xarray can now wrap a range of parallel computation backends, including ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"liadGcSuAd"},{"type":"link","url":"https://github.com/tomwhite/cubed","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Cubed","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"uVSw6y07MY"}],"urlSource":"https://github.com/tomwhite/cubed","error":true,"key":"yZsi6W0ui5"},{"type":"text","value":", a distributed serverless framework designed to limit memory usage.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"TPxzV1j7tK"}],"key":"T1hHvbkpHY"},{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"elGF8DTmwR"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"T7fPi1IYdj"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"One of Xarray’s most powerful features is parallel computing on larger-than-memory datasets through its ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"tFjaWG7GS9"},{"type":"link","url":"https://docs.xarray.dev/en/stable/user-guide/dask.html","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"integration with Dask","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"KJwEtKEvnc"}],"urlSource":"https://docs.xarray.dev/en/stable/user-guide/dask.html","key":"g6X5LHcEaA"},{"type":"text","value":".\nWe love Dask - it’s an incredibly powerful tool, a big part of Xarray’s appeal, and central to the scalability of the ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"lJZmHrepZd"},{"type":"link","url":"https://pangeo.io/architecture.html","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Pangeo stack","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"BSMDhTHl18"}],"urlSource":"https://pangeo.io/architecture.html","key":"LFnVk4sRCy"},{"type":"text","value":".","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"DNsTffCXXw"}],"key":"iv3Sfx1y7d"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"However, the vision of seamlessly processing any array workload at arbitrary scale is ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"iPptYosQDr"},{"type":"emphasis","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"incredibly","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"JFWjnxmivM"}],"key":"MDLchWKGwK"},{"type":"text","value":" challenging, and its good to explore alternative implementations that might complement Dask’s approach.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"LnzeASvTH1"}],"key":"aHPqWOQWSd"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"link","url":"https://github.com/tomwhite/cubed","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Cubed","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"kR3MbyRG9G"}],"urlSource":"https://github.com/tomwhite/cubed","error":true,"key":"tw4NX5LeDD"},{"type":"text","value":" is one such alternative - a serverless framework for array processing developed by Tom White.\nTom comes to the Xarray community via working on the statistical genetics toolkit, ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"MmzL3VAui9"},{"type":"link","url":"https://github.com/pystatgen/sgkit","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"sgkit","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"zCvMl6jKiL"}],"urlSource":"https://github.com/pystatgen/sgkit","error":true,"key":"unPyRzSzEE"},{"type":"text","value":", and brings with him ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"Uve2Q19uLZ"},{"type":"link","url":"http://www.hadoopbook.com/","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"considerable experience","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"yl1ixGOZUA"}],"urlSource":"http://www.hadoopbook.com/","key":"m6PV6dC0vw"},{"type":"text","value":" with distributed systems.\nWe will discuss how Cubed works, what its novel design can offer, and demo using it on a realistic problem.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"FosNtLqiDN"}],"key":"qOe5vBZDAm"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"We will also explain how Xarray has been ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"blrsCg4eGl"},{"type":"link","url":"https://github.com/pydata/xarray/pull/7019","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"generalized to support wrapping Cubed","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"y7377l48FX"}],"urlSource":"https://github.com/pydata/xarray/pull/7019","data":{"kind":"issue","org":"pydata","repo":"xarray","issue_number":"7019"},"internal":false,"protocol":"github","key":"UEu5MXVfjj"},{"type":"text","value":", opening the door to yet more alternative implementations of chunked parallel array computing in Xarray.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"cdF45fYjZs"}],"key":"o3kw44BV2v"},{"type":"heading","depth":2,"position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"The challenge of managing memory usage","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"BpdMFFKCBf"}],"identifier":"the-challenge-of-managing-memory-usage","label":"The challenge of managing memory usage","html_id":"the-challenge-of-managing-memory-usage","implicit":true,"key":"Om0l8iNoJZ"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Managing RAM usage in big computations is very hard.\nIn the wider world there are many different frameworks for performing distributed computations, but most of them can’t make strict guarantees about limiting memory usage.\nIn practice this means that configuring workers or adjusting details of the computation plan to avoid accidentally exceeding memory limits is often the bottleneck for getting real-world computations to run successfully.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"CerMpMm2al"}],"key":"tYtRQT7iR2"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"The Dask developers have been making great progress on this problem, releasing big ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"Kzl8Vo21PY"},{"type":"link","url":"https://medium.com/pangeo/dask-distributed-and-pangeo-better-performance-for-everyone-thanks-to-science-software-63f85310a36b","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"changes to the distributed scheduler","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"tYGxE9gvfK"}],"urlSource":"https://medium.com/pangeo/dask-distributed-and-pangeo-better-performance-for-everyone-thanks-to-science-software-63f85310a36b","key":"oJT4V1uyAq"},{"type":"text","value":", and recently a new approach to ","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"i23pWJtRku"},{"type":"link","url":"https://blog.coiled.io/blog/shuffling-large-data-at-constant-memory","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"rechunking using a P2P algorithm","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"C8sx7jpIzV"}],"urlSource":"https://blog.coiled.io/blog/shuffling-large-data-at-constant-memory","key":"GJIRSrjeCc"},{"type":"text","value":".","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"f23Fq4pWrn"}],"key":"Qovww0yuUY"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"We’ve been working on a different approach: ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"VXdc0nlFTk"},{"type":"link","url":"https://github.com/tomwhite/cubed","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Cubed","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"PP9ofVXzwn"}],"urlSource":"https://github.com/tomwhite/cubed","error":true,"key":"EuW45jMXsx"},{"type":"text","value":"’s framework is specifically designed from the ground up to avoid this memory problem.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"ZvVdrXkhpp"}],"key":"mx38cU1GIL"},{"type":"heading","depth":2,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"What is Cubed?","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"DTFdNKv0Z3"}],"identifier":"what-is-cubed","label":"What is Cubed?","html_id":"what-is-cubed","implicit":true,"key":"yQKtCnOXtI"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"Cubed is a library for processing N-dimensional distributed arrays using a bounded-memory serverless model.\nWhat does that mean?\nLet’s take these terms one at a time:","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"Fa7OAyCNLa"}],"key":"lE8RQNAAhq"},{"type":"paragraph","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"strong","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"N-dimensional arrays","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"cCQsJleWmb"}],"key":"LLM8m4eVAY"}],"key":"MqhjFOQrF5"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"Cubed provides a ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"VNedj8Abcz"},{"type":"inlineCode","value":"cubed.Array","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"sgAW891SJI"},{"type":"text","value":" class which ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"ccHvlVZn4F"},{"type":"link","url":"https://tom-e-white.com/cubed/array_api.html","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"implements","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"Q61JCB1dA3"}],"urlSource":"https://tom-e-white.com/cubed/array_api.html","key":"fVb42z2j2J"},{"type":"text","value":" the ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"qYxrFL45eH"},{"type":"link","url":"https://data-apis.org/array-api/latest/","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"Python Array API Standard","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"qqToszVmSu"}],"urlSource":"https://data-apis.org/array-api/latest/","key":"TwjwLsrtWA"},{"type":"text","value":".\nLike ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"EhiyeVwDHp"},{"type":"inlineCode","value":"numpy","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"PHHQvYS66i"},{"type":"text","value":"/","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"llToKx9jMH"},{"type":"inlineCode","value":"cupy","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"TjDGcUUwkf"},{"type":"text","value":"/","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"Hus3WDEd8R"},{"type":"inlineCode","value":"dask","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"JXj98mR8vv"},{"type":"text","value":" arrays etc., Cubed arrays understand basic N-dimensional operations such as indexing, aggregations, and linear algebra.\nNote that Cubed does ","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"FWWWfxYw0p"},{"type":"emphasis","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"not","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"vQyFKWoqXR"}],"key":"bSKPHB9i9L"},{"type":"text","value":" understand data structures other than arrays, for example DataFrames.","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"gKN9j8CuXb"}],"key":"NKHJpkFla0"},{"type":"paragraph","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"strong","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"Distributed","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"ze3WOiTsck"}],"key":"Zx2T0sjwqf"}],"key":"OkSvdQVAB5"},{"type":"paragraph","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"Cubed Arrays are divided into chunks, allowing the work of processing your dataset to be split up and distributed across many machines.","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"j1C0aPJYQb"}],"key":"c1LVVbqp4i"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"As well as exposing a ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"k0nxxn8dAi"},{"type":"inlineCode","value":".chunks","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"BruxWSi03M"},{"type":"text","value":" attribute in exactly the same way as Dask, cubed provides functions for applying chunk-aware operations such as ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"iDqCGuaJdL"},{"type":"inlineCode","value":"map_blocks","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"aXp2UpAHtQ"},{"type":"text","value":", ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"spQJ9Hh827"},{"type":"inlineCode","value":"blockwise","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"Ux6gIWDguJ"},{"type":"text","value":", and ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"iXIxAp3jUF"},{"type":"inlineCode","value":"apply_gufunc","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"OGUXTyepzH"},{"type":"text","value":".\nCubed owes another huge debt to Dask here for developing and exposing these useful abstractions.","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"sQXUeQHvTJ"}],"key":"eseYoYWs6q"},{"type":"paragraph","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"strong","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"Bounded-memory","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"uvO4d9TZ8q"}],"key":"pStCD7HB6X"}],"key":"i0KkBEcawR"},{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"text","value":"Cubed aims to perform operations without exceeding a pre-set bound on the total RAM usage of the computation.\nBy building all common chunked array operations out of basic operations with known memory requirements, Cubed guarantees that the entire computation executes in a series of bounded-memory steps.","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"LFcNhCsnZt"}],"key":"KD2yMfTSeH"},{"type":"paragraph","position":{"start":{"line":65,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"text","value":"Cubed implements all chunked array operations in terms of just two “primitive operations”: ","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"ubm0UM2DFV"},{"type":"link","url":"https://tom-e-white.com/cubed/operations.html#blockwise","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"text","value":"blockwise","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"cUW3Dqq1RQ"}],"urlSource":"https://tom-e-white.com/cubed/operations.html#blockwise","key":"pKgAxPpAwX"},{"type":"text","value":" and ","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"QOvyV8SI0c"},{"type":"link","url":"https://tom-e-white.com/cubed/operations.html#rechunk","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"text","value":"rechunk","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"RcrVtMA2UX"}],"urlSource":"https://tom-e-white.com/cubed/operations.html#rechunk","key":"XajbLp3g4H"},{"type":"text","value":".\nBlockwise applies an in-memory function across multiple blocks of multiple inputs, and can be used to express a range of tensor operations.\nRechunk simply changes the chunking pattern of an array without altering its shape.","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"ujmIZKmnlM"}],"key":"wgBDf03h1a"},{"type":"image","url":"/build/e35ec725ea00fd2a6250d35dd849930e.png","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"INwnqJ19Vx","urlSource":"https://hackmd.io/_uploads/S1ci7nXI2.png"},{"type":"paragraph","position":{"start":{"line":71,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"FIGURE: Dependency tree for chunked array operations within Cubed, ","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"Wr4ZhNCkJy"},{"type":"link","url":"https://tom-e-white.com/cubed/operations.html#dependency-tree","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"children":[{"type":"text","value":"from cubed’s documentation","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"dDtOQzkTVT"}],"urlSource":"https://tom-e-white.com/cubed/operations.html#dependency-tree","key":"FuGqDuOjki"},{"type":"text","value":".\nNotice that all array API operations (white) can be implemented for chunked arrays in terms of “core ops” (orange) and eventually just two “primitive ops” - blockwise and rechunk.","position":{"start":{"line":71,"column":1},"end":{"line":71,"column":1}},"key":"g0qOoSETLc"}],"key":"xEDHrTEyi7"},{"type":"paragraph","position":{"start":{"line":74,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"Both blockwise and rechunk can be performed using algorithms which only require loading one chunk from each input array into memory at any time.\nIn the case of rechunk the ","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"OnISW4XqWv"},{"type":"link","url":"https://rechunker.readthedocs.io/en/latest/algorithm.html","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"text","value":"algorithm comes from the Pangeo Rechunker package","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"nRVeuJexjd"}],"urlSource":"https://rechunker.readthedocs.io/en/latest/algorithm.html","key":"CXeA1U3hjp"},{"type":"text","value":", whose model was a direct inspiration for Cubed.\nAs each chunk is of known size, the RAM usage for processing each chunk can be reliably estimated in advance.","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"FfJo0r188U"}],"key":"zSfzNxiloF"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Therefore the expected RAM usage of any Cubed computation can be projected in advance, and compared against the known system resources available (specified via the ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"sAJL4qvCzR"},{"type":"link","url":"https://tom-e-white.com/cubed/generated/cubed.Spec.html#cubed.Spec","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"inlineCode","value":"cubed.Spec","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"PpQd1mBl2w"}],"urlSource":"https://tom-e-white.com/cubed/generated/cubed.Spec.html#cubed.Spec","key":"i4R1Xf96mn"},{"type":"text","value":" object).","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"i0XEwSH5GG"}],"key":"KuST6ejOMT"},{"type":"paragraph","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"strong","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"Serverless","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"pUR913Lyzu"}],"key":"cCyBc77YG4"}],"key":"RVOuxCNDcc"},{"type":"paragraph","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"link","url":"https://www.cloudflare.com/en-gb/learning/serverless/what-is-serverless/","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"Serverless computing","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"AXeGOBqbCm"}],"urlSource":"https://www.cloudflare.com/en-gb/learning/serverless/what-is-serverless/","key":"OBztb3NKZh"},{"type":"text","value":" is a model in which some service runs a users tasks for them on an on-demand basis, allowing the user to avoid worrying about the details of how in fact their tasks are being run on real servers somewhere.","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"t91XFFcWQn"}],"key":"HrtkcFj4wq"},{"type":"paragraph","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"Cubed breaks down every array operation into a set of independent tasks, each of which reads one chunk from cloud storage and operates on it. These tasks are a good fit for a serverless cloud computing model.","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"sl6N9c3eFV"}],"key":"p1vM62FJL3"},{"type":"paragraph","position":{"start":{"line":86,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"However, unlike on a cluster the serverless functions cannot communicate with each other directly over the network.\nCubed instead writes an intermediate result to persistent storage between each array operation, saving a history of steps via Zarr.\nThis approach is a generalisation of the way Rechunker’s algorithm writes and reads data to an intermediate Zarr store as it executes.\n(Cubed actually implements some optimizations to avoid writing every intermediate array to disk, but ","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"Vvb4i37MVv"},{"type":"link","url":"https://github.com/tomwhite/cubed/issues/136","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"more are possible","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"P2eZx0EeRz"}],"urlSource":"https://github.com/tomwhite/cubed/issues/136","data":{"kind":"issue","org":"tomwhite","repo":"cubed","issue_number":"136"},"internal":false,"protocol":"github","key":"hJgH0o5BX7"},{"type":"text","value":".)","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"DEKvzeH5VM"}],"key":"I2RKPoKGjy"},{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":92,"column":1}},"children":[{"type":"text","value":"The benefit of serverless for analytics jobs is that instead of the user creating, managing, and shutting down a cluster manually (which lives either locally or on one or more remote servers), they simply specify the tasks they want performed and hand those tasks off to some paid-for serverless cloud computing service, such as Google Cloud Functions or AWS Lambda.\nThe tradeoff is that this approach is much more I/O intensive, and serverless nodes are generally more expensive than cluster nodes.","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"OWVbajck5d"}],"key":"hO4o7WaRHr"},{"type":"paragraph","position":{"start":{"line":94,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"text","value":"Cubed interfaces with a range of serverless cloud services and uses them to execute the chunk-level operations required to process the whole array.\nThis also provides chunk-level parallelism - all the tasks for creating one array are embarrasingly parallel so can be run simultaneously.\nIn other words, if your Cubed operation is writing its result to a Zarr store with 1000 chunks, Cubed will compute that step with 1000 parallel processes simultaneously by default.","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"Jegdi3W9gI"}],"key":"I7AhF8IZMw"},{"type":"image","url":"/build/38104a5b3b7bf2e45b4bdcea86a517d7.png","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"Cj1u2dBJgj","urlSource":"https://hackmd.io/_uploads/rJMd7-VLh.png"},{"type":"paragraph","position":{"start":{"line":100,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"FIGURE: There are a large number of commercial cloud services which offer serverless computing services.\nAll of the services pictured here are supported by the ","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"OQs7L0fYvs"},{"type":"link","url":"https://lithops-cloud.github.io/docs/#use-any-cloud","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Lithops","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"xgDK41D167"}],"urlSource":"https://lithops-cloud.github.io/docs/#use-any-cloud","key":"Aj43EqfnAh"},{"type":"text","value":" framework, which is only one of many tools Cubed can use to execute computations.\nSo far, using the Lithops executor, ","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"nGOWY3g3Gg"},{"type":"link","url":"https://github.com/tomwhite/cubed/tree/main/examples","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Cubed has been tested","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"awtjhGusTh"}],"urlSource":"https://github.com/tomwhite/cubed/tree/main/examples","error":true,"key":"xNnsKjq3XK"},{"type":"text","value":" on both AWS Lambda and Google Cloud Functions.\n(It has also been run on ","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"KMnXNdDrdC"},{"type":"link","url":"https://github.com/tomwhite/cubed/tree/main/examples/modal","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"AWS using Modal","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"GNYP9TDC48"}],"urlSource":"https://github.com/tomwhite/cubed/tree/main/examples/modal","error":true,"key":"XupjFn45pm"},{"type":"text","value":" and ","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"Dx0EGSXpdA"},{"type":"link","url":"https://github.com/tomwhite/cubed/tree/main/examples/dataflow","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"children":[{"type":"text","value":"Dataflow using the Beam executor","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"jcRlZoLCmQ"}],"urlSource":"https://github.com/tomwhite/cubed/tree/main/examples/dataflow","error":true,"key":"Tejt6LkQ9b"},{"type":"text","value":".)","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"QEUSb7cI3Q"}],"key":"nuHlpg4Jmb"},{"type":"heading","depth":2,"position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"Sounds cool, how do I try it?","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"qRArsXJGP8"}],"identifier":"sounds-cool-how-do-i-try-it","label":"Sounds cool, how do I try it?","html_id":"sounds-cool-how-do-i-try-it","implicit":true,"key":"DFwRomcYHM"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"You can try using Cubed arrays directly or you can use them seamlessly through Xarray, in the same way you use Dask.","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"PZI0QiKGcy"}],"key":"LDWuQrLef7"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"First ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"PYRo08OwxJ"},{"type":"inlineCode","value":"conda install -c conda-forge cubed-xarray","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"Mddfs0lU7A"},{"type":"text","value":", which will install Cubed, the latest version of Xarray (v2023.5.0), and the glue package ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"xzxidjsahr"},{"type":"link","url":"https://github.com/xarray-contrib/cubed-xarray","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"inlineCode","value":"cubed-xarray","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"hxmCkSkcNS"}],"urlSource":"https://github.com/xarray-contrib/cubed-xarray","error":true,"key":"cpZkF1lebq"},{"type":"text","value":".","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"JNW8PVeRfk"}],"key":"ACqkScxFVA"},{"type":"paragraph","position":{"start":{"line":112,"column":1},"end":{"line":113,"column":1}},"children":[{"type":"text","value":"To run Cubed in serverless mode you need to ","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"Ax2ohPw76M"},{"type":"link","url":"https://github.com/tomwhite/cubed/tree/main/examples#which-cloud-service-should-i-use","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"text","value":"set up integration with a cloud service","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"VGDICoyuaJ"}],"urlSource":"https://github.com/tomwhite/cubed/tree/main/examples#which-cloud-service-should-i-use","error":true,"key":"jP2fIi119x"},{"type":"text","value":".\nAlternatively you can just run Cubed locally, but you won’t see many of the benefits (local execution is the default if you don’t specify an ","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"ceZC4dlSNw"},{"type":"inlineCode","value":"executor","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"ZeyXvNGECw"},{"type":"text","value":" below).","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"pF3HsZMUnA"}],"key":"zIADX3hiEa"},{"type":"paragraph","position":{"start":{"line":115,"column":1},"end":{"line":116,"column":1}},"children":[{"type":"text","value":"Before creating a Cubed array you need a ","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"xl4agSo7MN"},{"type":"inlineCode","value":"Spec","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"dQMVqHLNHh"},{"type":"text","value":", which tells Cubed (a) how much RAM you think a process should need to compute any one chunk, and (b) where to store all the temporary files it will create as it executes.\nThis location can be a local directory or a cloud bucket.","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"geYzYhtzyJ"}],"key":"GU514lzLil"},{"type":"code","lang":"python","value":"from cubed import Spec\n\nspec = Spec(work_dir='tmp', allowed_mem='1GB')","position":{"start":{"line":118,"column":1},"end":{"line":122,"column":1}},"key":"u1xa20IyEA"},{"type":"paragraph","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"Now you can create a cubed-backed Xarray object in the same way you would create a dask-backed one:","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"fawdcbJXas"}],"key":"L7ZrJcMHiX"},{"type":"code","lang":"python","value":"ds = open_dataset(\n    'data.zarr', \n    chunked_array_type='cubed',\n    from_array_kwargs={'spec': spec})\n    chunks={},\n)","position":{"start":{"line":126,"column":1},"end":{"line":133,"column":1}},"key":"caev9xgYCk"},{"type":"paragraph","position":{"start":{"line":134,"column":1},"end":{"line":135,"column":1}},"children":[{"type":"text","value":"The only difference is the addition of the new ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"SRwX9FF8hs"},{"type":"inlineCode","value":"chunked_array_type","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"UAgbPPmYpz"},{"type":"text","value":" kwarg (which defaults to ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"vjb4VUVESq"},{"type":"inlineCode","value":"'dask'","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"PWObVrDsxa"},{"type":"text","value":"), and the new ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"vEVwhIEVPf"},{"type":"inlineCode","value":"from_array_kwargs","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"S2eyKHeicg"},{"type":"text","value":" dict, which allows passing arbitrary kwargs down to the constructor that creates the underlying chunked array.\nThe ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"LiksvH97lw"},{"type":"inlineCode","value":"chunks","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"JVfGlFH5VP"},{"type":"text","value":" kwarg plays exactly the same role as it does when creating Dask arrays. (This also works with the ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"lDfmLfEsxF"},{"type":"inlineCode","value":".chunk","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"l2U4k2zdML"},{"type":"text","value":" methods on ","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"ZkAJMZkXlr"},{"type":"inlineCode","value":"Dataset","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"TXMae8XqGw"},{"type":"text","value":"/","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"j0A21vfy6w"},{"type":"inlineCode","value":"DataArray","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"faszudqXxG"},{"type":"text","value":", using the same keyword arguments.)","position":{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},"key":"fHdSPEd2Du"}],"key":"fKRUuPwhjh"},{"type":"paragraph","position":{"start":{"line":137,"column":1},"end":{"line":139,"column":1}},"children":[{"type":"text","value":"Now you specify your analysis using normal Xarray code, right up until you need to compute the result.\nIn a similar way to how Dask’s ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"rnwaRncViu"},{"type":"inlineCode","value":".compute","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"rkNp2itz2f"},{"type":"text","value":" method accepts a ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"uPt9yQMlVy"},{"type":"inlineCode","value":"scheduler","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"cyRMdgjQBp"},{"type":"text","value":" argument, Cubed’s ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"d3hsnRZt9n"},{"type":"inlineCode","value":".compute","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"DB5lN2zq0K"},{"type":"text","value":" accepts an ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"wQAECZUOWz"},{"type":"inlineCode","value":"executor","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"DB3WOWWJCY"},{"type":"text","value":" argument.\nYou need to specify which executor to use by importing it, and configuration options for the cloud service would also be passed at this point.","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"PJhWNGeHVH"}],"key":"HGFOyr2SNk"},{"type":"code","lang":"python","value":"from cubed.runtime.executors.lithops import LithopsDagExecutor\n\nds.compute(executor=LithopsDagExecutor())","position":{"start":{"line":141,"column":1},"end":{"line":145,"column":1}},"key":"kz6BZyjdsg"},{"type":"heading","depth":2,"position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"children":[{"type":"text","value":"How does this integration work?","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"Zx9a2tA2SR"}],"identifier":"how-does-this-integration-work","label":"How does this integration work?","html_id":"how-does-this-integration-work","implicit":true,"key":"FUkjozxxTL"},{"type":"paragraph","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"Xarray has been coupled to Dask ","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"Huiu1fG1dA"},{"type":"link","url":"http://stephanhoyer.com/2015/06/11/xray-dask-out-of-core-labeled-arrays/","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"since","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"tlm2Y65j96"}],"urlSource":"http://stephanhoyer.com/2015/06/11/xray-dask-out-of-core-labeled-arrays/","key":"tkymCIa179"},{"type":"text","value":" ","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"PyDny7QBs4"},{"type":"link","url":"https://github.com/pydata/xarray/issues/328","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"2015","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"y7WcZFRpBF"}],"urlSource":"https://github.com/pydata/xarray/issues/328","data":{"kind":"issue","org":"pydata","repo":"xarray","issue_number":"328"},"internal":false,"protocol":"github","key":"kaGdKrYwOr"},{"type":"text","value":". How did we generalize it?","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"lsg5kqSHJI"}],"key":"qwHP5BJ7Ed"},{"type":"paragraph","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"Much of the integration works immediately because Cubed implements the ","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"hs6OznoUCK"},{"type":"link","url":"https://data-apis.org/array-api/latest/","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"Python Array API Standard","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"tzhVRj6r11"}],"urlSource":"https://data-apis.org/array-api/latest/","key":"kHhZzSex8e"},{"type":"text","value":", and Xarray can ","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"V7CUAuVrnj"},{"type":"link","url":"https://docs.xarray.dev/en/stable/roadmap.html#flexible-arrays","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"wrap any numpy-like array","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"k5W6ZevYuj"}],"urlSource":"https://docs.xarray.dev/en/stable/roadmap.html#flexible-arrays","key":"YW2ZPHonkr"},{"type":"text","value":" (see the blog post on ","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"DAjwT0BTz1"},{"type":"link","url":"https://xarray.dev/blog/introducing-pint-xarray","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"children":[{"type":"text","value":"wrapping ","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"U36jWoaVsr"},{"type":"inlineCode","value":"pint.Quantity","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"njhEqEAZqM"},{"type":"text","value":" arrays","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"hFNLh22mSB"}],"urlSource":"https://xarray.dev/blog/introducing-pint-xarray","key":"rkDjnHVrD7"},{"type":"text","value":").","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"suTIkEQETA"}],"key":"MmPYhbcQQ4"},{"type":"paragraph","position":{"start":{"line":153,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"Chunked arrays implement additional attributes (e.g. ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"JPgMzTb8a2"},{"type":"inlineCode","value":".chunks","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"kLXFWwi0eI"},{"type":"text","value":") and methods (e.g. ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"ITVrCuiHsQ"},{"type":"inlineCode","value":".rechunk","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"DlgXmWRV94"},{"type":"text","value":"), but also require special functions (e.g. ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"GLEyHw2I0B"},{"type":"inlineCode","value":"blockwise","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"q4ozpkhPRE"},{"type":"text","value":", ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"p1YXp0wTKW"},{"type":"inlineCode","value":"map_blocks","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"TaFUyZqpXI"},{"type":"text","value":") for mapping in-memory numpy functions over different chunks.\nThese key functions are useful abstractions invented within Dask, and ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"P7K8APwIdM"},{"type":"link","url":"https://tom-e-white.com/cubed/operations.html","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"children":[{"type":"text","value":"Cubed implements its own versions","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"Kxn2Zmavid"}],"urlSource":"https://tom-e-white.com/cubed/operations.html","key":"nCyvn7ewY3"},{"type":"text","value":" of each of them.","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"QhqhWgwR8R"}],"key":"aA4aEPbmiY"},{"type":"paragraph","position":{"start":{"line":156,"column":1},"end":{"line":158,"column":1}},"children":[{"type":"text","value":"Chunked array implementations specify how to dispatch computations to the correct implementation of these functions by subclassing a new ","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"HJV2rVDKUg"},{"type":"inlineCode","value":"ChunkManagerEntrypoint","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"XF8LvBLJPl"},{"type":"text","value":" base class.\nAny array library implementing an array-like API and defining chunk-aware functions can hook in.\nUsing entrypoints means the possible backends can be automatically discovered, which is why we don’t need to explicitly import anything from the ","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"PeChV3Q7ep"},{"type":"inlineCode","value":"cubed-xarray","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"ZtLsAJpiLx"},{"type":"text","value":" package.","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"MftvsWonW8"}],"key":"dV0avmn6JF"},{"type":"heading","depth":2,"position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"text","value":"Demo: The “Quadratic Means” problem","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"tAAPBzIL5Q"}],"identifier":"demo-the-quadratic-means-problem","label":"Demo: The “Quadratic Means” problem","html_id":"demo-the-quadratic-means-problem","implicit":true,"key":"HD9QvbtIV3"},{"type":"paragraph","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"children":[{"type":"text","value":"(","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"qtMfSs596l"},{"type":"link","url":"https://gist.github.com/TomNicholas/c6a28f7c22c6981f75bce280d3e28283","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"children":[{"type":"text","value":"Full notebook here","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"KYBcZTuus4"}],"urlSource":"https://gist.github.com/TomNicholas/c6a28f7c22c6981f75bce280d3e28283","key":"l3tmTCjAvc"},{"type":"text","value":")","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"MHC9sziUkl"}],"key":"e7ky6kxwT8"},{"type":"paragraph","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"children":[{"type":"text","value":"To succinctly demonstrate the relative advantages of Cubed, we’ll choose a workload which is representative of what happens when cluster-based frameworks struggle with memory management.","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"key":"koSlDOLJAD"}],"key":"oUa7coHlXA"},{"type":"paragraph","position":{"start":{"line":166,"column":1},"end":{"line":168,"column":1}},"children":[{"type":"text","value":"The “Quadratic Means” problem is a simplified version of calculating the cross-product mean from the climatological anomalies of two variables.\nIt requires taking products of two chunked scalar variables ","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"key":"hMxzu15oF9"},{"type":"inlineMath","value":"U","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eU\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eU\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eU\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"SsRI9KctAN"},{"type":"text","value":" and ","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"key":"Y1n0HAhBuf"},{"type":"inlineMath","value":"V","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eV\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eV\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.22222em;\"\u003eV\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"sMV5gsOrKo"},{"type":"text","value":" and then aggregating the result along the chunked dimension.\nIt is a good example of problem that is simple to express, but creates a dask graph complex enough to trigger suboptimal performance of the distributed scheduler.","position":{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},"key":"Ht7FPH82Fl"}],"key":"etqIVdqEVg"},{"type":"heading","depth":3,"position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"Dask results","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"ThffIoVhNI"}],"identifier":"dask-results","label":"Dask results","html_id":"dask-results","implicit":true,"key":"q6TPneEzIw"},{"type":"image","url":"/build/341652a6372b2e2339d98c8b0d90f3be.png","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"LnAFx7Vhhi","urlSource":"https://hackmd.io/_uploads/S1h5o6OO2.png"},{"type":"paragraph","position":{"start":{"line":174,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"FIGURE: Dask’s memory usage for a simplified version of the “quadratic means” workload, at a number of different scales.\nNotice the RAM usage increasing proportially with dataset size, until the workers spill to disk for the largest dataset (1.5TB).\nIf the workload were much larger, or the cluster much smaller, this would have crashed. This was run on 20 16GB RAM workers using Coiled.","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"n4y8adyNCM"}],"key":"gNvGFaG1gU"},{"type":"paragraph","position":{"start":{"line":178,"column":1},"end":{"line":181,"column":1}},"children":[{"type":"text","value":"We ran this workload on Coiled, for datasets of increasing size, using the latest version of ","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"cF9z1xO6UM"},{"type":"inlineCode","value":"dask.distributed","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"GRCS9gVEWa"},{"type":"text","value":", both with and without P2P rechunking.\nWe see that as the problem size increases, the peak memory required by the dask cluster increases too.\nOnce the peak memory required is larger than the RAM available to the workers, they continue loading data, but spill it to disk (spilled memory not shown in the plot).\nIf the total memory available is smaller than the dataset size, the cluster will crash (here we used 20 workers to ensure there was enough disk space to complete the 1.5TB workload).","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"U69DvLye5n"}],"key":"qWZeZGpenp"},{"type":"paragraph","position":{"start":{"line":183,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"This type of failure occurs sometimes for real array workloads when using dask, but is a symptom of the general difficulty of memory management when using any cluster-based framework.\n(The performance of on this particular case could almost certainly be improved by changes to dask’s distributed scheduler, and indeed ","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"oZTNZTnKtY"},{"type":"link","url":"https://medium.com/pangeo/dask-distributed-and-pangeo-better-performance-for-everyone-thanks-to-science-software-63f85310a36b","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"children":[{"type":"inlineCode","value":"dask.distributed","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"Q6QyFZjwv5"},{"type":"text","value":" has gotten hugely better at memory management recently","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"w9h7rKjrF6"}],"urlSource":"https://medium.com/pangeo/dask-distributed-and-pangeo-better-performance-for-everyone-thanks-to-science-software-63f85310a36b","key":"XpDUtBBzNd"},{"type":"text","value":".\nHere though we are just using this case as a specific example of a type of failure that is very difficult to solve in general.)","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"JiM6dxQZwc"}],"key":"mh4BUznq7J"},{"type":"heading","depth":3,"position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"Cubed results","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"qnxwcKEJPF"}],"identifier":"cubed-results","label":"Cubed results","html_id":"cubed-results","implicit":true,"key":"IctgEQVvd7"},{"type":"paragraph","position":{"start":{"line":189,"column":1},"end":{"line":190,"column":1}},"children":[{"type":"link","url":"https://gist.github.com/TomNicholas/c6a28f7c22c6981f75bce280d3e28283","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"text","value":"Trying this problem with Cubed","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"D5SISzSE9r"}],"urlSource":"https://gist.github.com/TomNicholas/c6a28f7c22c6981f75bce280d3e28283","key":"EGC8cQm9IR"},{"type":"text","value":" (using the Lithops executor and Google Cloud Functions), we find that Cubed successfully completed the workload at all scales, including the 1.5TB workload.\nRemarkably, it did so using only 1.3GB of RAM per serverless container, staying below the threshold of 2GB we set in the ","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"SSYkYeAHTt"},{"type":"inlineCode","value":"cubed.Spec","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"thGYVQvz0d"},{"type":"text","value":".","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"quir4yai6G"}],"key":"OtXpvmsWwf"},{"type":"paragraph","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"If we take just the largest version of this workload (1.5TB), we can visualize the relationship between the various types of memory Cubed accounts for over the course of the computation.","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"Uh9axo0Iyv"}],"key":"iWwnbO4j8D"},{"type":"image","url":"/build/7869d86d159257fc5b3170da07bf7bc3.png","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"HygMo8JINp","urlSource":"https://hackmd.io/_uploads/rylFHft_n.png"},{"type":"paragraph","position":{"start":{"line":196,"column":1},"end":{"line":197,"column":1}},"children":[{"type":"text","value":"FIGURE: Cubed’s actual memory usage vs projected memory usage, for the largest workload (1.5TB). Cubed successfully processed 1.5TB of data whilst only using a maximum of 1.3GB of RAM per serverless container, staying well below the given limit of 2GB of RAM.\nThis was run using Lithops on Google Cloud Functions, which provisioned thousands of serverless containers each with 2048MB of RAM.","position":{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},"key":"hpPAb5bmw6"}],"key":"qzpYm45mkc"},{"type":"paragraph","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"children":[{"type":"text","value":"You can see again that the ","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"mbAheo2X44"},{"type":"link","url":"https://tom-e-white.com/cubed/user-guide/memory.html","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"children":[{"type":"text","value":"projected memory","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"ltkKAb0wyA"}],"urlSource":"https://tom-e-white.com/cubed/user-guide/memory.html","key":"lO4ze2AClE"},{"type":"text","value":" usage is below the allowed memory usage (else Cubed would have raised an exception before the job even started running), and the actual peak memory used was lower still. We’ve also plotted the reserved memory, which is a parameter intended to account for the memory usage of the executor itself (i.e. Lithops here), and was estimated by measuring beforehand using ","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"teZwpyUwog"},{"type":"link","url":"https://tom-e-white.com/cubed/generated/cubed.measure_reserved_memory.html#cubed.measure_reserved_memory","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"children":[{"type":"inlineCode","value":"cubed.measure_reserved_memory()","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"LdHcOrvPW3"}],"urlSource":"https://tom-e-white.com/cubed/generated/cubed.measure_reserved_memory.html#cubed.measure_reserved_memory","key":"ZmX5MC9t1S"},{"type":"text","value":".","position":{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},"key":"Ij4KCi3ZBp"}],"key":"WpEHZbb5uZ"},{"type":"paragraph","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"text","value":"One obvious tradeoff for this memory stability is that Cubed took ","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"QahIoFhpYw"},{"type":"strong","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"text","value":"a lot longer","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"jXvWDqeGfx"}],"key":"MOUCDfszTz"},{"type":"text","value":" to complete - roughly 4x longer then dask for the 1.5TB workload (45m 22s vs 11m 26s). We will come back to discuss this shortly.","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"X0hJbBgYQe"}],"key":"Akl9tynGKR"},{"type":"paragraph","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"text","value":"Finally it’s interesting to look at Cubed’s equivalent of the task graph. To calculate one array (the product ","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"uJTaLorqu6"},{"type":"inlineMath","value":"\u003cUV\u003e_t","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e\u0026lt;\u003c/mo\u003e\u003cmi\u003eU\u003c/mi\u003e\u003cmi\u003eV\u003c/mi\u003e\u003cmsub\u003e\u003cmo\u003e\u0026gt;\u003c/mo\u003e\u003cmi\u003et\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\u0026lt;UV\u0026gt;_t\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eU\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.22222em;\"\u003eV\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u003cspan class=\"mrel\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2806em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003et\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"eCgM7DVF1P"},{"type":"text","value":" from the quadratic means problem), Cubed’s “Plan” for processing 1.5TB of data looks like this:","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"na4wEdSZPN"}],"key":"wrfiLFq4si"},{"type":"image","url":"/build/e90396280f74e96480e285d35ee8ca0f.png","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"ByyA1ix3IA","urlSource":"https://hackmd.io/_uploads/SJcShLyvn.png"},{"type":"paragraph","position":{"start":{"line":207,"column":1},"end":{"line":209,"column":1}},"children":[{"type":"text","value":"FIGURE: Cubed ","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"Zn9kqtgLDT"},{"type":"inlineCode","value":"Plan","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"yGu5WbBOkP"},{"type":"text","value":" (i.e. task graph) for processing 1.5TB of array data.\nThis graph corresponds to a single xarray variable (","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"LKarvMdSVw"},{"type":"inlineCode","value":"UV","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"tCmAYu6mMU"},{"type":"text","value":") in the “quadratic means” workload. Each node corresponds to an intermediate Zarr array that gets written to disk as the computation progresses, separated by either rechunk (rc) or blockwise (bw) steps.\nNotice that the number of nodes in the graph is not proportional to the number of chunks in the array.","position":{"start":{"line":207,"column":1},"end":{"line":207,"column":1}},"key":"cAxNw11TpH"}],"key":"ux0sWnkmvM"},{"type":"paragraph","position":{"start":{"line":211,"column":1},"end":{"line":213,"column":1}},"children":[{"type":"text","value":"The task graph is at the array-level, meaning that it does not grow proportionally to the number of chunks.\nThe final linear series of steps does get longer with problem scale, but only logarithmically, as it represents the number of steps in a ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"DB01rCdT89"},{"type":"link","url":"https://tom-e-white.com/cubed/operations.html#reduction-and-arg-reduction","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"tree-like reduction","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"CoROf9VnzS"}],"urlSource":"https://tom-e-white.com/cubed/operations.html#reduction-and-arg-reduction","key":"qIQ35LNZUL"},{"type":"text","value":" necessary to reduce that quantity of data.\n(This ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"WMx4q6YhTv"},{"type":"inlineCode","value":"Plan","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"knk4QvH5QH"},{"type":"text","value":" is somewhat similar to Dask’s ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"UvXXHP1oaQ"},{"type":"link","url":"https://docs.dask.org/en/stable/high-level-graphs.html","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"“High Level Graph”","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"YCN9L115H7"}],"urlSource":"https://docs.dask.org/en/stable/high-level-graphs.html","key":"oBiACT9IqZ"},{"type":"text","value":", but array-native, and designed to avoid the problem of over-burdening a scheduler.)","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"fhTM1jkFJa"}],"key":"IwTYLsVzce"},{"type":"heading","depth":2,"position":{"start":{"line":215,"column":1},"end":{"line":215,"column":1}},"children":[{"type":"text","value":"Pros and cons of Cubed’s model","position":{"start":{"line":215,"column":1},"end":{"line":215,"column":1}},"key":"dSAPy2nJTD"}],"identifier":"pros-and-cons-of-cubeds-model","label":"Pros and cons of Cubed’s model","html_id":"pros-and-cons-of-cubeds-model","implicit":true,"key":"vVNfoNLmgx"},{"type":"paragraph","position":{"start":{"line":217,"column":1},"end":{"line":217,"column":1}},"children":[{"type":"text","value":"Cubed uses a completely different paradigm to Dask (and other frameworks), and so has various advantages and disadvantages. Let’s discuss the obvious disadvantages first.","position":{"start":{"line":217,"column":1},"end":{"line":217,"column":1}},"key":"JithpwS62p"}],"key":"Fzy5oQG2qm"},{"type":"heading","depth":3,"position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"children":[{"type":"text","value":"Disadvantages","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"key":"RPRtFYRbQd"}],"identifier":"disadvantages","label":"Disadvantages","html_id":"disadvantages","implicit":true,"key":"MtzLDp3ZMk"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":221,"column":1},"end":{"line":242,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":221,"column":1},"end":{"line":224,"column":1}},"children":[{"type":"strong","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"children":[{"type":"text","value":"Writing to persistent storage is slow","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"key":"O4BbNdcKIi"}],"key":"DwZDA3bqwU"},{"type":"text","value":"\nIn general writing and reading to persistent storage (disk or object store) is slow, and doing it repeatedly even more so.\nWhilst there is scope for considerable ","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"key":"pCKboNjOQo"},{"type":"link","url":"https://github.com/tomwhite/cubed/issues?q=is%3Aissue+is%3Aopen+label%3Aoptimization","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"children":[{"type":"text","value":"optimization within Cubed","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"key":"SNsTxBn3Tu"}],"urlSource":"https://github.com/tomwhite/cubed/issues?q=is%3Aissue+is%3Aopen+label%3Aoptimization","error":true,"key":"p6N1hduh6B"},{"type":"text","value":", the model of communicating between processes by writing to disk will likely always be slower for many problems than communicating using RAM like dask does.\nOne idea for mitigating this might be to use a very fast storage technology like Redis to store intermediate results.","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"key":"RdKdnvzemm"}],"key":"HI1uFPey5p"},{"type":"listItem","spread":true,"position":{"start":{"line":225,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"strong","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"children":[{"type":"text","value":"Spinning up cloud services can be slow","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"owDSXh7HTc"}],"key":"VrnvkJ93Nl"},{"type":"text","value":"\nThere is also a time cost to spinning up the containers in which each task is performed, which can vary considerably between cloud services.","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"mqpVVZJpBe"}],"key":"hB3qgQUiGq"},{"type":"listItem","spread":true,"position":{"start":{"line":227,"column":1},"end":{"line":233,"column":1}},"children":[{"type":"strong","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"text","value":"Higher monetary cost","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"wf6MQf14Kk"}],"key":"hj8e3fMgZ1"},{"type":"text","value":"\nWe estimate that Cubed cost about an order of magnitude more to run than Dask on Coiled did for this 1.5TB workload (order ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"eGmGPshwE7"},{"type":"inlineMath","value":"10 vs order ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e10\u003c/mn\u003e\u003cmi\u003ev\u003c/mi\u003e\u003cmi\u003es\u003c/mi\u003e\u003cmi\u003eo\u003c/mi\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmi\u003er\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e10 vs order \u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e10\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003ev\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003esor\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ed\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eer\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"D9IPt2b5bL"},{"type":"text","value":"1).\nSpecific numbers and lengthier discussion are given in the ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"dGLT3H9xrx"},{"type":"link","url":"https://gist.github.com/TomNicholas/c6a28f7c22c6981f75bce280d3e28283","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"text","value":"accompanying notebook","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"bqSce8AmR6"}],"urlSource":"https://gist.github.com/TomNicholas/c6a28f7c22c6981f75bce280d3e28283","key":"ERU6Tj54CQ"},{"type":"text","value":".\nThis is not very suprising, but the lesson should also be that (like performance) estimating cloud costs is complicated, workload-specific, provider-specific, and contextual.\nIt is also worth noting that costs for both could be lowered.\nFuture optimizations to Cubed could reduce the number of intermediate Zarr steps required, and in a serverless paradigm you cannot accidentally be charged for a cluster you leave running idle.\nOn the other hand ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"j3HjXMyG0N"},{"type":"link","url":"https://blog.coiled.io/blog/dask-graviton.html","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"text","value":"Coiled can use ARM chips","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"poVNIw3Jse"}],"urlSource":"https://blog.coiled.io/blog/dask-graviton.html","key":"pWQxsGQoBq"},{"type":"text","value":", as well as ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"w3XdFXJBOu"},{"type":"link","url":"https://www.coiled.io/blog/save-money-with-spot","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"text","value":"spot instances","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"lO4dfmL2ta"}],"urlSource":"https://www.coiled.io/blog/save-money-with-spot","key":"b2dmDoPpSL"},{"type":"text","value":", both of which could lower its cost further.","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"IpJXxG6K3Z"}],"key":"ZZ5Tvnn5qr"},{"type":"listItem","spread":true,"position":{"start":{"line":234,"column":1},"end":{"line":238,"column":1}},"children":[{"type":"strong","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"Still a prototype","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"KwbtTiKJCr"}],"key":"y1DECEBYu6"},{"type":"text","value":"\nCubed is still young, and whilst fairly feature-complete it has not been rigorously tested on very large datasets, or on several of the cloud services it could theoretically run on.\nThere will be bugs, or things which are simply not yet implemented.\nThe ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"coNmNxSQSE"},{"type":"link","url":"https://github.com/xarray-contrib/cubed-xarray","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"cubed-xarray integration","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"ONqYiDNrbr"}],"urlSource":"https://github.com/xarray-contrib/cubed-xarray","error":true,"key":"zUuPU50i0R"},{"type":"text","value":" is similarly experimental, and any ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"hcq2RUlFNr"},{"type":"link","url":"https://github.com/xarray-contrib/cubed-xarray/blob/main/README.md#sharp-edges-","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"present incompatibilities","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"xY1FrnDjcT"}],"urlSource":"https://github.com/xarray-contrib/cubed-xarray/blob/main/README.md#sharp-edges-","data":{"kind":"file","org":"xarray-contrib","repo":"cubed-xarray","reference":"main","file":"README.md","raw":"https://raw.githubusercontent.com/xarray-contrib/cubed-xarray/main/README.md"},"internal":false,"protocol":"github","key":"QtehO2hgf2"},{"type":"text","value":" will likely cause silent coercion to numpy arrays.\nContributions to Cubed to are welcome!","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"ciI5uUWtTX"}],"key":"iTYvHk8yen"},{"type":"listItem","spread":true,"position":{"start":{"line":239,"column":1},"end":{"line":242,"column":1}},"children":[{"type":"strong","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"Only array processing","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"TtK63WW7No"}],"key":"vuHOviEUSG"},{"type":"text","value":"\nCubed is far less general than other parallel processing frameworks like Dask, Spark, or Apache Beam.\nIt only supports array processing, and cannot support other data structures like Dataframes, ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"XouP4MlG8W"},{"type":"link","url":"https://docs.dask.org/en/stable/custom-collections.html","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"custom collections","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"shP19b9nxh"}],"urlSource":"https://docs.dask.org/en/stable/custom-collections.html","key":"rYDzIZpcn5"},{"type":"text","value":", or ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"i48fPgnG54"},{"type":"link","url":"https://docs.dask.org/en/stable/custom-graphs.html","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"arbitrary computation graphs","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"c4EmnNX9gS"}],"urlSource":"https://docs.dask.org/en/stable/custom-graphs.html","key":"CuTfS7KMAh"},{"type":"text","value":".","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"hsdZolMgD1"}],"key":"XqIYJGpv90"}],"key":"N58uwa7g0w"},{"type":"heading","depth":3,"position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"Advantages","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"WGdvcZsWqf"}],"identifier":"advantages","label":"Advantages","html_id":"advantages","implicit":true,"key":"opKlmFMVly"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":245,"column":1},"end":{"line":266,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":245,"column":1},"end":{"line":246,"column":1}},"children":[{"type":"strong","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"children":[{"type":"text","value":"Bounded-memory","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"RBCKus0Qye"}],"key":"CME9FR2HvK"},{"type":"text","value":"\nWe’ve already seen how this works, but being able to complete a large-scale job that previously crashed or had to be manually split up would be an extremely useful feature on its own.","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"La31g6PR15"}],"key":"uJg3T1wlLy"},{"type":"listItem","spread":true,"position":{"start":{"line":247,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"strong","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"text","value":"Resumable","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"mBdKhuJc7r"}],"key":"EG5twWZ2GO"},{"type":"text","value":"\nSaving each intermediate result to disk means the progress of the computation is saved even if the cluster goes down or power is lost.\nCubed allows you to resume a stalled computation in a new process to finish a long job.","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"jnOkTDdbE9"}],"key":"GW6brP2skq"},{"type":"listItem","spread":true,"position":{"start":{"line":250,"column":1},"end":{"line":252,"column":1}},"children":[{"type":"strong","position":{"start":{"line":250,"column":1},"end":{"line":250,"column":1}},"children":[{"type":"text","value":"No cluster to manage","position":{"start":{"line":250,"column":1},"end":{"line":250,"column":1}},"key":"xJ0B4jnv2r"}],"key":"wBRT6e3v8O"},{"type":"text","value":"\nA serverless design means that the user does not having to deploy and manage a cluster at all.\nArguably conceptually simpler, this model also means less boilerplate code, no error-prone deployment step, and only paying for computation you actually do, not for the time the cluster is up.","position":{"start":{"line":250,"column":1},"end":{"line":250,"column":1}},"key":"mLiRO6PVaE"}],"key":"VGpZdxDZXT"},{"type":"listItem","spread":true,"position":{"start":{"line":253,"column":1},"end":{"line":259,"column":1}},"children":[{"type":"strong","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"text","value":"Horizontal scalability","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"ZBYYRQPxkx"}],"key":"VT81Do89aI"},{"type":"text","value":"\nCubed is designed with “","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"fN4TYTpulD"},{"type":"link","url":"https://www.section.io/blog/scaling-horizontally-vs-vertically/","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"text","value":"horizontal scaling","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"X1Ro14JVTT"}],"urlSource":"https://www.section.io/blog/scaling-horizontally-vs-vertically/","key":"Af4S8Sq3MC"},{"type":"text","value":"” in mind, meaning bringing many machines to bear on the problem at once.\n(As opposed to “vertical scaling” - utilizing a bigger machine.)\nZarr can support as many concurrent writes as there are chunks, and the serverless framework should be able to smoothly launch and manage almost any number of parallel workers.\nThis has yet to be tested at truly massive scale however.\nCubed also avoids another potential scaling bottleneck of having too many individual tasks for a single scheduler process to manage.\nThe computation is represented as an array-level graph, so the graph size doesn’t scale with the number of chunks, and there is no complex scheduler to over-burden.","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"M1jtggrfcy"}],"key":"HSM2BMwgZd"},{"type":"listItem","spread":true,"position":{"start":{"line":260,"column":1},"end":{"line":266,"column":1}},"children":[{"type":"strong","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"Various runtimes","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"VuQZsqu80t"}],"key":"kAZv4XdbZW"},{"type":"text","value":"\nCubed can execute its computation plans using a range of executors, opening up a big space of possibilities.\nAs well as running locally, Cubed can convert its plans into ","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"ZuvdPLi03v"},{"type":"link","url":"https://beam.apache.org/documentation/basics/","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"Beam Pipelines","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"oAF04DxqSB"}],"urlSource":"https://beam.apache.org/documentation/basics/","key":"twl5I4QG8i"},{"type":"text","value":" and run on Google Cloud Dataflow, use ","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"aaweA0WEeI"},{"type":"link","url":"https://lithops-cloud.github.io/docs/#use-any-cloud","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"Lithops","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"ul0IDjgUPx"}],"urlSource":"https://lithops-cloud.github.io/docs/#use-any-cloud","key":"kX14luIPV2"},{"type":"text","value":" to dispatch to a range of serverless providers, or use the ","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"r19eD1pr6r"},{"type":"link","url":"https://github.com/tomwhite/cubed/tree/main/examples/modal","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"Modal client","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"MTNbygp2Zm"}],"urlSource":"https://github.com/tomwhite/cubed/tree/main/examples/modal","error":true,"key":"QSxDNiM5s0"},{"type":"text","value":" to start-up containers in literally a second.\nIt should even be possible to write a ","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"OdIJvxlBef"},{"type":"link","url":"https://github.com/tomwhite/cubed/issues/161","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"Dask executor for Cubed","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"OtDI3infRS"}],"urlSource":"https://github.com/tomwhite/cubed/issues/161","data":{"kind":"issue","org":"tomwhite","repo":"cubed","issue_number":"161"},"internal":false,"protocol":"github","key":"YSPi76lhsu"},{"type":"text","value":", similar to what exists in the Rechunker package.\nThis might go some way to giving the benefits of Cubed but with lower cost and speed.\nOne could also imagine ","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"J1CstWGQiC"},{"type":"link","url":"https://github.com/tomwhite/cubed/issues/224","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"children":[{"type":"text","value":"running Cubed on another type of cluster","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"kCC9U5g87s"}],"urlSource":"https://github.com/tomwhite/cubed/issues/224","data":{"kind":"issue","org":"tomwhite","repo":"cubed","issue_number":"224"},"internal":false,"protocol":"github","key":"KPYDDiHiTL"},{"type":"text","value":".","position":{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},"key":"oDTIvJdOCk"}],"key":"Nk0keomWCK"}],"key":"eU2VJJVDXx"},{"type":"paragraph","position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"children":[{"type":"text","value":"Overall one could think of different parallel array processing libraries as complementary, best-suited to different problems or to running on different systems.","position":{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},"key":"b99WvEfo5A"}],"key":"p8aM58Lg5G"},{"type":"heading","depth":2,"position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"children":[{"type":"text","value":"Range of options","position":{"start":{"line":269,"column":1},"end":{"line":269,"column":1}},"key":"JBtE74opHm"}],"identifier":"range-of-options","label":"Range of options","html_id":"range-of-options","implicit":true,"key":"gqvupY6GVf"},{"type":"paragraph","position":{"start":{"line":271,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"There is a saying that there are ","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"BTYXCbeRba"},{"type":"link","url":"https://medium.com/machine-words/the-three-numbers-b41009ffa236","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"children":[{"type":"text","value":"only three important numbers in programming","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"YCY2j6lxiG"}],"urlSource":"https://medium.com/machine-words/the-three-numbers-b41009ffa236","key":"LuTvbeh3YZ"},{"type":"text","value":": 0, 1, and infinity.\nHaving gone from 1 to 2 options of parallel backends, can we go to N?","position":{"start":{"line":271,"column":1},"end":{"line":271,"column":1}},"key":"f75mNUn00h"}],"key":"vISyWhHsaN"},{"type":"paragraph","position":{"start":{"line":274,"column":1},"end":{"line":277,"column":1}},"children":[{"type":"text","value":"That is the situation in the database analytics world.\nThere SQL (Structured Query Language) queries form a common high-level way of expressing user intent, but the actual execution of a query on a database can be performed using a huge range of technologies, known as ","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"hlgr5cgFnY"},{"type":"link","url":"https://howqueryengineswork.com/01-what-is-a-query-engine.html","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"Query Engines","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"Tt8PovBuPd"}],"urlSource":"https://howqueryengineswork.com/01-what-is-a-query-engine.html","key":"GnzANObl3e"},{"type":"text","value":".\nThese projects compete to determine which can get the best performance on ","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"gLr2yyiUaD"},{"type":"link","url":"https://howqueryengineswork.com/15-benchmarks.html#transaction-processing-council-tpc-benchmarks","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"various standardised benchmarks","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"RWvVCm11lU"}],"urlSource":"https://howqueryengineswork.com/15-benchmarks.html#transaction-processing-council-tpc-benchmarks","key":"bsuRdLQnZh"},{"type":"text","value":".\nIn the example above Xarray is playing a similar role to SQL as a high-level query language, allowing users to easily try out different array backends depending on their problem.","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"OhwoXyA8j3"}],"key":"hhhNPwk2oz"},{"type":"paragraph","position":{"start":{"line":279,"column":1},"end":{"line":280,"column":1}},"children":[{"type":"text","value":"Here we’ve focused on Cubed, but this work opens the door to using other alternative distributed array processing frameworks such as ","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"JOp9nvWMht"},{"type":"link","url":"https://github.com/Python-for-HPC/ramba","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"Ramba","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"fnKcBQcv7E"}],"urlSource":"https://github.com/Python-for-HPC/ramba","error":true,"key":"qYcWH1Bfkg"},{"type":"text","value":", ","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"tvB82G2pxS"},{"type":"link","url":"https://github.com/Bears-R-Us/arkouda","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"Arkouda","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"wPV8aG8RMJ"}],"urlSource":"https://github.com/Bears-R-Us/arkouda","error":true,"key":"nM56uONKab"},{"type":"text","value":", ","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"JnxPZ6CrEi"},{"type":"link","url":"https://github.com/aesara-devs/aesara","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"Aesara","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"sQGeG49oo8"}],"urlSource":"https://github.com/aesara-devs/aesara","error":true,"key":"KrjoNOZdIP"},{"type":"text","value":", or even others yet to be developed...\nWe’re discussing this dream in the ","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"tuPnUY2WFg"},{"type":"link","url":"https://discourse.pangeo.io/t/new-working-group-for-distributed-array-computing/2734","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"children":[{"type":"text","value":"Pangeo Distributed Arrays Working Group","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"lIqrGncVG0"}],"urlSource":"https://discourse.pangeo.io/t/new-working-group-for-distributed-array-computing/2734","key":"ZrighomzZa"},{"type":"text","value":", so if this inspires you then please join us!","position":{"start":{"line":279,"column":1},"end":{"line":279,"column":1}},"key":"IuvpNmdaSL"}],"key":"Mi92ae5zdr"},{"type":"heading","depth":2,"position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"children":[{"type":"text","value":"Conclusion","position":{"start":{"line":282,"column":1},"end":{"line":282,"column":1}},"key":"bVSVavcheE"}],"identifier":"conclusion","label":"Conclusion","html_id":"conclusion","implicit":true,"key":"mR51HTx7ln"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":284,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"children":[{"type":"text","value":"Xarray can now wrap multiple chunked array backends.","position":{"start":{"line":284,"column":1},"end":{"line":284,"column":1}},"key":"abCwioacy3"}],"key":"dwNizZ38rP"},{"type":"listItem","spread":true,"position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"children":[{"type":"text","value":"Cubed is a serverless prototype which you can try out today.","position":{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},"key":"dkWwHK3CaR"}],"key":"MbeFcpjyxO"},{"type":"listItem","spread":true,"position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"children":[{"type":"text","value":"We hope this integration work leads to a range of new parallel backend options for users.","position":{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},"key":"WE0Wrs67cz"}],"key":"gahX25Tj6M"},{"type":"listItem","spread":true,"position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"text","value":"Please come and help out on the ","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"x7hU8stJxN"},{"type":"link","url":"https://github.com/tomwhite/cubed","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"text","value":"Cubed repository","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"fQYB50IJ49"}],"urlSource":"https://github.com/tomwhite/cubed","error":true,"key":"eLhUUcPZvQ"},{"type":"text","value":", and join the ","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"toV8hZ88iL"},{"type":"link","url":"https://discourse.pangeo.io/t/new-working-group-for-distributed-array-computing/2734","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"text","value":"Distributed Arrays Working Group","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"JmQ1iwBFbk"}],"urlSource":"https://discourse.pangeo.io/t/new-working-group-for-distributed-array-computing/2734","key":"WXWUuCgBWu"},{"type":"text","value":"!","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"LXlE212771"}],"key":"A7XdV6TB7r"}],"key":"wJenaQZXmU"}],"key":"jwA9L6whz5"}],"key":"jsFJt77r9f"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","url":"/blog/2024/datatree","group":"2024"},"next":{"title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","url":"/blog/2023/dask-distributed","group":"2023"}}},"domain":"http://localhost:3000"},"project":{"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"title":"Welcome","thumbnail":"/build/profile-color-circle-098ce1dbdd1469313afcdeb609cd4bf4.png","authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","references":{"ttw":{"url":"https://book.the-turing-way.org"}},"toc":[{"file":"index.md"},{"file":"about.md"},{"children":[{"children":[{"pattern":"blog/2025/**{.ipynb,.md}"}],"title":"2025"},{"children":[{"pattern":"blog/2024/**{.ipynb,.md}"}],"title":"2024"},{"children":[{"pattern":"blog/2023/**{.ipynb,.md}"}],"title":"2023"},{"children":[{"pattern":"blog/2022/**{.ipynb,.md}"}],"title":"2022"},{"children":[{"pattern":"blog/2020/**{.ipynb,.md}"}],"title":"2020"},{"children":[{"pattern":"blog/2019/**{.ipynb,.md}"}],"title":"2019"}],"file":"blog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"about","title":"About me","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"blog","title":"Blog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":2,"title":"2025"},{"slug":"blog.2025.science-needs-a-social-network","title":"Science needs a social network for sharing big data","description":"","date":"2025-01-18","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["open-science","frost"],"level":3},{"level":2,"title":"2024"},{"slug":"blog.2024.datatree","title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","description":"","date":"2024-12-19","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science"],"level":3},{"level":2,"title":"2023"},{"slug":"blog.2023.cubed-xarray","title":"Cubed: Bounded-memory serverless array processing in xarray","description":"","date":"2023-06-01","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","dask","cubed","open-science"],"level":3},{"slug":"blog.2023.dask-distributed","title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","description":"","date":"2023-01-04","thumbnail":"/build/f8821db67c2a5f1f07b570e6bed342cc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","dask","open-science"],"level":3},{"level":2,"title":"2022"},{"slug":"blog.2022.easy-ipcc-datatree","title":"Easy IPCC part 1: Multi-Model Datatree","description":"","date":"2022-08-29","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science","climate-science","datatree"],"level":3},{"slug":"blog.2022.pint-xarray","title":"Unit-aware arithmetic in Xarray, via pint","description":"","date":"2022-08-30","thumbnail":"/build/undefined","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","pint","open-science","physical-units"],"level":3},{"level":2,"title":"2020"},{"slug":"blog.2020.covid19-model","title":"Coronavirus: The Simplest Model","description":"","date":"2020-03-20","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","modelling","covid-19"],"level":3},{"slug":"blog.2020.deep-pseudoscience","title":"The faulty science, doomism, and flawed conclusions of Deep Adaptation","description":"","date":"2020-07-14","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate-science","misinformation"],"level":3},{"slug":"blog.2020.oxford-divests","title":"Oxford University Divestment Explained","description":"","date":"2020-04-22","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate","oxford"],"level":3},{"level":2,"title":"2019"},{"slug":"blog.2019.theconversation-fusion","title":"Nuclear Fusion: too late for the climate","description":"","date":"2019-09-30","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["fusion","energy","climate"],"level":3}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/build/manifest-B4831781.js";
import * as route0 from "/build/root-QGLRP2PL.js";
import * as route1 from "/build/routes/$-7JYT5576.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/build/entry.client-UNPC4GT3.js");</script></body></html>
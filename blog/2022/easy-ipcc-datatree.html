<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Easy IPCC part 1: Multi-Model Datatree - Welcome</title><meta property="og:title" content="Easy IPCC part 1: Multi-Model Datatree - Welcome"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><meta name="image" content="/build/d1061528b3e546e0e4d674dab265d6e2.png"/><meta property="og:image" content="/build/d1061528b3e546e0e4d674dab265d6e2.png"/><link rel="stylesheet" href="/build/_assets/app-HG4THSM4.css"/><link rel="stylesheet" href="/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Tom Nicholas</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"><div class="relative inline-block mx-2 grow-0"><a class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" href="/about">About</a></div><div class="relative inline-block mx-2 grow-0"><a aria-current="page" class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 border-b border-stone-200" href="/blog">Blog</a></div></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3iop:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode." aria-label="Toggle theme between light and dark mode."><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white"><a class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded" href="/about">About</a><a aria-current="page" class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded active" href="/blog">Blog</a></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="Welcome" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/">Welcome</a><a title="About me" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/about">About me</a><div data-state="open" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Blog" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 active" href="/blog">Blog</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rfd8p:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:Rfd8p:" class="pl-3 pr-[2px] collapsible-content"><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2025" class="block break-words rounded py-2 grow cursor-pointer">2025</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R6vd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R6vd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2024" class="block break-words rounded py-2 grow cursor-pointer">2024</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Ravd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Ravd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2023" class="block break-words rounded py-2 grow cursor-pointer">2023</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Revd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Revd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="open" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2022" class="block break-words rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 cursor-pointer">2022</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rivd8p:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:Rivd8p:" class="pl-3 pr-[2px] collapsible-content"><a title="Easy IPCC part 1: Multi-Model Datatree" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg bg-blue-300/30 active" href="/blog/2022/easy-ipcc-datatree">Easy IPCC part 1: Multi-Model Datatree</a><a title="Unit-aware arithmetic in Xarray, via pint" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/blog/2022/pint-xarray">Unit-aware arithmetic in Xarray, via pint</a></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2020" class="block break-words rounded py-2 grow cursor-pointer">2020</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmvd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmvd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2019" class="block break-words rounded py-2 grow cursor-pointer">2019</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rqvd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rqvd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://github.com/TomNicholas/tomnicholas.github.io" title="GitHub Repository: TomNicholas/tomnicholas.github.io" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rd4fop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Easy IPCC part 1: Multi-Model Datatree</h1><header class="mt-4 not-prose"><div><span class="font-semibold text-sm inline-block"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3kfop:" data-state="closed">Tom Nicholas</button><a class="ml-1" href="https://orcid.org/0000-0002-2176-0530" target="_blank" rel="noopener noreferrer" title="ORCID (Open Researcher and Contributor ID)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1rem" height="1rem" class="inline-block text-gray-400 hover:text-[#A9C751] -translate-y-[0.1em]"><path d="M21.8 12c0 5.4-4.4 9.8-9.8 9.8S2.2 17.4 2.2 12 6.6 2.2 12 2.2s9.8 4.4 9.8 9.8zM8.2 5.8c-.4 0-.8.3-.8.8s.3.8.8.8.8-.4.8-.8-.3-.8-.8-.8zm2.3 9.6h1.2v-6h1.8c2.3 0 3.3 1.4 3.3 3s-1.5 3-3.3 3h-3v1.1H9V8.3H7.7v8.2h5.9c3.3 0 4.5-2.2 4.5-4.1s-1.2-4.1-4.3-4.1h-3.2l-.1 7.1z"></path></svg></a></span></div></header><div class="flex mt-2 text-sm font-light"><time dateTime="2022-08-29" class="">August 29, 2022</time></div></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><h2 id="easy-ipcc-part-1-multi-model-datatree" class="relative group"><span class="heading-text">Easy IPCC Part 1: Multi-Model Datatree</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#easy-ipcc-part-1-multi-model-datatree" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p><em>By Tom Nicholas (<a target="_blank" rel="noreferrer" href="https://github.com/TomNicholas" class=""><span class="text-yellow-600" title="Citation Not Found"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1rem" height="1rem" class="inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg>TomNicholas</span></a>) and Julius Busecke (<a target="_blank" rel="noreferrer" href="https://github.com/jbusecke" class=""><span class="text-yellow-600" title="Citation Not Found"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1rem" height="1rem" class="inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"></path></svg>jbusecke</span></a>)</em></p><p>(Originally posted on the <a target="_blank" rel="noreferrer" href="https://medium.com/pangeo/easy-ipcc-part-1-multi-model-datatree-469b87cf9114" class="">Pangeo Medium blog</a>)</p><p>In this series of blog posts we aim to quickly reproduce a panel from one of the <a href="https://github.com/BrodiePearson/IPCC_AR6_Chapter9_Figures/blob/main/Plotting_code_and_data/Fig9_03_SST/Fig9_03_SST.png" class="italic" target="_blank" rel="noreferrer" data-state="closed">key figures (fig. 9.3a)</a> of the <a target="_blank" rel="noreferrer" href="https://www.ipcc.ch/report/ar6/wg3/" class="">IPCC AR6 Report</a> from the raw climate model simulation data, using Pangeo cloud-native tools. This figure is critical: it literally shows our best estimate of the future state of the climate given certain choices by humanity.</p><img id="DqAlIC0UjE" style="margin:0 auto" src="/build/d1061528b3e546e0e4d674dab265d6e2.png" data-canonical-url="https://i.imgur.com/bhdCM9K.png"/><p>This figure shows both the historical and projected global average temperature of the ocean’s surface, as used in different <a target="_blank" rel="noreferrer" href="https://www.gfdl.noaa.gov/climate-modeling/" class="">Global Climate Models</a>. The projections are for possible trajectories of greenhouse gas emissions based on various socio-economic pathways (<cite class="" data-state="closed"><a href="https://doi.org/10.1016/j.gloenvcha.2015.01.004" target="_blank" rel="noreferrer" class="hover-link">Neill et al. 2017</a></cite>).</p><p>However, the process of creating it is potentially very cumbersome: it involves downloading large files, idiosyncratic code to produce intermediate datafiles, and lots more code to finally plot the results. The open sharing of <a target="_blank" rel="noreferrer" href="https://github.com/BrodiePearson/IPCC_AR6_Chapter9_Figures" class="">code used for the latest IPCC report</a> inspired us to try to make this process easier for everyone.</p><p>The numerical model output produced under the <a target="_blank" rel="noreferrer" href="https://www.wcrp-climate.org/wgcm-cmip/wgcm-cmip6" class="">Coupled Model Intercomparison Project 6 (CMIP6)</a> output is publicly available (distributed by the <a target="_blank" rel="noreferrer" href="https://esgf.llnl.gov" class="">Earth System Grid Federation</a>), so the scientific community should be able to reproduce this plot from scratch, and then build upon it as the underlying science advances.</p><p>Due to recent advances in software and the migration of the CMIP6 data archive into the cloud, we are now able to produce this panel rapidly from raw data using easily available public cloud computing.</p><p>Working with many CMIP6 datasets at once can be cumbersome because each model has different size and coordinates. In this blogpost we highlight the new <a target="_blank" rel="noreferrer" href="https://github.com/xarray-contrib/datatree" class=""><code>xarray-datatree</code></a> package, which helps organize the many datasets in CMIP6 into a single tree-like data structure.</p><p>There have been other attempts to <a target="_blank" rel="noreferrer" href="https://docs.esmvaltool.org/en/latest/#" class="">analyze</a>, <a target="_blank" rel="noreferrer" href="https://aospy.readthedocs.io/en/stable/" class="">organize</a>, and <a target="_blank" rel="noreferrer" href="https://interactive-atlas.ipcc.ch/documentation" class="">visualize</a> multi-model experiments, but here we prioritize modularity, flexibility, extensibility, and using domain-agnostic tools.</p><p>We were able to reproduce parts of this graph in a <a target="_blank" rel="noreferrer" href="https://www.youtube.com/watch?v=7niNfs3ZpfQ" class="">live demo</a> at <a target="_blank" rel="noreferrer" href="https://www.scipy2022.scipy.org" class="">Scipy 2022</a> using cloud-hosted data, but felt we could do it much more succinctly with datatree!</p><h3 id="getting-the-data" class="relative group"><span class="heading-text">Getting the data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#getting-the-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>A key component of this workflow is having the large CMIP6 datasets available to open near-instantly from a public cloud store. The <a target="_blank" rel="noreferrer" href="https://pangeo-data.github.io/pangeo-cmip6-cloud/" class="">Pangeo/ESGF Cloud Data Working Group</a> maintains <a target="_blank" rel="noreferrer" href="https://ieeexplore.ieee.org/document/9354557/" class="">Analysis-Ready Cloud-Optimized</a> versions of a large part of the CMIP6 archive as <a target="_blank" rel="noreferrer" href="https://zarr.readthedocs.io/en/stable/" class="">Zarr</a> stores as public datasets both on <a target="_blank" rel="noreferrer" href="https://cloud.google.com/blog/products/data-analytics/new-climate-model-data-now-google-public-datasets" class="">Google Cloud Storage</a> and <a target="_blank" rel="noreferrer" href="https://registry.opendata.aws/cmip6/" class="">Amazon S3</a>. (This alone is a huge advancement for open science, but just a part of what we’re showing today.)</p><p>For the sake of demonstration we will load a small subset of sea surface temperature data for three models . We’ll load both the historical baseline, as well as the SSP1.26 (“best case”) and SSP5.85 (“worst case”) future socio-economic pathways: a total of 9 datasets. (We’ll tackle scaling up to all the available data in a future blog post.)</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import xarray as xr
xr.set_options(keep_attrs=True)
import gcsfs
from xmip.preprocessing import rename_cmip6

cmip_stores = {
&#x27;IPSL-CM6A-LR/historical&#x27;:  &#x27;gs://cmip6/CMIP6/CMIP/IPSL/IPSL-CM6A-LR/historical/r4i1p1f1/Omon/tos/gn/v20180803/&#x27;,
&#x27;MPI-ESM1-2-LR/historical&#x27;: &#x27;gs://cmip6/CMIP6/CMIP/MPI-M/MPI-ESM1-2-LR/historical/r4i1p1f1/Omon/tos/gn/v20190710/&#x27;,
&#x27;CESM2/historical&#x27;:         &#x27;gs://cmip6/CMIP6/CMIP/NCAR/CESM2/historical/r4i1p1f1/Omon/tos/gn/v20190308/&#x27;,
&#x27;IPSL-CM6A-LR/ssp126&#x27;:      &#x27;gs://cmip6/CMIP6/ScenarioMIP/IPSL/IPSL-CM6A-LR/ssp126/r4i1p1f1/Omon/tos/gn/v20191121/&#x27;,
&#x27;IPSL-CM6A-LR/ssp585&#x27;:      &#x27;gs://cmip6/CMIP6/ScenarioMIP/IPSL/IPSL-CM6A-LR/ssp585/r4i1p1f1/Omon/tos/gn/v20191122/&#x27;,
&#x27;MPI-ESM1-2-LR/ssp126&#x27;:     &#x27;gs://cmip6/CMIP6/ScenarioMIP/MPI-M/MPI-ESM1-2-LR/ssp126/r4i1p1f1/Omon/tos/gn/v20190710/&#x27;,
&#x27;MPI-ESM1-2-LR/ssp585&#x27;:     &#x27;gs://cmip6/CMIP6/ScenarioMIP/MPI-M/MPI-ESM1-2-LR/ssp585/r4i1p1f1/Omon/tos/gn/v20190710/&#x27;,
&#x27;CESM2/ssp126&#x27;:             &#x27;gs://cmip6/CMIP6/ScenarioMIP/NCAR/CESM2/ssp126/r4i1p1f1/Omon/tos/gn/v20200528/&#x27;,
&#x27;CESM2/ssp585&#x27;:             &#x27;gs://cmip6/CMIP6/ScenarioMIP/NCAR/CESM2/ssp585/r4i1p1f1/Omon/tos/gn/v20200528/&#x27;
}

datasets = {
    name: rename_cmip6(xr.open_dataset(path, engine=&quot;zarr&quot;)).load()
    for name, path in cmip_stores.items()
}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><blockquote><p><strong>CMIP vocabulary explainer</strong>:
The words “model” and “experiment” have a specific meaning in CMIP lingo. Within CMIP there are many different datasets produced by various modeling centers around the world. Each of these centers has one or more <em>model</em> setups (<code>source_id</code> in official CMIP language), which are used to produce multiple simulations. For example the simulations for <code>IPSL-CM6A-LR</code> are all produced by the <a target="_blank" rel="noreferrer" href="https://www.ipsl.fr/en/home-en/" class="">Institut Pierre-Simon Laplace</a> in France.
Different simulations are run under certain protocols which prescribe conditions (e.g. greenhouse gas forcings), and these are called <em>experiments</em>. The experiments we’ve loaded here are <code>&#x27;historical&#x27;</code>, <code>&#x27;ssp126&#x27;</code> &amp; <code>&#x27;ssp585&#x27;</code>.</p></blockquote><p>These nine datasets are all similar, e.g. they have the same dimension names (freshly cleaned thanks to another package of ours - <a target="_blank" rel="noreferrer" href="https://github.com/jbusecke/xMIP" class="">xMIP</a>) and variable names, but they have different sizes along dimensions: horizontal dimensions differ due to varying resolution and time dimensions differ because the historical baseline run is longer than the scenarios by a varying amount.</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(datasets[&quot;CESM2/ssp585&quot;].sizes)
print(datasets[&quot;IPSL-CM6A-LR/ssp585&quot;].sizes)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Frozen({&#x27;y&#x27;: 384, &#x27;x&#x27;: 320, &#x27;vertex&#x27;: 4, &#x27;time&#x27;: 1032, &#x27;bnds&#x27;: 2})
Frozen({&#x27;y&#x27;: 332, &#x27;x&#x27;: 362, &#x27;vertex&#x27;: 4, &#x27;time&#x27;: 1032, &#x27;bnds&#x27;: 2})</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>For instance the <code>&quot;x&quot; and &quot;y&quot;</code> dimensions here (roughly corresponding to latitude and longitude) do not match between the CESM2 model and the IPSL model. Hence they <em>cannot be combined</em> into a single N-dimensional array or a single <a target="_blank" rel="noreferrer" href="https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html" class=""><code>xarray.Dataset</code></a>!</p><h3 id="introducing-datatree" class="relative group"><span class="heading-text">Introducing datatree</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#introducing-datatree" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The CMIP6 datasets are clearly related, however. They have a hierarchical order - grouped by model and then by experiment. Each dataset also contains very similar variables. Wouldn’t it be nice to treat them all as one related set of data, and analyze them together?</p><p>The <a target="_blank" rel="noreferrer" href="https://github.com/xarray-contrib/datatree" class="">xarray-datatree</a> package enables this. It arranges these related datasets into a <code>Datatree</code> object, allowing them to be manipulated together. A <code>DataTree</code> object can be thought of as a recursive dictionary of <code>xarray.Dataset</code> objects, with additional methods for performing computations on the entire tree at once. You can also think of it as an in-memory representation of an entire netCDF file, including all netCDF groups. Because it is in-memory your analysis does not require saving intermediate files to disk.</p><blockquote><p>Note: The pip-installable package <code>xarray-datatree</code> provides the class <code>DataTree</code>, importable from the module <code>datatree</code>. From here on we will refer interchangeably to these as just “datatree”.</p></blockquote><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from datatree import DataTree

dt = DataTree.from_dict(datasets)

print(f&quot;Size of data in tree = {dt.nbytes / 1e9 :.2f} GB&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Size of data in tree = 4.89 GB</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(dt)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">DataTree(&#x27;None&#x27;, parent=None)
├── DataTree(&#x27;IPSL-CM6A-LR&#x27;)
│   ├── DataTree(&#x27;historical&#x27;)
│   │       Dimensions:      (y: 332, x: 362, vertex: 4, time: 1980, bnds: 2)
│   │       Coordinates:
│   │         * time         (time) object 1850-01-16 12:00:00 ... 2014-12-16 12:00:00
│   │       Dimensions without coordinates: y, x, vertex, bnds
│   │       Data variables:
│   │           area         (y, x) float32 16.0 16.0 16.0 ... 1.55e+08 3.18e+07 3.18e+07
│   │           lat_bounds   (y, x, vertex) float32 -84.21 -84.21 -84.21 ... 50.11 49.98
│   │           lon_bounds   (y, x, vertex) float32 72.5 72.5 72.5 72.5 ... 73.0 72.95 73.0
│   │           lat          (y, x) float32 -84.21 -84.21 -84.21 ... 50.23 50.01 50.01
│   │           lon          (y, x) float32 72.5 73.5 74.5 75.5 ... 73.05 73.04 73.0 72.99
│   │           time_bounds  (time, bnds) object 1850-01-01 00:00:00 ... 2015-01-01 00:00:00
│   │           tos          (time, y, x) float32 nan nan nan nan nan ... nan nan nan nan
│   │       Attributes: (12/54)
│   │           CMIP6_CV_version:       cv=6.2.3.5-2-g63b123e
│   │           Conventions:            CF-1.7 CMIP-6.2
│   │           EXPID:                  historical
│   │           NCO:                    &quot;4.6.0&quot;
│   │           activity_id:            CMIP
│   │           branch_method:          standard
│   │           ...                     ...
│   │           tracking_id:            hdl:21.14100/dc824b97-b288-4ec0-adde-8dbcfa3b0095
│   │           variable_id:            tos
│   │           variant_label:          r4i1p1f1
│   │           status:                 2019-11-09;created;by nhn2@columbia.edu
│   │           netcdf_tracking_ids:    hdl:21.14100/dc824b97-b288-4ec0-adde-8dbcfa3b0095
│   │           version_id:             v20180803
│   ├── DataTree(&#x27;ssp126&#x27;)
│   │       Dimensions:      (y: 332, x: 362, vertex: 4, time: 1032, bnds: 2)
│   │       Coordinates:
│   │         * time         (time) object 2015-01-16 12:00:00 ... 2100-12-16 12:00:00
│   │       Dimensions without coordinates: y, x, vertex, bnds
│   │       Data variables:
│   │           area         (y, x) float32 16.0 16.0 16.0 ... 1.55e+08 3.18e+07 3.18e+07
│   │           lat_bounds   (y, x, vertex) float32 -84.21 -84.21 -84.21 ... 50.11 49.98
│   │           lon_bounds   (y, x, vertex) float32 72.5 72.5 72.5 72.5 ... 73.0 72.95 73.0
│   │           lat          (y, x) float32 -84.21 -84.21 -84.21 ... 50.23 50.01 50.01
│   │           lon          (y, x) float32 72.5 73.5 74.5 75.5 ... 73.05 73.04 73.0 72.99
│   │           time_bounds  (time, bnds) object 2015-01-01 00:00:00 ... 2101-01-01 00:00:00
│   │           tos          (time, y, x) float32 nan nan nan nan nan ... nan nan nan nan
...</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>We created the whole tree in one go from our dictionary of nine datasets, using the keys of the dict to organize the resulting tree. <code>DataTree</code> objects are structured similarly to a UNIX filesystem, so a key in the dict such as <code>&#x27;IPSL-CM6A-LR/historical&#x27;</code> will create a node called <code>IPSL-CM6A-LR</code> and another child node below it called <code>&#x27;historical&#x27;</code>. This approach means the <code>DataTree.from_dict</code> method can create trees of arbitrary complexity from flat dictionaries.</p><blockquote><p>If instead we wanted to create the tree manually, you can do that by setting the <code>.children</code> attributes of each node explicitly, assigning other tree objects to build up a composite result.</p></blockquote><p>You can see that the resulting tree structure is grouped by model first, and then by the experiment. (This choice is somewhat arbitrary and we could have chosen to group first by experiment and then model.)</p><blockquote><p>While we printed the string representation of the tree for this blog post, if you’re doing this in a jupyter notebook you will actually automatically get an interactive HTML representation of the tree, where each node is collapsible.</p></blockquote><p>We say that we have created one “tree”, where each “node” within that tree (optionally) contains the contents of exactly one <code>xarray.Dataset</code>, and also has a node name, a “parent” node, and can have any number of “child” nodes. For more information on the data model datatree uses, see <a target="_blank" rel="noreferrer" href="https://xarray-datatree.readthedocs.io/en/latest/data-structures.html" class="">the documentation</a>.</p><p>We can actually access nodes in the tree using path-like syntax too, for example</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(dt[&quot;/CESM2/ssp585&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">DataTree(&#x27;ssp585&#x27;, parent=&quot;CESM2&quot;)
    Dimensions:      (y: 384, x: 320, vertex: 4, time: 1032, bnds: 2)
    Coordinates:
      * y            (y) int32 1 2 3 4 5 6 7 8 9 ... 377 378 379 380 381 382 383 384
      * x            (x) int32 1 2 3 4 5 6 7 8 9 ... 313 314 315 316 317 318 319 320
      * time         (time) object 2015-01-15 13:00:00 ... 2100-12-15 12:00:00
    Dimensions without coordinates: vertex, bnds
    Data variables:
        lat          (y, x) float64 -79.22 -79.22 -79.22 -79.22 ... 72.2 72.19 72.19
        lat_bounds   (y, x, vertex) float32 -79.49 -79.49 -78.95 ... 72.41 72.41
        lon          (y, x) float64 320.6 321.7 322.8 323.9 ... 318.9 319.4 319.8
        lon_bounds   (y, x, vertex) float32 320.0 321.1 321.1 ... 320.0 320.0 319.6
        time_bounds  (time, bnds) object 2015-01-01 02:00:00.000003 ... 2101-01-0...
        tos          (time, y, x) float32 nan nan nan nan nan ... nan nan nan nan
    Attributes: (12/48)
        Conventions:            CF-1.7 CMIP-6.2
        activity_id:            ScenarioMIP
        branch_method:          standard
        branch_time_in_child:   735110.0
        branch_time_in_parent:  735110.0
        case_id:                1735
        ...                     ...
        tracking_id:            hdl:21.14100/68b741c9-b8f8-479d-b48c-6853b1c71e56...
        variable_id:            tos
        variant_info:           CMIP6 SSP5-8.5 experiments (2015-2100) with CAM6,...
        variant_label:          r4i1p1f1
        netcdf_tracking_ids:    hdl:21.14100/68b741c9-b8f8-479d-b48c-6853b1c71e56...
        version_id:             v20200528</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>You can see that every node is itself another <code>DataTree</code> object, i.e. the tree is a recursive data structure.</p><p>This structure not only allows the user full flexibility in how to set up and manipulate the tree, but it also behaves like a filesystem that people are already very familiar with.</p><p>But datatrees are not just a neat way to organize xarray datasets; they also allows us to operate on datasets in an intuitive way.</p><h3 id="timeseries" class="relative group"><span class="heading-text">Timeseries</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#timeseries" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>In this case the basic quantity we want to compute is a global mean of the ocean surface temperature. For this we can use the built-in <code>.mean()</code> method.</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">timeseries = dt.mean(dim=[&quot;x&quot;, &quot;y&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>This works exactly like the familiar xarray method, and averages the temperature values over the horizontal dimensions for <strong>each dataset on any level of the tree</strong>. :exploding_head:</p><p>All arguments are passed down, so this <code>.mean</code> will work so long as the data in each node of the tree has a <code>&quot;x&quot;</code> and a <code>&quot;y&quot;</code> dimension to average over.</p><p>Lets confirm our results by plotting a single dataset from the new tree of timeseries:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">timeseries[&#x27;/IPSL-CM6A-LR/ssp585&#x27;].ds[&#x27;tos&#x27;].plot()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><img id="lNRk5qlJqP" style="margin:0 auto" src="/build/e2f4972e07d860158e4a23fefce35f5e.png" data-canonical-url="https://i.imgur.com/JSXAamv.png"/><p>And indeed, we get a nice timeseries. Once you select a node, you get back an <code>xarray.Dataset</code> using <code>.ds</code> and can do all the good stuff you already know (like plotting).</p><p>For comparison, here is the relevant part of <a href="https://github.com/jbusecke/presentation_scipy_2022_cmip/blob/main/scipy2022_demo.ipynb" class="italic" target="_blank" rel="noreferrer" data-state="closed">Julius’ code</a> from the Scipy 2022 live demo that did not use datatree:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">timeseries_hist_datasets = []
timeseries_ssp126_datasets = []
timeseries_ssp245_datasets = []
timeseries_ssp370_datasets = []
timeseries_ssp585_datasets = []

for k,ds in data_timeseries.items():
    # Separate experiments
    out = ds.convert_calendar(&#x27;standard&#x27;)
    out = out.sel(time=slice(&#x27;1850&#x27;, &#x27;2100&#x27;))# cut extended runs
    out = out.assign_coords(source_id=ds.source_id)
    if ds.experiment_id == &#x27;historical&#x27;:
        # CMIP
        if len(out.time)==1980:
            timeseries_hist_datasets.append(out)
        else:
            print(f&quot;found {len(ds.time)} for {k}&quot;)
    else:
        #scenarioMIP
        if len(out.time)!=1032:
            print(f&quot;found {len(out.time)} for {k}&quot;)
            # print(ds.time)
        else:
            if ds.experiment_id == &#x27;ssp126&#x27;:
                timeseries_ssp126_datasets.append(out)
            elif ds.experiment_id == &#x27;ssp245&#x27;:
                timeseries_ssp245_datasets.append(out)
            elif ds.experiment_id == &#x27;ssp370&#x27;:
                timeseries_ssp370_datasets.append(out)
            elif ds.experiment_id == &#x27;ssp585&#x27;:
                timeseries_ssp585_datasets.append(out)            

concat_kwargs = dict(
    dim=&#x27;source_id&#x27;,
    join=&#x27;override&#x27;,
    compat=&#x27;override&#x27;,
    coords=&#x27;minimal&#x27;
) 
timeseries_hist = xr.concat(timeseries_hist_datasets, **concat_kwargs)
timeseries_ssp126 = xr.concat(timeseries_ssp126_datasets, **concat_kwargs)
timeseries_ssp245 = xr.concat(timeseries_ssp245_datasets, **concat_kwargs)
timeseries_ssp370 = xr.concat(timeseries_ssp370_datasets, **concat_kwargs)
timeseries_ssp585 = xr.concat(timeseries_ssp585_datasets, **concat_kwargs)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>😬 Definitely not as nice as a one-liner...</p><p>It’s worth understanding what happened under the hood when calling <code>.mean()</code> on the tree. We can reproduce the behavior of <code>.mean()</code> by passing a simple function to the built-in <code>.map_over_subtree()</code> method.</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def mean_over_space(ds):
    return ds.mean(dim=[&quot;x&quot;, &quot;y&quot;])

dt.map_over_subtree(mean_over_space)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>The function <code>mean_over_space</code> that we supplied gets applied to the data in each and every node in the tree automatically. This will return the exact same result as above, but with this method users can map arbitrary functions over each dataset in the tree, as long as they consume and produce <code>xarray.Datasets</code>. You can even <a href="https://github.com/xarray-contrib/datatree/blob/f267f95eac6be7fef072bf0d40af06093c13c8f6/datatree/mapping.py#L106" class="italic" target="_blank" rel="noreferrer" data-state="closed">map functions with multiple inputs and outputs</a>, but that is an advanced use case which we will use at the end of this post.</p><p>You can already see that this enables very intuitive mapping of custom functions without lengthy writing of loops.</p><h3 id="saving-output" class="relative group"><span class="heading-text">Saving output</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#saving-output" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Before we go further, we might want to save our aggregated timeseries data to use later. <code>DataTree</code> supports saving to and loading from both netCDF files and Zarr stores.</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from datatree import open_datatree

timeseries.to_zarr(&#x27;cmip_timeseries&#x27;)  # or netcdf, with any group structure

roundtrip = open_datatree(&#x27;cmip_timeseries&#x27;, engine=&quot;zarr&quot;)
print(roundtrip)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">DataTree(&#x27;None&#x27;, parent=None)
├── DataTree(&#x27;CESM2&#x27;)
│   ├── DataTree(&#x27;historical&#x27;)
│   │       Dimensions:      (vertex: 4, time: 1980, bnds: 2)
│   │       Coordinates:
│   │         * time         (time) object 1850-01-15 12:59:59.999997 ... 2014-12-15 12:0...
│   │       Dimensions without coordinates: vertex, bnds
│   │       Data variables:
│   │           lat          float64 ...
│   │           lat_bounds   (vertex) float32 ...
│   │           lon          float64 ...
│   │           lon_bounds   (vertex) float32 ...
│   │           time_bounds  (time, bnds) object ...
│   │           tos          (time) float32 ...
...</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Nodes are saved as netCDF or Zarr groups, meaning that you can now work smoothly with xarray and multi-group files, a <a href="https://github.com/pydata/xarray/issues/1092" class="italic" target="_blank" rel="noreferrer" data-state="closed">long-term sticking point</a> for many xarray users. Being able to now work with such files without leaving xarray or python helps retains backwards compatibility and portability.</p><h3 id="calculating-anomalies" class="relative group"><span class="heading-text">Calculating anomalies</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#calculating-anomalies" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><blockquote><p><strong>Note on Climate Anomalies</strong>: Coupled climate models often exhibit ‘biases’, which means that the ocean temperatures at the starting point for e.g. the historical and future experiments will differ from model to model. For the purpose of this scientific analysis however we are most interested in the <em>relative change from that starting point</em> when a forcing (e.g. increased greenhouse gases) is applied. Conventionally we compute the anomaly relative to a given reference value. In this case the reference value is the global ocean temperature averaged over the years 1950-1980 in the corresponding historical experiment. Therefore we want to <strong>compute and subtract this reference value for each model separately</strong> so that each model-specific bias is removed.</p></blockquote><p>In practice we need to iterate over each model, pick the historical experiment, select the base period, and average it. We then subtract that resulting value from <em>all</em> experiments of the corresponding model and rearrange the resulting anomaly timeseries into a new tree.</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">anomaly = DataTree()
for model_name, model in timeseries.children.items():
    
    # model-specific base period as an xarray.Dataset
    base_period = model[&quot;historical&quot;].ds.sel(time=slice(&#x27;1950&#x27;,&#x27;1980&#x27;)).mean(&#x27;time&#x27;)
    
    anomaly[model_name] = model - base_period   # subtree - Dataset</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>We have used a few features of datatree here. We loop over the <code>.children</code> attribute of the <code>DataTree</code>, which iterates through each sub-node in turn in a dictionary-like manner.</p><p>We find the reference value (<code>base_period</code>) by extracting the data in a node as an <code>xarray.Dataset</code> via <code>.ds</code>, giving us access to all of xarray’s normal API for computations.</p><p>Our tree of results (<code>anomaly</code>) is constructed by creating an empty tree and then adding branches to this new tree whilst we loop through models.</p><p>In the final line of this <code>for</code> loop we have subtracted an <code>xarray.Dataset</code> from a <code>DataTree</code> - this operation works node-wise, i.e. the dataset is subtracted from every data-containing node in the tree.</p><blockquote><p>Note: In general, we could imagine having rules for operations involving any number of trees of <em>any node structure</em>, analogous to numpy array broadcasting. This would make the above anomaly calculation much more succinct. However at the moment, datatree only supports <code>tree @ dataset</code>-like operations and <code>tree @ tree</code>-like operations, where the trees <em>must have the same node structure</em>.</p></blockquote><h3 id="plotting" class="relative group"><span class="heading-text">Plotting</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plotting" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Alright, so the final step here is to actually plot the data. We can use the <code>map_over_subtree</code> approach to plot each individual simulation onto the same matplotlib axes:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import matplotlib.pyplot as plt

from datatree import map_over_subtree

fig, ax = plt.subplots()


@map_over_subtree
def plot_temp(ds, original_ds):
    
    if ds:
        label = f&#x27;{original_ds.attrs[&quot;source_id&quot;]} - {original_ds.attrs[&quot;experiment_id&quot;]}&#x27;
        ds[&#x27;tos&#x27;].rolling(time=2*12).mean().plot(ax=ax, label=label)

    return ds

   
plot_temp(anomaly, timeseries)
ax.legend()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><img id="rXNK1OgaaG" style="margin:0 auto" src="/build/4a5524f79c227b975c338a7ce040484b.png" data-canonical-url="https://i.imgur.com/C9KwzVS.png"/><p>For this we created a matplotlib figure and axis and then used the built-in xarray plotting capability to add each timeseries to the existing <code>matplotlib.Axes</code> object.</p><p>Instead of using the <code>.map_over_subtree</code> method on the <code>DataTree</code> class, we instead used <code>map_over_subtree</code> as a function decorator, which promoted <code>plot_temp</code> to a function that will act over all nodes of any given tree. This decorator is happy to map over multiple trees simultaneously, which we used to extract the metadata for labelling each timeseries.</p><blockquote><p>Note: The way we extracted this metadata for plotting was a little awkward - we can imagine improving this in future versions of datatree.</p></blockquote><p>The fact that we operate on an xarray dataset also allows us to convieniently smooth the timeseries (by a 2 year rolling mean) to remove the seasonal cycle.</p><p>Looking at the figure produced above, we’ve successfully replicated the basic features of the IPCC plot that we wanted! And it took us very few lines of code overall, especially compared to how it’s often done. In future posts we will improve this figure, adding more data and maybe making it interactive.</p><p>(Eagle-eyed climate scientist readers will have noticed that our figure is not actually quite correct - we forgot to correctly weight our temperature averages by the areas of the grid cells in each model! We will deal with this subtlety and other more complex custom aggregations in a future blog post.)</p><h3 id="takeaways" class="relative group"><span class="heading-text">Takeaways</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#takeaways" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Datatree is a general tool. Whilst here we used it on CMIP6 data, we learnt about capabilities that might be useful in other projects. We saw that datatree can:</p><ul><li><strong>Organize heterogeneous data</strong></li><li><strong>Seamlessly extend xarray’s functionality</strong></li><li><strong>Handle I/O with nested groups</strong></li><li><strong>Apply operations over whole trees</strong></li><li><strong>Perform more complex and custom operations</strong></li><li><strong>Retain fine-grained control</strong></li><li><strong>Reduce overall lines of code</strong></li></ul><h3 id="future" class="relative group"><span class="heading-text">Future</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#future" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>This blogpost is the first in a series. We plan to write more to discuss:</p><ul><li>Using <a target="_blank" rel="noreferrer" href="https://github.com/intake/intake" class="">intake</a> with datatree, where the trees could act like in-memory catalogs,</li><li>Suporting more complex aggregation operations, such as using <code>.weighted</code> to weight an operation on one tree with weights from another tree,</li><li>Scaling out to a much larger set of CMIP6 data with dask,</li><li>Quick plotting of data in a whole tree, maybe even making it interactive.</li></ul><div></div><section id="references" class="article-grid subgrid-gap col-screen"><div><header class="text-lg font-semibold text-stone-900 dark:text-white group">References<a class="no-underline text-inherit hover:text-inherit ml-2 select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#references" title="Link to References" aria-label="Link to References">¶</a></header></div><div class="pl-3 mb-8 text-xs text-stone-500 dark:text-stone-300"><ol><li class="break-words" id="cite-O_Neill_2017">O’Neill, B. C., Kriegler, E., Ebi, K. L., Kemp-Benedict, E., Riahi, K., Rothman, D. S., van Ruijven, B. J., van Vuuren, D. P., Birkmann, J., Kok, K., Levy, M., & Solecki, W. (2017). The roads ahead: Narratives for shared socioeconomic pathways describing world futures in the 21st century. <i>Global Environmental Change</i>, <i>42</i>, 169–180. <a target="_blank" rel="noreferrer" href="https://doi.org/10.1016/j.gloenvcha.2015.01.004">10.1016/j.gloenvcha.2015.01.004</a></li></ol></div></section><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/blog/2023/dask-distributed"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">2023</div>Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/blog/2022/pint-xarray"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">2022</div>Unit-aware arithmetic in Xarray, via pint</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/build/_shared/chunk-IZFMW3M4.js"/><link rel="modulepreload" href="/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/build/_shared/chunk-CPTH56EW.js"/><link rel="modulepreload" href="/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/build/_shared/chunk-S4SWV34C.js"/><link rel="modulepreload" href="/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/build/root-QGLRP2PL.js"/><link rel="modulepreload" href="/build/_shared/chunk-CB3BH7WY.js"/><link rel="modulepreload" href="/build/routes/$-7JYT5576.js"/><script>window.__remixContext = {"url":"/blog/2022/easy-ipcc-datatree","state":{"loaderData":{"root":{"config":{"version":1,"myst":"1.3.25","options":{"favicon":"/build/profile-color-circle-71cab2edab855c80cc47a3521448bb04.png","logo_text":"Tom Nicholas","folders":true},"nav":[{"title":"About","url":"/about"},{"title":"Blog","url":"/blog"}],"actions":[],"projects":[{"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"title":"Welcome","thumbnail":"/build/profile-color-circle-a6e893ac44e4d6b0fed0aac0fd76d967.png","authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","references":{"ttw":{"url":"https://book.the-turing-way.org"}},"toc":[{"file":"index.md"},{"file":"about.md"},{"children":[{"children":[{"pattern":"blog/2025/**{.ipynb,.md}"}],"title":"2025"},{"children":[{"pattern":"blog/2024/**{.ipynb,.md}"}],"title":"2024"},{"children":[{"pattern":"blog/2023/**{.ipynb,.md}"}],"title":"2023"},{"children":[{"pattern":"blog/2022/**{.ipynb,.md}"}],"title":"2022"},{"children":[{"pattern":"blog/2020/**{.ipynb,.md}"}],"title":"2020"},{"children":[{"pattern":"blog/2019/**{.ipynb,.md}"}],"title":"2019"}],"file":"blog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"about","title":"About me","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"blog","title":"Blog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":2,"title":"2025"},{"slug":"blog.2025.science-needs-a-social-network","title":"Science needs a social network for sharing big data","description":"","date":"2025-01-18","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["open-science","frost"],"level":3},{"level":2,"title":"2024"},{"slug":"blog.2024.datatree","title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","description":"","date":"2024-12-19","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science"],"level":3},{"level":2,"title":"2023"},{"slug":"blog.2023.cubed-xarray","title":"Cubed: Bounded-memory serverless array processing in xarray","description":"","date":"2023-06-01","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","dask","cubed","open-science"],"level":3},{"slug":"blog.2023.dask-distributed","title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","description":"","date":"2023-01-04","thumbnail":"/build/f8821db67c2a5f1f07b570e6bed342cc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","dask","open-science"],"level":3},{"level":2,"title":"2022"},{"slug":"blog.2022.easy-ipcc-datatree","title":"Easy IPCC part 1: Multi-Model Datatree","description":"","date":"2022-08-29","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science","climate-science","datatree"],"level":3},{"slug":"blog.2022.pint-xarray","title":"Unit-aware arithmetic in Xarray, via pint","description":"","date":"2022-08-30","thumbnail":"/build/undefined","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","pint","open-science","physical-units"],"level":3},{"level":2,"title":"2020"},{"slug":"blog.2020.covid19-model","title":"Coronavirus: The Simplest Model","description":"","date":"2020-03-20","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","modelling","covid-19"],"level":3},{"slug":"blog.2020.deep-pseudoscience","title":"The faulty science, doomism, and flawed conclusions of Deep Adaptation","description":"","date":"2020-07-14","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate-science","misinformation"],"level":3},{"slug":"blog.2020.oxford-divests","title":"Oxford University Divestment Explained","description":"","date":"2020-04-22","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate","oxford"],"level":3},{"level":2,"title":"2019"},{"slug":"blog.2019.theconversation-fusion","title":"Nuclear Fusion: too late for the climate","description":"","date":"2019-09-30","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["fusion","energy","climate"],"level":3}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static"},"routes/$":{"config":{"version":1,"myst":"1.3.25","options":{"favicon":"/build/profile-color-circle-71cab2edab855c80cc47a3521448bb04.png","logo_text":"Tom Nicholas","folders":true},"nav":[{"title":"About","url":"/about"},{"title":"Blog","url":"/blog"}],"actions":[],"projects":[{"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"title":"Welcome","thumbnail":"/build/profile-color-circle-a6e893ac44e4d6b0fed0aac0fd76d967.png","authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","references":{"ttw":{"url":"https://book.the-turing-way.org"}},"toc":[{"file":"index.md"},{"file":"about.md"},{"children":[{"children":[{"pattern":"blog/2025/**{.ipynb,.md}"}],"title":"2025"},{"children":[{"pattern":"blog/2024/**{.ipynb,.md}"}],"title":"2024"},{"children":[{"pattern":"blog/2023/**{.ipynb,.md}"}],"title":"2023"},{"children":[{"pattern":"blog/2022/**{.ipynb,.md}"}],"title":"2022"},{"children":[{"pattern":"blog/2020/**{.ipynb,.md}"}],"title":"2020"},{"children":[{"pattern":"blog/2019/**{.ipynb,.md}"}],"title":"2019"}],"file":"blog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"about","title":"About me","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"blog","title":"Blog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":2,"title":"2025"},{"slug":"blog.2025.science-needs-a-social-network","title":"Science needs a social network for sharing big data","description":"","date":"2025-01-18","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["open-science","frost"],"level":3},{"level":2,"title":"2024"},{"slug":"blog.2024.datatree","title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","description":"","date":"2024-12-19","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science"],"level":3},{"level":2,"title":"2023"},{"slug":"blog.2023.cubed-xarray","title":"Cubed: Bounded-memory serverless array processing in xarray","description":"","date":"2023-06-01","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","dask","cubed","open-science"],"level":3},{"slug":"blog.2023.dask-distributed","title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","description":"","date":"2023-01-04","thumbnail":"/build/f8821db67c2a5f1f07b570e6bed342cc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","dask","open-science"],"level":3},{"level":2,"title":"2022"},{"slug":"blog.2022.easy-ipcc-datatree","title":"Easy IPCC part 1: Multi-Model Datatree","description":"","date":"2022-08-29","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science","climate-science","datatree"],"level":3},{"slug":"blog.2022.pint-xarray","title":"Unit-aware arithmetic in Xarray, via pint","description":"","date":"2022-08-30","thumbnail":"/build/undefined","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","pint","open-science","physical-units"],"level":3},{"level":2,"title":"2020"},{"slug":"blog.2020.covid19-model","title":"Coronavirus: The Simplest Model","description":"","date":"2020-03-20","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","modelling","covid-19"],"level":3},{"slug":"blog.2020.deep-pseudoscience","title":"The faulty science, doomism, and flawed conclusions of Deep Adaptation","description":"","date":"2020-07-14","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate-science","misinformation"],"level":3},{"slug":"blog.2020.oxford-divests","title":"Oxford University Divestment Explained","description":"","date":"2020-04-22","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate","oxford"],"level":3},{"level":2,"title":"2019"},{"slug":"blog.2019.theconversation-fusion","title":"Nuclear Fusion: too late for the climate","description":"","date":"2019-09-30","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["fusion","energy","climate"],"level":3}]}]},"page":{"version":1,"kind":"Notebook","sha256":"38562b66d2d818957ea85d070db20c42553826aaca2a92d4ebe7c1b41d76cb2e","slug":"blog.2022.easy-ipcc-datatree","location":"/blog/2022/easy-IPCC-datatree.md","dependencies":[],"frontmatter":{"title":"Easy IPCC part 1: Multi-Model Datatree","tags":["code","python","xarray","open-science","climate-science","datatree"],"date":"2022-08-29","kernelspec":{"name":"python3","display_name":"Python 3"},"authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"numbering":{"title":{"offset":2}},"edit_url":"https://github.com/TomNicholas/tomnicholas.github.io/blob/main/blog/2022/easy-IPCC-datatree.md","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","exports":[{"format":"md","filename":"easy-IPCC-datatree.md","url":"/build/easy-IPCC-datatree-56663538c69aad67d34aa458d0028fe4.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Easy IPCC Part 1: Multi-Model Datatree","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"zwd5R431VX"}],"identifier":"easy-ipcc-part-1-multi-model-datatree","label":"Easy IPCC Part 1: Multi-Model Datatree","html_id":"easy-ipcc-part-1-multi-model-datatree","implicit":true,"key":"eLEhVSQU8j"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"By Tom Nicholas (","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Kk4fecJTFN"},{"type":"link","url":"https://github.com/TomNicholas","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"cite","identifier":"tomnicholas","label":"TomNicholas","kind":"narrative","position":{"start":{"line":18,"column":20},"end":{"line":18,"column":32}},"error":"not found","key":"q0qLVojygE"}],"urlSource":"https://github.com/TomNicholas","error":true,"key":"TWjWrWnGvg"},{"type":"text","value":") and Julius Busecke (","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"aTwH0ivggv"},{"type":"link","url":"https://github.com/jbusecke","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"cite","identifier":"jbusecke","label":"jbusecke","kind":"narrative","position":{"start":{"line":18,"column":88},"end":{"line":18,"column":97}},"error":"not found","key":"zfDDOUsL8d"}],"urlSource":"https://github.com/jbusecke","error":true,"key":"bHLUvYsy2o"},{"type":"text","value":")","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"kbuqzr8S5Y"}],"key":"HniioyxhnL"}],"key":"GedN0Nit9S"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"(Originally posted on the ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"KjUG4I5Yh9"},{"type":"link","url":"https://medium.com/pangeo/easy-ipcc-part-1-multi-model-datatree-469b87cf9114","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Pangeo Medium blog","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"UZahH0m4gd"}],"urlSource":"https://medium.com/pangeo/easy-ipcc-part-1-multi-model-datatree-469b87cf9114","key":"KpjdLMCmAu"},{"type":"text","value":")","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"liDSlKBL4J"}],"key":"DeQ9An9k3V"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"In this series of blog posts we aim to quickly reproduce a panel from one of the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"b8SYcZyFAx"},{"type":"link","url":"https://github.com/BrodiePearson/IPCC_AR6_Chapter9_Figures/blob/main/Plotting_code_and_data/Fig9_03_SST/Fig9_03_SST.png","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"key figures (fig. 9.3a)","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"pZqSmUm3Qp"}],"urlSource":"https://github.com/BrodiePearson/IPCC_AR6_Chapter9_Figures/blob/main/Plotting_code_and_data/Fig9_03_SST/Fig9_03_SST.png","data":{"kind":"file","org":"BrodiePearson","repo":"IPCC_AR6_Chapter9_Figures","reference":"main","file":"Plotting_code_and_data/Fig9_03_SST/Fig9_03_SST.png","raw":"https://raw.githubusercontent.com/BrodiePearson/IPCC_AR6_Chapter9_Figures/main/Plotting_code_and_data/Fig9_03_SST/Fig9_03_SST.png"},"internal":false,"protocol":"github","key":"sahOaMLYkZ"},{"type":"text","value":" of the ","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"GNp8zRYq8C"},{"type":"link","url":"https://www.ipcc.ch/report/ar6/wg3/","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"IPCC AR6 Report","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"kT23YJZwEG"}],"urlSource":"https://www.ipcc.ch/report/ar6/wg3/","key":"TjVvc6lbWe"},{"type":"text","value":" from the raw climate model simulation data, using Pangeo cloud-native tools. This figure is critical: it literally shows our best estimate of the future state of the climate given certain choices by humanity.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ab1CroyHZ4"}],"key":"xM9tmmypOg"},{"type":"image","url":"/build/d1061528b3e546e0e4d674dab265d6e2.png","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"DqAlIC0UjE","urlSource":"https://i.imgur.com/bhdCM9K.png"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"This figure shows both the historical and projected global average temperature of the ocean’s surface, as used in different ","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"drSyhBGgRy"},{"type":"link","url":"https://www.gfdl.noaa.gov/climate-modeling/","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Global Climate Models","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Da7okNuHLQ"}],"urlSource":"https://www.gfdl.noaa.gov/climate-modeling/","key":"LPfUmd3na9"},{"type":"text","value":". The projections are for possible trajectories of greenhouse gas emissions based on various socio-economic pathways (","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"qHRhUp3hwz"},{"type":"cite","url":"https://doi.org/10.1016/j.gloenvcha.2015.01.004","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Neill et al. 2017","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"my3WL86Yl5"}],"kind":"narrative","label":"O_Neill_2017","identifier":"https://doi.org/10.1016/j.gloenvcha.2015.01.004","enumerator":"1","key":"ORUG3esKch"},{"type":"text","value":").","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"oWz84i8ZgJ"}],"key":"c1Y1n0rKZZ"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"However, the process of creating it is potentially very cumbersome: it involves downloading large files, idiosyncratic code to produce intermediate datafiles, and lots more code to finally plot the results. The open sharing of ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"hQObyQmw8T"},{"type":"link","url":"https://github.com/BrodiePearson/IPCC_AR6_Chapter9_Figures","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"code used for the latest IPCC report","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"nMKrhI5ZtN"}],"urlSource":"https://github.com/BrodiePearson/IPCC_AR6_Chapter9_Figures","error":true,"key":"dMuQcuXnNC"},{"type":"text","value":" inspired us to try to make this process easier for everyone.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"pihFmpuQjw"}],"key":"TDnU0F0vdK"},{"type":"paragraph","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"The numerical model output produced under the ","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"peVAoO1zwN"},{"type":"link","url":"https://www.wcrp-climate.org/wgcm-cmip/wgcm-cmip6","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Coupled Model Intercomparison Project 6 (CMIP6)","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"IZHNtfoq06"}],"urlSource":"https://www.wcrp-climate.org/wgcm-cmip/wgcm-cmip6","key":"Ujq2x9gKLV"},{"type":"text","value":" output is publicly available (distributed by the ","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"ZNrvTWmDXg"},{"type":"link","url":"https://esgf.llnl.gov","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Earth System Grid Federation","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"nJrlISD5oy"}],"urlSource":"https://esgf.llnl.gov","key":"hMBVBp7BBc"},{"type":"text","value":"), so the scientific community should be able to reproduce this plot from scratch, and then build upon it as the underlying science advances.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"kFQFIH7uDO"}],"key":"h7jHuxeEA3"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"Due to recent advances in software and the migration of the CMIP6 data archive into the cloud, we are now able to produce this panel rapidly from raw data using easily available public cloud computing.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"F4JvvjxoYI"}],"key":"aqhoSCWO3P"},{"type":"paragraph","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Working with many CMIP6 datasets at once can be cumbersome because each model has different size and coordinates. In this blogpost we highlight the new ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"lXtf5vYMFJ"},{"type":"link","url":"https://github.com/xarray-contrib/datatree","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"inlineCode","value":"xarray-datatree","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"bnuzvkPdmz"}],"urlSource":"https://github.com/xarray-contrib/datatree","error":true,"key":"kkLoZvWMhr"},{"type":"text","value":" package, which helps organize the many datasets in CMIP6 into a single tree-like data structure.","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"mTqqMTPFnv"}],"key":"LehYZYCmh7"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"There have been other attempts to ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"MnR7N7QJyy"},{"type":"link","url":"https://docs.esmvaltool.org/en/latest/#","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"analyze","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"eI8A7RCwnN"}],"urlSource":"https://docs.esmvaltool.org/en/latest/#","key":"z6aVA4K4md"},{"type":"text","value":", ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"cGq3vWHTDi"},{"type":"link","url":"https://aospy.readthedocs.io/en/stable/","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"organize","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"EkLYriLlPg"}],"urlSource":"https://aospy.readthedocs.io/en/stable/","key":"VcAx5C9iY9"},{"type":"text","value":", and ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"LUtYKN5Yq2"},{"type":"link","url":"https://interactive-atlas.ipcc.ch/documentation","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"visualize","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"dMzcc0930y"}],"urlSource":"https://interactive-atlas.ipcc.ch/documentation","key":"IkHbLYFHqY"},{"type":"text","value":" multi-model experiments, but here we prioritize modularity, flexibility, extensibility, and using domain-agnostic tools.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"cRmxx00Jcy"}],"key":"KxWinx4AKy"},{"type":"comment","value":" - []() very important graph\n- Currently very difficult to make from raw data\n- The data is openly available, so we should be able to make this plot from scratch (and modify it along the way)\n- We can do this process better with new tools ()\n- Part of the problem is organizing many related datasets with different sizes and coordinates\n- Datatree (+ others) makes this easier ","key":"zXRqiofWYT"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"We were able to reproduce parts of this graph in a ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"BdO7fSx3GN"},{"type":"link","url":"https://www.youtube.com/watch?v=7niNfs3ZpfQ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"live demo","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"nN2BAYd6I8"}],"urlSource":"https://www.youtube.com/watch?v=7niNfs3ZpfQ","key":"eMEqaU3TRG"},{"type":"text","value":" at ","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"k58wFA9H5j"},{"type":"link","url":"https://www.scipy2022.scipy.org","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"Scipy 2022","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"Tmny1xpfmf"}],"urlSource":"https://www.scipy2022.scipy.org","key":"f9jV8oLMdv"},{"type":"text","value":" using cloud-hosted data, but felt we could do it much more succinctly with datatree!","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"BoJraDULiI"}],"key":"FvqHzum8Z4"},{"type":"comment","value":" - Describe the graph shown in detail (mention Julius' scipy presentation) ","key":"AMctDThFYP"},{"type":"heading","depth":3,"position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"Getting the data","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"bNvTgGPr4t"}],"identifier":"getting-the-data","label":"Getting the data","html_id":"getting-the-data","implicit":true,"key":"hJByCZ1NJx"},{"type":"paragraph","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"A key component of this workflow is having the large CMIP6 datasets available to open near-instantly from a public cloud store. The ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"AcDfKy9lF5"},{"type":"link","url":"https://pangeo-data.github.io/pangeo-cmip6-cloud/","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Pangeo/ESGF Cloud Data Working Group","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"GLPbGC00SF"}],"urlSource":"https://pangeo-data.github.io/pangeo-cmip6-cloud/","key":"trNuI2snT5"},{"type":"text","value":" maintains ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"vjBcWMchND"},{"type":"link","url":"https://ieeexplore.ieee.org/document/9354557/","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Analysis-Ready Cloud-Optimized","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"dySoClwJXp"}],"urlSource":"https://ieeexplore.ieee.org/document/9354557/","key":"Nfv4I6mejx"},{"type":"text","value":" versions of a large part of the CMIP6 archive as ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"y4Xrt2fQ1E"},{"type":"link","url":"https://zarr.readthedocs.io/en/stable/","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Zarr","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"pKhPQFGZ70"}],"urlSource":"https://zarr.readthedocs.io/en/stable/","key":"u24kz0SPGg"},{"type":"text","value":" stores as public datasets both on ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"WQzEheCDnj"},{"type":"link","url":"https://cloud.google.com/blog/products/data-analytics/new-climate-model-data-now-google-public-datasets","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Google Cloud Storage","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"Ox0QowzgIT"}],"urlSource":"https://cloud.google.com/blog/products/data-analytics/new-climate-model-data-now-google-public-datasets","key":"rMcN4BLpuG"},{"type":"text","value":" and ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"L5HuoGwOmo"},{"type":"link","url":"https://registry.opendata.aws/cmip6/","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Amazon S3","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"tYdBTaKTB9"}],"urlSource":"https://registry.opendata.aws/cmip6/","key":"mFINlIhXCn"},{"type":"text","value":". (This alone is a huge advancement for open science, but just a part of what we’re showing today.)","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"NgMfNSJzVv"}],"key":"z1QTz3rfhK"},{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"For the sake of demonstration we will load a small subset of sea surface temperature data for three models . We’ll load both the historical baseline, as well as the SSP1.26 (“best case”) and SSP5.85 (“worst case”) future socio-economic pathways: a total of 9 datasets. (We’ll tackle scaling up to all the available data in a future blog post.)","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"Zf8Mtwypci"}],"key":"KsYabIKWiV"},{"type":"comment","value":" - Can get it from cloud zarr storage using pangeo stack (already vastly easier than in the past)\n- **Code to open it** ","key":"VcLbZY7MHJ"},{"type":"code","lang":"python","value":"import xarray as xr\nxr.set_options(keep_attrs=True)\nimport gcsfs\nfrom xmip.preprocessing import rename_cmip6\n\ncmip_stores = {\n'IPSL-CM6A-LR/historical':  'gs://cmip6/CMIP6/CMIP/IPSL/IPSL-CM6A-LR/historical/r4i1p1f1/Omon/tos/gn/v20180803/',\n'MPI-ESM1-2-LR/historical': 'gs://cmip6/CMIP6/CMIP/MPI-M/MPI-ESM1-2-LR/historical/r4i1p1f1/Omon/tos/gn/v20190710/',\n'CESM2/historical':         'gs://cmip6/CMIP6/CMIP/NCAR/CESM2/historical/r4i1p1f1/Omon/tos/gn/v20190308/',\n'IPSL-CM6A-LR/ssp126':      'gs://cmip6/CMIP6/ScenarioMIP/IPSL/IPSL-CM6A-LR/ssp126/r4i1p1f1/Omon/tos/gn/v20191121/',\n'IPSL-CM6A-LR/ssp585':      'gs://cmip6/CMIP6/ScenarioMIP/IPSL/IPSL-CM6A-LR/ssp585/r4i1p1f1/Omon/tos/gn/v20191122/',\n'MPI-ESM1-2-LR/ssp126':     'gs://cmip6/CMIP6/ScenarioMIP/MPI-M/MPI-ESM1-2-LR/ssp126/r4i1p1f1/Omon/tos/gn/v20190710/',\n'MPI-ESM1-2-LR/ssp585':     'gs://cmip6/CMIP6/ScenarioMIP/MPI-M/MPI-ESM1-2-LR/ssp585/r4i1p1f1/Omon/tos/gn/v20190710/',\n'CESM2/ssp126':             'gs://cmip6/CMIP6/ScenarioMIP/NCAR/CESM2/ssp126/r4i1p1f1/Omon/tos/gn/v20200528/',\n'CESM2/ssp585':             'gs://cmip6/CMIP6/ScenarioMIP/NCAR/CESM2/ssp585/r4i1p1f1/Omon/tos/gn/v20200528/'\n}\n\ndatasets = {\n    name: rename_cmip6(xr.open_dataset(path, engine=\"zarr\")).load()\n    for name, path in cmip_stores.items()\n}","position":{"start":{"line":59,"column":1},"end":{"line":81,"column":1}},"key":"oppmvVLbGt"},{"type":"blockquote","position":{"start":{"line":82,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":82,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"strong","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"CMIP vocabulary explainer","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"AULm0RhrD4"}],"key":"XF7mB5YVJp"},{"type":"text","value":":\nThe words “model” and “experiment” have a specific meaning in CMIP lingo. Within CMIP there are many different datasets produced by various modeling centers around the world. Each of these centers has one or more ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"kTANEbwvWu"},{"type":"emphasis","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"model","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"weP2EOoTC3"}],"key":"hm4xPk3Xv2"},{"type":"text","value":" setups (","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"UGiO7x6HJm"},{"type":"inlineCode","value":"source_id","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"PXexquOdP1"},{"type":"text","value":" in official CMIP language), which are used to produce multiple simulations. For example the simulations for ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"Fakc4VPdrT"},{"type":"inlineCode","value":"IPSL-CM6A-LR","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"QtkCp9653g"},{"type":"text","value":" are all produced by the ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"u6QXsnNQFR"},{"type":"link","url":"https://www.ipsl.fr/en/home-en/","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"Institut Pierre-Simon Laplace","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"Rrb2tqKSi4"}],"urlSource":"https://www.ipsl.fr/en/home-en/","key":"sJVyX0yyqT"},{"type":"text","value":" in France.\nDifferent simulations are run under certain protocols which prescribe conditions (e.g. greenhouse gas forcings), and these are called ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"dPF2uThzGL"},{"type":"emphasis","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"experiments","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"n4ghVXKWwL"}],"key":"pHf1ZZab5l"},{"type":"text","value":". The experiments we’ve loaded here are ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"ZNeGytvg16"},{"type":"inlineCode","value":"'historical'","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"zzxoG7qjXT"},{"type":"text","value":", ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"tUfFvPHz5Z"},{"type":"inlineCode","value":"'ssp126'","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"lDd8z1f8U0"},{"type":"text","value":" \u0026 ","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"E0OsNeZBHq"},{"type":"inlineCode","value":"'ssp585'","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"hR1AZztImK"},{"type":"text","value":".","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"Wf8JVDr4wB"}],"key":"GLtFQlBSth"}],"key":"KmYfA7eDkn"},{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"These nine datasets are all similar, e.g. they have the same dimension names (freshly cleaned thanks to another package of ours - ","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"npDpmcFhSa"},{"type":"link","url":"https://github.com/jbusecke/xMIP","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"xMIP","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"IfbESccD7M"}],"urlSource":"https://github.com/jbusecke/xMIP","error":true,"key":"qPNlfoWeXx"},{"type":"text","value":") and variable names, but they have different sizes along dimensions: horizontal dimensions differ due to varying resolution and time dimensions differ because the historical baseline run is longer than the scenarios by a varying amount.","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"Ev6XGTesm1"}],"key":"cALUNiRR43"},{"type":"code","lang":"python","value":"print(datasets[\"CESM2/ssp585\"].sizes)\nprint(datasets[\"IPSL-CM6A-LR/ssp585\"].sizes)","position":{"start":{"line":89,"column":1},"end":{"line":92,"column":1}},"key":"Dfet8E49C5"},{"type":"code","lang":"","value":"Frozen({'y': 384, 'x': 320, 'vertex': 4, 'time': 1032, 'bnds': 2})\nFrozen({'y': 332, 'x': 362, 'vertex': 4, 'time': 1032, 'bnds': 2})","position":{"start":{"line":93,"column":1},"end":{"line":96,"column":1}},"key":"ykF56zre7H"},{"type":"paragraph","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"For instance the ","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"SuQlMOxIg3"},{"type":"inlineCode","value":"\"x\" and \"y\"","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"YATw5tq8jV"},{"type":"text","value":" dimensions here (roughly corresponding to latitude and longitude) do not match between the CESM2 model and the IPSL model. Hence they ","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"ZzbMinWiHw"},{"type":"emphasis","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"cannot be combined","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"UsrhFU0YfC"}],"key":"E86kByJybG"},{"type":"text","value":" into a single N-dimensional array or a single ","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"BCbflCb652"},{"type":"link","url":"https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"DvcVWjjOiE"}],"urlSource":"https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html","key":"WGnmmMEykQ"},{"type":"text","value":"!","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"t2gWUqPxXc"}],"key":"XUyHH0hg37"},{"type":"comment","value":" - Data is tricky because can't be combined into a N-D array (without regridding)\n- Means xarray.Dataset alone is inconvenient ","key":"YyjVPD2wVA"},{"type":"heading","depth":3,"position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"children":[{"type":"text","value":"Introducing datatree","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"XBUYWtw4sT"}],"identifier":"introducing-datatree","label":"Introducing datatree","html_id":"introducing-datatree","implicit":true,"key":"RjcD2rP2KW"},{"type":"paragraph","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"text","value":"The CMIP6 datasets are clearly related, however. They have a hierarchical order - grouped by model and then by experiment. Each dataset also contains very similar variables. Wouldn’t it be nice to treat them all as one related set of data, and analyze them together?","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"WM3SMWSJLT"}],"key":"H2aIF1i7Tm"},{"type":"paragraph","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"G7eFn5sH6c"},{"type":"link","url":"https://github.com/xarray-contrib/datatree","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"text","value":"xarray-datatree","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"GQXIj0Cxwq"}],"urlSource":"https://github.com/xarray-contrib/datatree","error":true,"key":"pW56b1YyDi"},{"type":"text","value":" package enables this. It arranges these related datasets into a ","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"YiLaMUCBzP"},{"type":"inlineCode","value":"Datatree","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"J5KRVLhREi"},{"type":"text","value":" object, allowing them to be manipulated together. A ","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"EXQEvYYphx"},{"type":"inlineCode","value":"DataTree","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"tcHOmNXb49"},{"type":"text","value":" object can be thought of as a recursive dictionary of ","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"yfZqNRX9jR"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"g1uAmLGoAT"},{"type":"text","value":" objects, with additional methods for performing computations on the entire tree at once. You can also think of it as an in-memory representation of an entire netCDF file, including all netCDF groups. Because it is in-memory your analysis does not require saving intermediate files to disk.","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"Nxfpm1l4hn"}],"key":"jX6qS4mDTN"},{"type":"blockquote","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"children":[{"type":"text","value":"Note: The pip-installable package ","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"xJQwi1uZL1"},{"type":"inlineCode","value":"xarray-datatree","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"PVjKzeSPD6"},{"type":"text","value":" provides the class ","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"rmR5lpa8a0"},{"type":"inlineCode","value":"DataTree","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"uj5EFSVh4a"},{"type":"text","value":", importable from the module ","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"rHZU95qj3T"},{"type":"inlineCode","value":"datatree","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"mGSnhclUkv"},{"type":"text","value":". From here on we will refer interchangeably to these as just “datatree”.","position":{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},"key":"CMi7c4OCne"}],"key":"wIdREa9Fl0"}],"key":"YglO3q8IbT"},{"type":"comment","value":" - But what if trees\n- **Code to put our data into a tree** ","key":"ZuefyLj7f4"},{"type":"code","lang":"python","value":"from datatree import DataTree\n\ndt = DataTree.from_dict(datasets)\n\nprint(f\"Size of data in tree = {dt.nbytes / 1e9 :.2f} GB\")","position":{"start":{"line":114,"column":1},"end":{"line":120,"column":1}},"key":"FK6ERhuFQz"},{"type":"code","lang":"","value":"Size of data in tree = 4.89 GB","position":{"start":{"line":121,"column":1},"end":{"line":123,"column":1}},"key":"pamkHAPrO6"},{"type":"code","lang":"python","value":"print(dt)","position":{"start":{"line":124,"column":1},"end":{"line":126,"column":1}},"key":"WFHZasLjmN"},{"type":"code","lang":"","value":"DataTree('None', parent=None)\n├── DataTree('IPSL-CM6A-LR')\n│   ├── DataTree('historical')\n│   │       Dimensions:      (y: 332, x: 362, vertex: 4, time: 1980, bnds: 2)\n│   │       Coordinates:\n│   │         * time         (time) object 1850-01-16 12:00:00 ... 2014-12-16 12:00:00\n│   │       Dimensions without coordinates: y, x, vertex, bnds\n│   │       Data variables:\n│   │           area         (y, x) float32 16.0 16.0 16.0 ... 1.55e+08 3.18e+07 3.18e+07\n│   │           lat_bounds   (y, x, vertex) float32 -84.21 -84.21 -84.21 ... 50.11 49.98\n│   │           lon_bounds   (y, x, vertex) float32 72.5 72.5 72.5 72.5 ... 73.0 72.95 73.0\n│   │           lat          (y, x) float32 -84.21 -84.21 -84.21 ... 50.23 50.01 50.01\n│   │           lon          (y, x) float32 72.5 73.5 74.5 75.5 ... 73.05 73.04 73.0 72.99\n│   │           time_bounds  (time, bnds) object 1850-01-01 00:00:00 ... 2015-01-01 00:00:00\n│   │           tos          (time, y, x) float32 nan nan nan nan nan ... nan nan nan nan\n│   │       Attributes: (12/54)\n│   │           CMIP6_CV_version:       cv=6.2.3.5-2-g63b123e\n│   │           Conventions:            CF-1.7 CMIP-6.2\n│   │           EXPID:                  historical\n│   │           NCO:                    \"4.6.0\"\n│   │           activity_id:            CMIP\n│   │           branch_method:          standard\n│   │           ...                     ...\n│   │           tracking_id:            hdl:21.14100/dc824b97-b288-4ec0-adde-8dbcfa3b0095\n│   │           variable_id:            tos\n│   │           variant_label:          r4i1p1f1\n│   │           status:                 2019-11-09;created;by nhn2@columbia.edu\n│   │           netcdf_tracking_ids:    hdl:21.14100/dc824b97-b288-4ec0-adde-8dbcfa3b0095\n│   │           version_id:             v20180803\n│   ├── DataTree('ssp126')\n│   │       Dimensions:      (y: 332, x: 362, vertex: 4, time: 1032, bnds: 2)\n│   │       Coordinates:\n│   │         * time         (time) object 2015-01-16 12:00:00 ... 2100-12-16 12:00:00\n│   │       Dimensions without coordinates: y, x, vertex, bnds\n│   │       Data variables:\n│   │           area         (y, x) float32 16.0 16.0 16.0 ... 1.55e+08 3.18e+07 3.18e+07\n│   │           lat_bounds   (y, x, vertex) float32 -84.21 -84.21 -84.21 ... 50.11 49.98\n│   │           lon_bounds   (y, x, vertex) float32 72.5 72.5 72.5 72.5 ... 73.0 72.95 73.0\n│   │           lat          (y, x) float32 -84.21 -84.21 -84.21 ... 50.23 50.01 50.01\n│   │           lon          (y, x) float32 72.5 73.5 74.5 75.5 ... 73.05 73.04 73.0 72.99\n│   │           time_bounds  (time, bnds) object 2015-01-01 00:00:00 ... 2101-01-01 00:00:00\n│   │           tos          (time, y, x) float32 nan nan nan nan nan ... nan nan nan nan\n...","position":{"start":{"line":127,"column":1},"end":{"line":171,"column":1}},"key":"SbnugB40DD"},{"type":"paragraph","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"We created the whole tree in one go from our dictionary of nine datasets, using the keys of the dict to organize the resulting tree. ","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"pG5uOZz6rC"},{"type":"inlineCode","value":"DataTree","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"yuylqUxDhC"},{"type":"text","value":" objects are structured similarly to a UNIX filesystem, so a key in the dict such as ","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"l9I6s4hAvv"},{"type":"inlineCode","value":"'IPSL-CM6A-LR/historical'","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"v0BJPWLCxK"},{"type":"text","value":" will create a node called ","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"tffV00QCFg"},{"type":"inlineCode","value":"IPSL-CM6A-LR","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"HNMZTiY0Ep"},{"type":"text","value":" and another child node below it called ","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"DTdLEbENup"},{"type":"inlineCode","value":"'historical'","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"Ki7z7OcZ6s"},{"type":"text","value":". This approach means the ","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"k1ADSp2Dm2"},{"type":"inlineCode","value":"DataTree.from_dict","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"PapSiqrqN4"},{"type":"text","value":" method can create trees of arbitrary complexity from flat dictionaries.","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"r84Czq6T24"}],"key":"AFeIjNV7f8"},{"type":"blockquote","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"text","value":"If instead we wanted to create the tree manually, you can do that by setting the ","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"kBc3wBXbj9"},{"type":"inlineCode","value":".children","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"hRV8s2C39N"},{"type":"text","value":" attributes of each node explicitly, assigning other tree objects to build up a composite result.","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"BlSqtdKMo7"}],"key":"Pk7PnEil1e"}],"key":"NwY5YlCBE1"},{"type":"paragraph","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"text","value":"You can see that the resulting tree structure is grouped by model first, and then by the experiment. (This choice is somewhat arbitrary and we could have chosen to group first by experiment and then model.)","position":{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},"key":"WF9PCqcfX5"}],"key":"uhCBn8zS5v"},{"type":"blockquote","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"children":[{"type":"text","value":"While we printed the string representation of the tree for this blog post, if you’re doing this in a jupyter notebook you will actually automatically get an interactive HTML representation of the tree, where each node is collapsible.","position":{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},"key":"xWYVQxihtK"}],"key":"vgBzzc5yh0"}],"key":"EA04uGfqG4"},{"type":"paragraph","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"children":[{"type":"text","value":"We say that we have created one “tree”, where each “node” within that tree (optionally) contains the contents of exactly one ","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"RlBOklFuX8"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"PJ4Yc8C4Kl"},{"type":"text","value":", and also has a node name, a “parent” node, and can have any number of “child” nodes. For more information on the data model datatree uses, see ","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"udpHKuqUTV"},{"type":"link","url":"https://xarray-datatree.readthedocs.io/en/latest/data-structures.html","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"children":[{"type":"text","value":"the documentation","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"sW6JZ42ubD"}],"urlSource":"https://xarray-datatree.readthedocs.io/en/latest/data-structures.html","key":"teaTnYtpxZ"},{"type":"text","value":".","position":{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},"key":"WecNfWfYBY"}],"key":"MZ7y9hDwO4"},{"type":"paragraph","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"children":[{"type":"text","value":"We can actually access nodes in the tree using path-like syntax too, for example","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"gGFKiF21ze"}],"key":"Vtj3hEAJeX"},{"type":"code","lang":"python","value":"print(dt[\"/CESM2/ssp585\"])","position":{"start":{"line":185,"column":1},"end":{"line":187,"column":1}},"key":"We4vsP7PNE"},{"type":"code","lang":"","value":"DataTree('ssp585', parent=\"CESM2\")\n    Dimensions:      (y: 384, x: 320, vertex: 4, time: 1032, bnds: 2)\n    Coordinates:\n      * y            (y) int32 1 2 3 4 5 6 7 8 9 ... 377 378 379 380 381 382 383 384\n      * x            (x) int32 1 2 3 4 5 6 7 8 9 ... 313 314 315 316 317 318 319 320\n      * time         (time) object 2015-01-15 13:00:00 ... 2100-12-15 12:00:00\n    Dimensions without coordinates: vertex, bnds\n    Data variables:\n        lat          (y, x) float64 -79.22 -79.22 -79.22 -79.22 ... 72.2 72.19 72.19\n        lat_bounds   (y, x, vertex) float32 -79.49 -79.49 -78.95 ... 72.41 72.41\n        lon          (y, x) float64 320.6 321.7 322.8 323.9 ... 318.9 319.4 319.8\n        lon_bounds   (y, x, vertex) float32 320.0 321.1 321.1 ... 320.0 320.0 319.6\n        time_bounds  (time, bnds) object 2015-01-01 02:00:00.000003 ... 2101-01-0...\n        tos          (time, y, x) float32 nan nan nan nan nan ... nan nan nan nan\n    Attributes: (12/48)\n        Conventions:            CF-1.7 CMIP-6.2\n        activity_id:            ScenarioMIP\n        branch_method:          standard\n        branch_time_in_child:   735110.0\n        branch_time_in_parent:  735110.0\n        case_id:                1735\n        ...                     ...\n        tracking_id:            hdl:21.14100/68b741c9-b8f8-479d-b48c-6853b1c71e56...\n        variable_id:            tos\n        variant_info:           CMIP6 SSP5-8.5 experiments (2015-2100) with CAM6,...\n        variant_label:          r4i1p1f1\n        netcdf_tracking_ids:    hdl:21.14100/68b741c9-b8f8-479d-b48c-6853b1c71e56...\n        version_id:             v20200528","position":{"start":{"line":188,"column":1},"end":{"line":217,"column":1}},"key":"pnGtkofV6q"},{"type":"paragraph","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"children":[{"type":"text","value":"You can see that every node is itself another ","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"key":"e1UtT3vzY1"},{"type":"inlineCode","value":"DataTree","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"key":"FWDVMFUeWp"},{"type":"text","value":" object, i.e. the tree is a recursive data structure.","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"key":"gzizubHOWF"}],"key":"zpJDwqPg1r"},{"type":"paragraph","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"children":[{"type":"text","value":"This structure not only allows the user full flexibility in how to set up and manipulate the tree, but it also behaves like a filesystem that people are already very familiar with.","position":{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},"key":"yGKGXMuSzK"}],"key":"Bd70KznzBS"},{"type":"paragraph","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"children":[{"type":"text","value":"But datatrees are not just a neat way to organize xarray datasets; they also allows us to operate on datasets in an intuitive way.","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"BOiLVA0Rhe"}],"key":"H7dDOknFKp"},{"type":"comment","value":" - Explain how the tree structure is set up like a file path. We did this in the setup step by giving appropriate keys!\n- Talk about how that's nice and neat ","key":"vOBlXhoWlh"},{"type":"heading","depth":3,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"text","value":"Timeseries","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"hQxqrJWQmN"}],"identifier":"timeseries","label":"Timeseries","html_id":"timeseries","implicit":true,"key":"njxjQGu14o"},{"type":"paragraph","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"children":[{"type":"text","value":"In this case the basic quantity we want to compute is a global mean of the ocean surface temperature. For this we can use the built-in ","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"dJOnsx7TTZ"},{"type":"inlineCode","value":".mean()","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"KZNXG4C5n5"},{"type":"text","value":" method.","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"rt4YCE4uVr"}],"key":"j0YcHQPGfG"},{"type":"comment","value":" - Explain `.mean()` method (mapping over each node) ","key":"CeDdKb4aWV"},{"type":"code","lang":"python","value":"timeseries = dt.mean(dim=[\"x\", \"y\"])","position":{"start":{"line":234,"column":1},"end":{"line":236,"column":1}},"key":"vVawnauNrK"},{"type":"paragraph","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"children":[{"type":"text","value":"This works exactly like the familiar xarray method, and averages the temperature values over the horizontal dimensions for ","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"key":"ZjnygOuwNv"},{"type":"strong","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"children":[{"type":"text","value":"each dataset on any level of the tree","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"key":"N0qQKBaaip"}],"key":"C47Q1EAUvN"},{"type":"text","value":". :exploding_head:","position":{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},"key":"GO5gTCTkO2"}],"key":"zPYJrHApsa"},{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"All arguments are passed down, so this ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"jWKcKmkFBI"},{"type":"inlineCode","value":".mean","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"P2G6otLzJ1"},{"type":"text","value":" will work so long as the data in each node of the tree has a ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"A6bw3vk10u"},{"type":"inlineCode","value":"\"x\"","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"qxWHGHDPTy"},{"type":"text","value":" and a ","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"G07RBgukVw"},{"type":"inlineCode","value":"\"y\"","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"Aj0w5mjSBD"},{"type":"text","value":" dimension to average over.","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"VyoLVJOBtm"}],"key":"EmlIf6BfwO"},{"type":"paragraph","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"text","value":"Lets confirm our results by plotting a single dataset from the new tree of timeseries:","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"TzeJU8yGv3"}],"key":"UPygxrq41F"},{"type":"comment","value":" - **Constructing + Plotting a timeseries for each individual dataset** ","key":"ohAD7k7p3W"},{"type":"code","lang":"python","value":"timeseries['/IPSL-CM6A-LR/ssp585'].ds['tos'].plot()","position":{"start":{"line":244,"column":1},"end":{"line":246,"column":1}},"key":"lAJhHcbXIP"},{"type":"image","url":"/build/e2f4972e07d860158e4a23fefce35f5e.png","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"lNRk5qlJqP","urlSource":"https://i.imgur.com/JSXAamv.png"},{"type":"paragraph","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"And indeed, we get a nice timeseries. Once you select a node, you get back an ","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"jwPeXBnKlj"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"wMK1NvaeYY"},{"type":"text","value":" using ","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"SElFEImA7H"},{"type":"inlineCode","value":".ds","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"Xb3IxI09IX"},{"type":"text","value":" and can do all the good stuff you already know (like plotting).","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"jpuoqnz1VY"}],"key":"QQ9sx2h4BB"},{"type":"paragraph","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"children":[{"type":"text","value":"For comparison, here is the relevant part of ","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"key":"Hk690kKSm2"},{"type":"link","url":"https://github.com/jbusecke/presentation_scipy_2022_cmip/blob/main/scipy2022_demo.ipynb","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"children":[{"type":"text","value":"Julius’ code","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"key":"MzoW2nvJS1"}],"urlSource":"https://github.com/jbusecke/presentation_scipy_2022_cmip/blob/main/scipy2022_demo.ipynb","data":{"kind":"file","org":"jbusecke","repo":"presentation_scipy_2022_cmip","reference":"main","file":"scipy2022_demo.ipynb","raw":"https://raw.githubusercontent.com/jbusecke/presentation_scipy_2022_cmip/main/scipy2022_demo.ipynb"},"internal":false,"protocol":"github","key":"mwRmmuZO4a"},{"type":"text","value":" from the Scipy 2022 live demo that did not use datatree:","position":{"start":{"line":251,"column":1},"end":{"line":251,"column":1}},"key":"qFBpW3KRP0"}],"key":"kteSkhNx0z"},{"type":"code","lang":"python","value":"timeseries_hist_datasets = []\ntimeseries_ssp126_datasets = []\ntimeseries_ssp245_datasets = []\ntimeseries_ssp370_datasets = []\ntimeseries_ssp585_datasets = []\n\nfor k,ds in data_timeseries.items():\n    # Separate experiments\n    out = ds.convert_calendar('standard')\n    out = out.sel(time=slice('1850', '2100'))# cut extended runs\n    out = out.assign_coords(source_id=ds.source_id)\n    if ds.experiment_id == 'historical':\n        # CMIP\n        if len(out.time)==1980:\n            timeseries_hist_datasets.append(out)\n        else:\n            print(f\"found {len(ds.time)} for {k}\")\n    else:\n        #scenarioMIP\n        if len(out.time)!=1032:\n            print(f\"found {len(out.time)} for {k}\")\n            # print(ds.time)\n        else:\n            if ds.experiment_id == 'ssp126':\n                timeseries_ssp126_datasets.append(out)\n            elif ds.experiment_id == 'ssp245':\n                timeseries_ssp245_datasets.append(out)\n            elif ds.experiment_id == 'ssp370':\n                timeseries_ssp370_datasets.append(out)\n            elif ds.experiment_id == 'ssp585':\n                timeseries_ssp585_datasets.append(out)            \n\nconcat_kwargs = dict(\n    dim='source_id',\n    join='override',\n    compat='override',\n    coords='minimal'\n) \ntimeseries_hist = xr.concat(timeseries_hist_datasets, **concat_kwargs)\ntimeseries_ssp126 = xr.concat(timeseries_ssp126_datasets, **concat_kwargs)\ntimeseries_ssp245 = xr.concat(timeseries_ssp245_datasets, **concat_kwargs)\ntimeseries_ssp370 = xr.concat(timeseries_ssp370_datasets, **concat_kwargs)\ntimeseries_ssp585 = xr.concat(timeseries_ssp585_datasets, **concat_kwargs)","position":{"start":{"line":253,"column":1},"end":{"line":297,"column":1}},"key":"k4c78WrzB3"},{"type":"paragraph","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"😬 Definitely not as nice as a one-liner...","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"msKf1OKOoK"}],"key":"ThyrPKpkHK"},{"type":"paragraph","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"children":[{"type":"text","value":"It’s worth understanding what happened under the hood when calling ","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"aHru9OE0h2"},{"type":"inlineCode","value":".mean()","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"xPsya3ur9W"},{"type":"text","value":" on the tree. We can reproduce the behavior of ","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"VodcTnkUDQ"},{"type":"inlineCode","value":".mean()","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"YyuC7F380w"},{"type":"text","value":" by passing a simple function to the built-in ","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"HH5UHtV1Xd"},{"type":"inlineCode","value":".map_over_subtree()","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"HptvI13j4v"},{"type":"text","value":" method.","position":{"start":{"line":301,"column":1},"end":{"line":301,"column":1}},"key":"bQ1GSEfwkq"}],"key":"RKEARuDiwo"},{"type":"comment","value":" - **Show `map_over_subtree` verbose example** ","key":"l1GEbEfwuQ"},{"type":"code","lang":"python","value":"def mean_over_space(ds):\n    return ds.mean(dim=[\"x\", \"y\"])\n\ndt.map_over_subtree(mean_over_space)","position":{"start":{"line":305,"column":1},"end":{"line":310,"column":1}},"key":"FZqYAI684J"},{"type":"paragraph","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"children":[{"type":"text","value":"The function ","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"k2EFwzJDKr"},{"type":"inlineCode","value":"mean_over_space","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"E5NpFdzQeQ"},{"type":"text","value":" that we supplied gets applied to the data in each and every node in the tree automatically. This will return the exact same result as above, but with this method users can map arbitrary functions over each dataset in the tree, as long as they consume and produce ","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"SEfJ5gcJXn"},{"type":"inlineCode","value":"xarray.Datasets","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"YQGsoCgJtG"},{"type":"text","value":". You can even ","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"P8qJ4LO1U9"},{"type":"link","url":"https://github.com/xarray-contrib/datatree/blob/f267f95eac6be7fef072bf0d40af06093c13c8f6/datatree/mapping.py#L106","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"children":[{"type":"text","value":"map functions with multiple inputs and outputs","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"cRjJOAcrOk"}],"urlSource":"https://github.com/xarray-contrib/datatree/blob/f267f95eac6be7fef072bf0d40af06093c13c8f6/datatree/mapping.py#L106","data":{"kind":"file","org":"xarray-contrib","repo":"datatree","reference":"f267f95eac6be7fef072bf0d40af06093c13c8f6","file":"datatree/mapping.py","from":106,"raw":"https://raw.githubusercontent.com/xarray-contrib/datatree/f267f95eac6be7fef072bf0d40af06093c13c8f6/datatree/mapping.py"},"internal":false,"protocol":"github","key":"FRxTAY09gO"},{"type":"text","value":", but that is an advanced use case which we will use at the end of this post.","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"zp3sfuRflx"}],"key":"O3CwPjhjny"},{"type":"paragraph","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"children":[{"type":"text","value":"You can already see that this enables very intuitive mapping of custom functions without lengthy writing of loops.","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"key":"foCFnu5t7F"}],"key":"YELTd3VGVP"},{"type":"heading","depth":3,"position":{"start":{"line":315,"column":1},"end":{"line":315,"column":1}},"children":[{"type":"text","value":"Saving output","position":{"start":{"line":315,"column":1},"end":{"line":315,"column":1}},"key":"C9czPPVnuQ"}],"identifier":"saving-output","label":"Saving output","html_id":"saving-output","implicit":true,"key":"aS38tPs7rj"},{"type":"paragraph","position":{"start":{"line":317,"column":1},"end":{"line":317,"column":1}},"children":[{"type":"text","value":"Before we go further, we might want to save our aggregated timeseries data to use later. ","position":{"start":{"line":317,"column":1},"end":{"line":317,"column":1}},"key":"oRXQ8Qu0xt"},{"type":"inlineCode","value":"DataTree","position":{"start":{"line":317,"column":1},"end":{"line":317,"column":1}},"key":"G9cbuOXPLl"},{"type":"text","value":" supports saving to and loading from both netCDF files and Zarr stores.","position":{"start":{"line":317,"column":1},"end":{"line":317,"column":1}},"key":"kPUpdRVvTa"}],"key":"Ux7fyBxA7O"},{"type":"code","lang":"python","value":"from datatree import open_datatree\n\ntimeseries.to_zarr('cmip_timeseries')  # or netcdf, with any group structure\n\nroundtrip = open_datatree('cmip_timeseries', engine=\"zarr\")\nprint(roundtrip)","position":{"start":{"line":320,"column":1},"end":{"line":327,"column":1}},"key":"vWbTJUr8ti"},{"type":"code","lang":"","value":"DataTree('None', parent=None)\n├── DataTree('CESM2')\n│   ├── DataTree('historical')\n│   │       Dimensions:      (vertex: 4, time: 1980, bnds: 2)\n│   │       Coordinates:\n│   │         * time         (time) object 1850-01-15 12:59:59.999997 ... 2014-12-15 12:0...\n│   │       Dimensions without coordinates: vertex, bnds\n│   │       Data variables:\n│   │           lat          float64 ...\n│   │           lat_bounds   (vertex) float32 ...\n│   │           lon          float64 ...\n│   │           lon_bounds   (vertex) float32 ...\n│   │           time_bounds  (time, bnds) object ...\n│   │           tos          (time) float32 ...\n...","position":{"start":{"line":328,"column":1},"end":{"line":344,"column":1}},"key":"WbRYxKXGGY"},{"type":"paragraph","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"children":[{"type":"text","value":"Nodes are saved as netCDF or Zarr groups, meaning that you can now work smoothly with xarray and multi-group files, a ","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"key":"rilFM927i6"},{"type":"link","url":"https://github.com/pydata/xarray/issues/1092","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"children":[{"type":"text","value":"long-term sticking point","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"key":"KB2YTIXbR9"}],"urlSource":"https://github.com/pydata/xarray/issues/1092","data":{"kind":"issue","org":"pydata","repo":"xarray","issue_number":"1092"},"internal":false,"protocol":"github","key":"lg723SDcrh"},{"type":"text","value":" for many xarray users. Being able to now work with such files without leaving xarray or python helps retains backwards compatibility and portability.","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"key":"xDvdlk92mH"}],"key":"aZ2iJewicw"},{"type":"heading","depth":3,"position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"children":[{"type":"text","value":"Calculating anomalies","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"QwaMTL7kSg"}],"identifier":"calculating-anomalies","label":"Calculating anomalies","html_id":"calculating-anomalies","implicit":true,"key":"D1GRGp9dL8"},{"type":"blockquote","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"children":[{"type":"strong","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"children":[{"type":"text","value":"Note on Climate Anomalies","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"MuqEVVrW7x"}],"key":"FBk02bt5tM"},{"type":"text","value":": Coupled climate models often exhibit ‘biases’, which means that the ocean temperatures at the starting point for e.g. the historical and future experiments will differ from model to model. For the purpose of this scientific analysis however we are most interested in the ","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"NXcFWUBwZA"},{"type":"emphasis","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"children":[{"type":"text","value":"relative change from that starting point","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"PsK2GxtB7Q"}],"key":"AwUSABuFB2"},{"type":"text","value":" when a forcing (e.g. increased greenhouse gases) is applied. Conventionally we compute the anomaly relative to a given reference value. In this case the reference value is the global ocean temperature averaged over the years 1950-1980 in the corresponding historical experiment. Therefore we want to ","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"owXmPIsVGg"},{"type":"strong","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"children":[{"type":"text","value":"compute and subtract this reference value for each model separately","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"Pt1WmwqDR2"}],"key":"bIJSaTnwCn"},{"type":"text","value":" so that each model-specific bias is removed.","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"XIdhnjraop"}],"key":"tECQuLyg2s"}],"key":"ELH6IQonvs"},{"type":"comment","value":" - Explain anomalies, base period, model biases ","key":"q69AakTOyd"},{"type":"comment","value":" - Demonstrate on non-tree ","key":"xlfq7pckTk"},{"type":"comment","value":" - **Find the per-model deviation over the tree** ","key":"kq5e1NtFqJ"},{"type":"paragraph","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"children":[{"type":"text","value":"In practice we need to iterate over each model, pick the historical experiment, select the base period, and average it. We then subtract that resulting value from ","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"key":"Dp5LWclA0W"},{"type":"emphasis","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"children":[{"type":"text","value":"all","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"key":"NMu6w4JZWJ"}],"key":"LsUPyAXgQX"},{"type":"text","value":" experiments of the corresponding model and rearrange the resulting anomaly timeseries into a new tree.","position":{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},"key":"F4cNpiPHem"}],"key":"Qi6w1Erlt9"},{"type":"code","lang":"python","value":"anomaly = DataTree()\nfor model_name, model in timeseries.children.items():\n    \n    # model-specific base period as an xarray.Dataset\n    base_period = model[\"historical\"].ds.sel(time=slice('1950','1980')).mean('time')\n    \n    anomaly[model_name] = model - base_period   # subtree - Dataset","position":{"start":{"line":358,"column":1},"end":{"line":366,"column":1}},"key":"C1J6CpLiUO"},{"type":"paragraph","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"children":[{"type":"text","value":"We have used a few features of datatree here. We loop over the ","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"MdomfSicm2"},{"type":"inlineCode","value":".children","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"TqRV9jM4Nl"},{"type":"text","value":" attribute of the ","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"Pm5upcqcJH"},{"type":"inlineCode","value":"DataTree","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"QmV5NxXt1F"},{"type":"text","value":", which iterates through each sub-node in turn in a dictionary-like manner.","position":{"start":{"line":368,"column":1},"end":{"line":368,"column":1}},"key":"RYmRZa1v0x"}],"key":"afq9PP8iKX"},{"type":"paragraph","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"children":[{"type":"text","value":"We find the reference value (","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"NhNOTLdvQT"},{"type":"inlineCode","value":"base_period","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"SzVK1hv8bi"},{"type":"text","value":") by extracting the data in a node as an ","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"roQ6kUP3vP"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"LwnAEEdcIg"},{"type":"text","value":" via ","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"ovQym6e9cg"},{"type":"inlineCode","value":".ds","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"L9h28Ea7OW"},{"type":"text","value":", giving us access to all of xarray’s normal API for computations.","position":{"start":{"line":370,"column":1},"end":{"line":370,"column":1}},"key":"Nj6W9cfxpn"}],"key":"DDpiYgg2vp"},{"type":"paragraph","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"children":[{"type":"text","value":"Our tree of results (","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"BRKc12fx8z"},{"type":"inlineCode","value":"anomaly","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"ojnBwH88eG"},{"type":"text","value":") is constructed by creating an empty tree and then adding branches to this new tree whilst we loop through models.","position":{"start":{"line":372,"column":1},"end":{"line":372,"column":1}},"key":"g3fypy6aKq"}],"key":"KEIESGFX1b"},{"type":"paragraph","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"children":[{"type":"text","value":"In the final line of this ","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"BHDpgVJwyV"},{"type":"inlineCode","value":"for","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"k0OdL2FlHN"},{"type":"text","value":" loop we have subtracted an ","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"BcHNrCkaUt"},{"type":"inlineCode","value":"xarray.Dataset","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"izAzhNNkDH"},{"type":"text","value":" from a ","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"G66PCkyLbn"},{"type":"inlineCode","value":"DataTree","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"d92ZumYNAS"},{"type":"text","value":" - this operation works node-wise, i.e. the dataset is subtracted from every data-containing node in the tree.","position":{"start":{"line":374,"column":1},"end":{"line":374,"column":1}},"key":"SlLf3NtWXi"}],"key":"VqXEfHEdT7"},{"type":"comment","value":" - (Could be neater - future work to do tree broadcasting) ","key":"FHQCpT70UV"},{"type":"blockquote","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"text","value":"Note: In general, we could imagine having rules for operations involving any number of trees of ","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"qrypYc5OeV"},{"type":"emphasis","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"text","value":"any node structure","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"o2vqfmsy7X"}],"key":"tEqRj7V0mE"},{"type":"text","value":", analogous to numpy array broadcasting. This would make the above anomaly calculation much more succinct. However at the moment, datatree only supports ","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"nVfxfkUSfY"},{"type":"inlineCode","value":"tree @ dataset","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"Y6Crp9l5rR"},{"type":"text","value":"-like operations and ","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"d9aHZ0ZAeY"},{"type":"inlineCode","value":"tree @ tree","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"KkF2ap6Wue"},{"type":"text","value":"-like operations, where the trees ","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"O7eRIYrSc6"},{"type":"emphasis","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"children":[{"type":"text","value":"must have the same node structure","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"hbaG5AMYrG"}],"key":"JBoeeeHhw3"},{"type":"text","value":".","position":{"start":{"line":379,"column":1},"end":{"line":379,"column":1}},"key":"cHw9PunqvQ"}],"key":"WFhTFZ6ocM"}],"key":"sr9xDXJwCm"},{"type":"heading","depth":3,"position":{"start":{"line":381,"column":1},"end":{"line":381,"column":1}},"children":[{"type":"text","value":"Plotting","position":{"start":{"line":381,"column":1},"end":{"line":381,"column":1}},"key":"xAutn70GHH"}],"identifier":"plotting","label":"Plotting","html_id":"plotting","implicit":true,"key":"slbW8S6Aeo"},{"type":"paragraph","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"children":[{"type":"text","value":"Alright, so the final step here is to actually plot the data. We can use the ","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"QWZgmGqDjI"},{"type":"inlineCode","value":"map_over_subtree","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"olHAAZ2uSd"},{"type":"text","value":" approach to plot each individual simulation onto the same matplotlib axes:","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"HME8siwAxJ"}],"key":"AsIXgDYke5"},{"type":"comment","value":" - **Create plot** ","key":"RTcAedaio6"},{"type":"code","lang":"python","value":"import matplotlib.pyplot as plt\n\nfrom datatree import map_over_subtree\n\nfig, ax = plt.subplots()\n\n\n@map_over_subtree\ndef plot_temp(ds, original_ds):\n    \n    if ds:\n        label = f'{original_ds.attrs[\"source_id\"]} - {original_ds.attrs[\"experiment_id\"]}'\n        ds['tos'].rolling(time=2*12).mean().plot(ax=ax, label=label)\n\n    return ds\n\n   \nplot_temp(anomaly, timeseries)\nax.legend()","position":{"start":{"line":385,"column":1},"end":{"line":405,"column":1}},"key":"gXDpWoRPaw"},{"type":"image","url":"/build/4a5524f79c227b975c338a7ce040484b.png","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"key":"rXNK1OgaaG","urlSource":"https://i.imgur.com/C9KwzVS.png"},{"type":"paragraph","position":{"start":{"line":410,"column":1},"end":{"line":410,"column":1}},"children":[{"type":"text","value":"For this we created a matplotlib figure and axis and then used the built-in xarray plotting capability to add each timeseries to the existing ","position":{"start":{"line":410,"column":1},"end":{"line":410,"column":1}},"key":"WuInfKfqnm"},{"type":"inlineCode","value":"matplotlib.Axes","position":{"start":{"line":410,"column":1},"end":{"line":410,"column":1}},"key":"JIfiQxnWkU"},{"type":"text","value":" object.","position":{"start":{"line":410,"column":1},"end":{"line":410,"column":1}},"key":"O5xpBI8J1j"}],"key":"ZPskMQPgUq"},{"type":"paragraph","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"children":[{"type":"text","value":"Instead of using the ","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"Ld7X6crytR"},{"type":"inlineCode","value":".map_over_subtree","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"USEd8M5Nj0"},{"type":"text","value":" method on the ","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"DFIvVkwzFw"},{"type":"inlineCode","value":"DataTree","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"gSbzbRFHEf"},{"type":"text","value":" class, we instead used ","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"TuxPwmFvzv"},{"type":"inlineCode","value":"map_over_subtree","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"jqAGEDuVeN"},{"type":"text","value":" as a function decorator, which promoted ","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"yTtGNaogpR"},{"type":"inlineCode","value":"plot_temp","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"vYjlQj5csK"},{"type":"text","value":" to a function that will act over all nodes of any given tree. This decorator is happy to map over multiple trees simultaneously, which we used to extract the metadata for labelling each timeseries.","position":{"start":{"line":412,"column":1},"end":{"line":412,"column":1}},"key":"XrpMgW3OYP"}],"key":"pT4voqJ86z"},{"type":"blockquote","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"children":[{"type":"text","value":"Note: The way we extracted this metadata for plotting was a little awkward - we can imagine improving this in future versions of datatree.","position":{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},"key":"jC4u4NGFDT"}],"key":"C6mq1ckCS5"}],"key":"OcPjRjZ1AU"},{"type":"paragraph","position":{"start":{"line":416,"column":1},"end":{"line":416,"column":1}},"children":[{"type":"text","value":"The fact that we operate on an xarray dataset also allows us to convieniently smooth the timeseries (by a 2 year rolling mean) to remove the seasonal cycle.","position":{"start":{"line":416,"column":1},"end":{"line":416,"column":1}},"key":"PomSAgZDQk"}],"key":"B4wbVanFMj"},{"type":"paragraph","position":{"start":{"line":418,"column":1},"end":{"line":418,"column":1}},"children":[{"type":"text","value":"Looking at the figure produced above, we’ve successfully replicated the basic features of the IPCC plot that we wanted! And it took us very few lines of code overall, especially compared to how it’s often done. In future posts we will improve this figure, adding more data and maybe making it interactive.","position":{"start":{"line":418,"column":1},"end":{"line":418,"column":1}},"key":"PkpzHUKRYQ"}],"key":"Ldf66DPKeJ"},{"type":"paragraph","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"children":[{"type":"text","value":"(Eagle-eyed climate scientist readers will have noticed that our figure is not actually quite correct - we forgot to correctly weight our temperature averages by the areas of the grid cells in each model! We will deal with this subtlety and other more complex custom aggregations in a future blog post.)","position":{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},"key":"YBys4rtBYP"}],"key":"I56KDijrvd"},{"type":"heading","depth":3,"position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"children":[{"type":"text","value":"Takeaways","position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"key":"wVKAdXGqb9"}],"identifier":"takeaways","label":"Takeaways","html_id":"takeaways","implicit":true,"key":"VwXgb22OXx"},{"type":"paragraph","position":{"start":{"line":424,"column":1},"end":{"line":424,"column":1}},"children":[{"type":"text","value":"Datatree is a general tool. Whilst here we used it on CMIP6 data, we learnt about capabilities that might be useful in other projects. We saw that datatree can:","position":{"start":{"line":424,"column":1},"end":{"line":424,"column":1}},"key":"m8ClMAZ54N"}],"key":"QFjY6di60a"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":426,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"children":[{"type":"strong","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"children":[{"type":"text","value":"Organize heterogeneous data","position":{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},"key":"RSHMIWTsbn"}],"key":"z3BGUDnAhl"}],"key":"tftLWa6cAt"},{"type":"listItem","spread":true,"position":{"start":{"line":427,"column":1},"end":{"line":427,"column":1}},"children":[{"type":"strong","position":{"start":{"line":427,"column":1},"end":{"line":427,"column":1}},"children":[{"type":"text","value":"Seamlessly extend xarray’s functionality","position":{"start":{"line":427,"column":1},"end":{"line":427,"column":1}},"key":"HA1NN5jxw7"}],"key":"HCgWKCJsdq"}],"key":"zQ09rjhDfq"},{"type":"listItem","spread":true,"position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"children":[{"type":"strong","position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"children":[{"type":"text","value":"Handle I/O with nested groups","position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"key":"tncSMZ8h8s"}],"key":"GbuD7AH1no"}],"key":"dBueSvqQvW"},{"type":"listItem","spread":true,"position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"children":[{"type":"strong","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"children":[{"type":"text","value":"Apply operations over whole trees","position":{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},"key":"oGJxArgG7j"}],"key":"JNCiQccfzO"}],"key":"Zod0SfsjOK"},{"type":"listItem","spread":true,"position":{"start":{"line":430,"column":1},"end":{"line":430,"column":1}},"children":[{"type":"strong","position":{"start":{"line":430,"column":1},"end":{"line":430,"column":1}},"children":[{"type":"text","value":"Perform more complex and custom operations","position":{"start":{"line":430,"column":1},"end":{"line":430,"column":1}},"key":"u6olQ7cdE2"}],"key":"xKvhK4dE2P"}],"key":"XhqFw9U5Ix"},{"type":"listItem","spread":true,"position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"children":[{"type":"strong","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"children":[{"type":"text","value":"Retain fine-grained control","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"key":"h6wHxlDZCG"}],"key":"xxw6hGzQxC"}],"key":"V6gpftciri"},{"type":"listItem","spread":true,"position":{"start":{"line":432,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"strong","position":{"start":{"line":432,"column":1},"end":{"line":432,"column":1}},"children":[{"type":"text","value":"Reduce overall lines of code","position":{"start":{"line":432,"column":1},"end":{"line":432,"column":1}},"key":"KiUQx3kZk9"}],"key":"TmdLpHqSf5"}],"key":"QTVbeGS0qb"}],"key":"IzrG1YktdM"},{"type":"heading","depth":3,"position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"children":[{"type":"text","value":"Future","position":{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},"key":"nYbstcwRMo"}],"identifier":"future","label":"Future","html_id":"future","implicit":true,"key":"eWtbovO3qf"},{"type":"paragraph","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"children":[{"type":"text","value":"This blogpost is the first in a series. We plan to write more to discuss:","position":{"start":{"line":437,"column":1},"end":{"line":437,"column":1}},"key":"GnWmfWDYRV"}],"key":"eAo2M1SEwW"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":438,"column":1},"end":{"line":441,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"children":[{"type":"text","value":"Using ","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"key":"Ob63lR7szT"},{"type":"link","url":"https://github.com/intake/intake","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"children":[{"type":"text","value":"intake","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"key":"sslvDaedDw"}],"urlSource":"https://github.com/intake/intake","error":true,"key":"Ej67c4g1Jg"},{"type":"text","value":" with datatree, where the trees could act like in-memory catalogs,","position":{"start":{"line":438,"column":1},"end":{"line":438,"column":1}},"key":"PNv8a4lPlT"}],"key":"qZpi7SQc8H"},{"type":"listItem","spread":true,"position":{"start":{"line":439,"column":1},"end":{"line":439,"column":1}},"children":[{"type":"text","value":"Suporting more complex aggregation operations, such as using ","position":{"start":{"line":439,"column":1},"end":{"line":439,"column":1}},"key":"LaTdaH3PnX"},{"type":"inlineCode","value":".weighted","position":{"start":{"line":439,"column":1},"end":{"line":439,"column":1}},"key":"JlTIgzqsOW"},{"type":"text","value":" to weight an operation on one tree with weights from another tree,","position":{"start":{"line":439,"column":1},"end":{"line":439,"column":1}},"key":"hl3znmpQH1"}],"key":"NsX4Fc2QAI"},{"type":"listItem","spread":true,"position":{"start":{"line":440,"column":1},"end":{"line":440,"column":1}},"children":[{"type":"text","value":"Scaling out to a much larger set of CMIP6 data with dask,","position":{"start":{"line":440,"column":1},"end":{"line":440,"column":1}},"key":"ryjevm7r3b"}],"key":"fdyNL1IgXf"},{"type":"listItem","spread":true,"position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"children":[{"type":"text","value":"Quick plotting of data in a whole tree, maybe even making it interactive.","position":{"start":{"line":441,"column":1},"end":{"line":441,"column":1}},"key":"q8N62HW8yO"}],"key":"iYtHtq14ZF"}],"key":"LGsH3rw2Ji"}],"key":"wnTcfcCGPU"}],"key":"RVvBngzifU"},"references":{"cite":{"order":["O_Neill_2017"],"data":{"O_Neill_2017":{"label":"O_Neill_2017","enumerator":"1","doi":"10.1016/j.gloenvcha.2015.01.004","html":"O’Neill, B. C., Kriegler, E., Ebi, K. L., Kemp-Benedict, E., Riahi, K., Rothman, D. S., van Ruijven, B. J., van Vuuren, D. P., Birkmann, J., Kok, K., Levy, M., \u0026 Solecki, W. (2017). The roads ahead: Narratives for shared socioeconomic pathways describing world futures in the 21st century. \u003ci\u003eGlobal Environmental Change\u003c/i\u003e, \u003ci\u003e42\u003c/i\u003e, 169–180. \u003ca target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1016/j.gloenvcha.2015.01.004\"\u003e10.1016/j.gloenvcha.2015.01.004\u003c/a\u003e","url":"https://doi.org/10.1016/j.gloenvcha.2015.01.004"}}}},"footer":{"navigation":{"prev":{"title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","url":"/blog/2023/dask-distributed","group":"2023"},"next":{"title":"Unit-aware arithmetic in Xarray, via pint","url":"/blog/2022/pint-xarray","group":"2022"}}},"domain":"http://localhost:3000"},"project":{"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"title":"Welcome","thumbnail":"/build/profile-color-circle-a6e893ac44e4d6b0fed0aac0fd76d967.png","authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","references":{"ttw":{"url":"https://book.the-turing-way.org"}},"toc":[{"file":"index.md"},{"file":"about.md"},{"children":[{"children":[{"pattern":"blog/2025/**{.ipynb,.md}"}],"title":"2025"},{"children":[{"pattern":"blog/2024/**{.ipynb,.md}"}],"title":"2024"},{"children":[{"pattern":"blog/2023/**{.ipynb,.md}"}],"title":"2023"},{"children":[{"pattern":"blog/2022/**{.ipynb,.md}"}],"title":"2022"},{"children":[{"pattern":"blog/2020/**{.ipynb,.md}"}],"title":"2020"},{"children":[{"pattern":"blog/2019/**{.ipynb,.md}"}],"title":"2019"}],"file":"blog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"about","title":"About me","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"blog","title":"Blog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":2,"title":"2025"},{"slug":"blog.2025.science-needs-a-social-network","title":"Science needs a social network for sharing big data","description":"","date":"2025-01-18","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["open-science","frost"],"level":3},{"level":2,"title":"2024"},{"slug":"blog.2024.datatree","title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","description":"","date":"2024-12-19","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science"],"level":3},{"level":2,"title":"2023"},{"slug":"blog.2023.cubed-xarray","title":"Cubed: Bounded-memory serverless array processing in xarray","description":"","date":"2023-06-01","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","dask","cubed","open-science"],"level":3},{"slug":"blog.2023.dask-distributed","title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","description":"","date":"2023-01-04","thumbnail":"/build/f8821db67c2a5f1f07b570e6bed342cc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","dask","open-science"],"level":3},{"level":2,"title":"2022"},{"slug":"blog.2022.easy-ipcc-datatree","title":"Easy IPCC part 1: Multi-Model Datatree","description":"","date":"2022-08-29","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science","climate-science","datatree"],"level":3},{"slug":"blog.2022.pint-xarray","title":"Unit-aware arithmetic in Xarray, via pint","description":"","date":"2022-08-30","thumbnail":"/build/undefined","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","pint","open-science","physical-units"],"level":3},{"level":2,"title":"2020"},{"slug":"blog.2020.covid19-model","title":"Coronavirus: The Simplest Model","description":"","date":"2020-03-20","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","modelling","covid-19"],"level":3},{"slug":"blog.2020.deep-pseudoscience","title":"The faulty science, doomism, and flawed conclusions of Deep Adaptation","description":"","date":"2020-07-14","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate-science","misinformation"],"level":3},{"slug":"blog.2020.oxford-divests","title":"Oxford University Divestment Explained","description":"","date":"2020-04-22","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate","oxford"],"level":3},{"level":2,"title":"2019"},{"slug":"blog.2019.theconversation-fusion","title":"Nuclear Fusion: too late for the climate","description":"","date":"2019-09-30","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["fusion","energy","climate"],"level":3}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/build/manifest-B4831781.js";
import * as route0 from "/build/root-QGLRP2PL.js";
import * as route1 from "/build/routes/$-7JYT5576.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/build/entry.client-UNPC4GT3.js");</script></body></html>
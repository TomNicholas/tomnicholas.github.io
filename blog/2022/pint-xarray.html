<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Unit-aware arithmetic in Xarray, via pint - Welcome</title><meta property="og:title" content="Unit-aware arithmetic in Xarray, via pint - Welcome"/><meta name="generator" content="mystmd"/><meta name="description" content="All scientific computations involve units, so let&#x27;s make our analysis software aware of them.
"/><meta property="og:description" content="All scientific computations involve units, so let&#x27;s make our analysis software aware of them.
"/><meta name="keywords" content=""/><meta name="image" content="/build/df49524368335f9010ca432f9849200d.jpeg"/><meta property="og:image" content="/build/df49524368335f9010ca432f9849200d.jpeg"/><link rel="stylesheet" href="/build/_assets/app-HG4THSM4.css"/><link rel="stylesheet" href="/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="flex items-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="m-1"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Tom Nicholas</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"><div class="relative inline-block mx-2 grow-0"><a class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" href="/about">About</a></div><div class="relative inline-block mx-2 grow-0"><a class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75" href="/talks">Talks</a></div><div class="relative inline-block mx-2 grow-0"><a aria-current="page" class="inline-flex items-center justify-center w-full mx-2 py-1 text-md font-medium dark:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75 border-b border-stone-200" href="/blog">Blog</a></div></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3iop:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode." aria-label="Toggle theme between light and dark mode."><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="fixed xl:article-grid grid-gap xl:w-screen xl:pointer-events-none overflow-auto max-xl:min-w-[300px] hidden z-10" style="top:60px"><div class="pointer-events-auto xl:col-margin-left flex-col overflow-hidden hidden xl:flex"><div class="flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px] lg:hidden"><div class="w-full px-1 dark:text-white"><a class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded" href="/about">About</a><a class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded" href="/talks">Talks</a><a aria-current="page" class="p-2 my-1 rounded-lg hover:bg-slate-300/30 block break-words focus:outline outline-blue-200 outline-2 rounded active" href="/blog">Blog</a></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white"><a title="Welcome" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/">Welcome</a><a title="About me" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/about">About me</a><a title="Talks" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/talks">Talks</a><div data-state="open" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><a title="Blog" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 active" href="/blog">Blog</a><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rjd8p:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:Rjd8p:" class="pl-3 pr-[2px] collapsible-content"><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2025" class="block break-words rounded py-2 grow cursor-pointer">2025</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rdjd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rdjd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2024" class="block break-words rounded py-2 grow cursor-pointer">2024</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rljd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rljd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2023" class="block break-words rounded py-2 grow cursor-pointer">2023</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rtjd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rtjd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="open" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2022" class="block break-words rounded py-2 grow font-semibold text-blue-800 dark:text-blue-200 cursor-pointer">2022</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R15jd8p:" aria-expanded="true" data-state="open"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="open" id="radix-:R15jd8p:" class="pl-3 pr-[2px] collapsible-content"><a title="Easy IPCC part 1: Multi-Model Datatree" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg hover:bg-slate-300/30" href="/blog/2022/easy-ipcc-datatree">Easy IPCC part 1: Multi-Model Datatree</a><a title="Unit-aware arithmetic in Xarray, via pint" aria-current="page" class="block break-words focus:outline outline-blue-200 outline-2 rounded p-2 my-1 rounded-lg bg-blue-300/30 active" href="/blog/2022/pint-xarray">Unit-aware arithmetic in Xarray, via pint</a></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2020" class="block break-words rounded py-2 grow cursor-pointer">2020</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1djd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1djd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="flex flex-row w-full gap-2 px-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="2019" class="block break-words rounded py-2 grow cursor-pointer">2019</div><button class="self-center flex-none rounded-md group hover:bg-slate-300/30 focus:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1ljd8p:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1ljd8p:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></div></div></nav></div><div class="flex-none py-6 transition-all duration-700 translate-y-6 opacity-0"><a class="flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://github.com/TomNicholas/tomnicholas.github.io" title="GitHub Repository: TomNicholas/tomnicholas.github.io" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rd4fop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Unit-aware arithmetic in Xarray, via pint</h1><header class="mt-4 not-prose"><div><span class="font-semibold text-sm inline-block"><button class="focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3kfop:" data-state="closed">Tom Nicholas</button><a class="ml-1" href="https://orcid.org/0000-0002-2176-0530" target="_blank" rel="noopener noreferrer" title="ORCID (Open Researcher and Contributor ID)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1rem" height="1rem" class="inline-block text-gray-400 hover:text-[#A9C751] -translate-y-[0.1em]"><path d="M21.8 12c0 5.4-4.4 9.8-9.8 9.8S2.2 17.4 2.2 12 6.6 2.2 12 2.2s9.8 4.4 9.8 9.8zM8.2 5.8c-.4 0-.8.3-.8.8s.3.8.8.8.8-.4.8-.8-.3-.8-.8-.8zm2.3 9.6h1.2v-6h1.8c2.3 0 3.3 1.4 3.3 3s-1.5 3-3.3 3h-3v1.1H9V8.3H7.7v8.2h5.9c3.3 0 4.5-2.2 4.5-4.1s-1.2-4.1-4.3-4.1h-3.2l-.1 7.1z"></path></svg></a></span></div></header><div class="flex mt-2 text-sm font-light"><time dateTime="2022-08-30" class="">August 30, 2022</time></div></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><p>(This post was originally published on the <a target="_blank" rel="noreferrer" href="https://xarray.dev/blog/introducing-pint-xarray" class="">xarray blog</a>.)</p><p><em>TLDR: Pint-Xarray supports unit-aware operations by wrapping <a target="_blank" rel="noreferrer" href="https://pint.readthedocs.io/en/stable/" class="">pint arrays</a>, so your code can automatically track the physical units that your data represents:</em></p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">distance = xr.DataArray(10).pint.quantify(&quot;metres&quot;)
time = xr.DataArray(4).pint.quantify(&quot;seconds&quot;)

distance / time</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Out:
&lt;xarray.DataArray ()&gt;
&lt;Quantity(2.5, &#x27;meter / second&#x27;)&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="units-are-integral-to-science" class="relative group"><span class="heading-text">Units are integral to science</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#units-are-integral-to-science" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>All quantities in science have units, whether explicitly or implicitly. (And even dimensionless quantities like ratios still technically have units.)</p><p>Getting our units right is finicky, and can very easily go unnoticed in our code.</p><p>Even worse, the consequences of getting units wrong can be huge!</p><p>The most famous example of a units error has to be NASA’s $125 million <a target="_blank" rel="noreferrer" href="https://www.simscale.com/blog/2017/12/nasa-mars-climate-orbiter-metric/" class="">Mars Climate Orbiter</a>, which in 1999 burned up in the Martian atmosphere instead of successfully entering orbit around Mars.
A trajectory course correction had gone wrong, and the error was eventually traced back to a units mismatch: the engineers at Lockheed Martin expressed impulse in <a href="https://en.wikipedia.org/wiki/Pound_(force)" class="italic" target="_blank" rel="noreferrer" data-state="closed">pound-force</a> seconds, whereas the engineers at JPL assumed the impulse value their part of the software received was in SI newton seconds.</p><p><img id="F4odqOUyRh" style="margin:0 auto" src="/build/df49524368335f9010ca432f9849200d.jpeg" data-canonical-url="https://web.archive.org/web/20191116161743/https://clqtg10snjb14i85u49wifbv-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Customers.jpg"/></p><p>Newspaper cartoon depicting the incongruence in the units used by NASA and Lockheed Martin scientists that led to the Mars Climate Orbiter disaster.</p><p>We should take stories like this seriously: If we can automatically track units we can potentially eliminate a whole class of possible errors in our scientific work...</p><h2 id="pint-tracks-units" class="relative group"><span class="heading-text">Pint tracks units</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#pint-tracks-units" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>There are a few packages for handling units in python (notably <a target="_blank" rel="noreferrer" href="https://github.com/yt-project/unyt" class="">unyt</a> and <a target="_blank" rel="noreferrer" href="https://docs.astropy.org/en/stable/units/" class="">astropy.units</a>), but for technical reasons we began units integration in Xarray with <a target="_blank" rel="noreferrer" href="https://pint.readthedocs.io/en/stable/" class="">pint</a>.
These various packages work by providing a numerical array type that acts similarly to a NumPy array, and is intended to plug in and replace the raw NumPy array (a so-called “duck array type”).</p><p>Pint provides the <code>Quantity</code> object, which is a normal numpy array combined with a <code>pint.Unit</code>:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">q = np.array([6, 7]) * pint.Unit(&#x27;metres&#x27;)
print(repr(q))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Out:
&lt;Quantity([6 7], &#x27;meter&#x27;)&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Pint Quantities act like NumPy arrays, except that the units are carried around with the arrays, propagated through operations, and checked during operations involving multiple quantities.</p><h2 id="xarray-now-wraps-pint" class="relative group"><span class="heading-text">Xarray now wraps Pint</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#xarray-now-wraps-pint" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Thanks to the <a href="https://github.com/pydata/xarray/issues/3594" class="italic" target="_blank" rel="noreferrer" data-state="closed">tireless work</a> of Xarray core developer <a target="_blank" rel="noreferrer" href="https://github.com/keewis" class="">Justus Magin</a>, you can now enjoy this automatic unit-handling in Xarray!</p><p>Once you create a unit-aware Xarray object (see below for how) you can see the units of the data variables displayed as part of the printable representation.
You also immediately get the key benefits of Pint:</p><ol start="1"><li><p>Units are propagated through arithmetic, and new quantities are built using the units of the inputs:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">distance = xr.DataArray(10).pint.quantify(&quot;metres&quot;)
time = xr.DataArray(4).pint.quantify(&quot;seconds&quot;)

distance / time</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Out:
&lt;xarray.DataArray ()&gt;
&lt;Quantity(2.5, &#x27;meter / second&#x27;)&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></li><li><p>Dimensionally inconsistent units are caught automatically:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">apples = xr.DataArray(10).pint.quantify(&quot;kg&quot;)
oranges = xr.DataArray(200).pint.quantify(&quot;cm^3&quot;)

apples + oranges</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Out:
DimensionalityError: Cannot convert from &#x27;kilogram&#x27; ([mass]) to &#x27;centimeter ** 3&#x27; ([length] ** 3)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></li><li><p>Unit conversions become simple:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">walk = xr.DataArray(500).pint.quantify(&#x27;miles&#x27;)

walk.pint.to(&#x27;parsecs&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Out:
&lt;xarray.DataArray ()&gt;
&lt;Quantity(2.6077643524162074e-11, &#x27;parsec&#x27;)&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div></li></ol><p>With these features, you can build code that automatically propagates units and converts them where necessary to stay consistent.
For example, the problem of the NASA orbiter could have been prevented by explicitly converting to the correct units at the start</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def jpl_trajectory_code(impulse):

    # Defensively check units first
    impulse = impulse.pint.to(&quot;Newton * seconds&quot;)

    # This function we called here will only compute the correct result if supplied input in units of Newton-seconds,
    # but that&#x27;s fine because we already converted the values to be in the correct units!
    propagated_position = some_rocket_science(impulse)

    return propagated_position</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Note: We are adding <a href="https://github.com/xarray-contrib/pint-xarray/pull/143" class="italic" target="_blank" rel="noreferrer" data-state="closed">new features</a> to make specifying the units of parameters of existing library functions more slick.</p><p>In the abstract, tracking units like this is useful in the same way that labelling dimensions with Xarray is useful: it helps us avoid errors by relieving us of the burden of remembering arbitrary information about our data.</p><h2 id="quantifying-with-pint-xarray" class="relative group"><span class="heading-text">Quantifying with pint-xarray</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#quantifying-with-pint-xarray" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>The easiest way to create a unit-aware Xarray object is to use the helper package we made: <a target="_blank" rel="noreferrer" href="https://github.com/xarray-contrib/pint-xarray" class="">pint-xarray</a>.
Once you <code>import pint_xarray</code> you can access unit-related functionality via <code>.pint</code> on any <code>DataArray</code> or <code>Dataset</code> (this works via <a target="_blank" rel="noreferrer" href="https://xarray.pydata.org/en/stable/internals/extending-xarray.html" class="">Xarray’s accessor interface</a>).</p><p>Above we have seen examples of quantifying explicitly, where we specify the units in the call to <code>.quantify()</code>.
We can do this for multiple variables too, and we can also pass <code>pint.Unit</code> instances:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">ds = xr.Dataset({&#x27;a&#x27;: 2, &#x27;b&#x27;: 10})

ds.pint.quantify({&#x27;a&#x27;: &#x27;kg&#x27;,
                  &#x27;b&#x27;: pint.Unit(&#x27;moles&#x27;)})</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Out:
&lt;xarray.Dataset&gt;
Dimensions:  ()
Data variables:
    a        int64 [kg] 2
    b        int64 [mol] 10</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Alternatively, we can quantify from the object’s <code>.attrs</code>, automatically reading the metadata which xarray objects carry around.
If nothing is passed to <code>.quantify()</code>, it will attempt to parse the <code>.attrs[&#x27;units&#x27;]</code> entry for each data variable.</p><p>This means that for scientific datasets which are stored as files with units in their attributes (which netCDF and Zarr can do for example), using Pint with Xarray becomes as simple as:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import pint_xarray

ds = open_dataset(filepath).pint.quantify()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="dequantifying" class="relative group"><span class="heading-text">Dequantifying</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#dequantifying" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>To convert our pint arrays back into NumPy arrays, we can use <code>.dequantify</code>.
This will strip the units from the arrays and replace them into the <code>.attrs[&#x27;units&#x27;]</code> of each variable.
This is useful when we want to save our data back to a file, as it means that the current units will be preserved in the attributes of a netCDF file (or Zarr store etc.), as long as we just do <code>ds.pint.dequantify().to_netcdf(...)</code>.</p><h2 id="dask-integration" class="relative group"><span class="heading-text">Dask integration</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#dask-integration" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>So Xarray can wrap Dask arrays, and now it can wrap Pint quantities… Can we use both together? Yes!</p><p>You can get a unit-aware, Dask-backed array either by <code>.pint.quantify()</code>-ing a chunked array, or you can <code>.pint.chunk()</code> a quantified array.
(If you have Dask installed, then <code>open_dataset(f, chunks={}).pint.quantify()</code> will already give you a Dask-backed, quantified array.)
From there you can <code>.compute()</code> the Dask-backed objects as normal, and the units will be retained.</p><p>(Under the hood we now have an <code>xarray.DataArray</code> wrapping a <code>pint.Quantity</code>, which wraps a <code>dask.array.Array</code>, which wraps a <code>numpy.ndarray</code>.
This “multi-nested duck array” approach can be generalised to include other array libraries (e.g. <code>scipy.sparse</code>), but requires <a target="_blank" rel="noreferrer" href="https://github.com/pydata/duck-array-discussion" class="">coordination</a> between the maintainers of the libraries involved.)</p><h2 id="unit-aware-indexes" class="relative group"><span class="heading-text">Unit-aware indexes</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#unit-aware-indexes" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We would love to be able to promote Xarray indexes to Pint Quantities, as that would allow you to select data subsets in a unit-aware manner like:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">da = xr.DataArray(name=&#x27;a&#x27;, data=[0, 1, 2], dims=&#x27;x&#x27;, coords={&#x27;x&#x27;: [1000, 2000, 3000]})
da = da.pint.quantify({&#x27;a&#x27;: &#x27;Pa&#x27;, &#x27;x&#x27;: &#x27;m&#x27;})

da.pint.sel(x=2 * &#x27;km&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Unfortunately this will not possible until the ongoing work to extend Xarray to support <a href="https://github.com/pydata/xarray/issues/1603" class="italic" target="_blank" rel="noreferrer" data-state="closed">explicit indexes</a> is complete.</p><p>In the meantime pint-xarray offers a workaround. If you tell <code>.quantify</code> the units you wish an index to have, it will store those in <code>.attrs[&quot;units&quot;]</code> instead.</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">time = xr.DataArray([0.1, 0.2, 0.3], dims=&#x27;time&#x27;)
distance = xr.DataArray(name=&#x27;distance&#x27;,
                        data=[10, 20, 25],
                        dims=[&#x27;time&#x27;],
                        coords={&#x27;time&#x27;: time})
distance = distance.pint.quantify({&#x27;distance&#x27;: &#x27;metres&#x27;,
                                   &#x27;time&#x27;: &#x27;seconds&#x27;})
print(distance.coords[&#x27;time&#x27;].attrs)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Out:
{&#x27;units&#x27;: &lt;Unit(&#x27;second&#x27;)&gt;}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>This allows us to provide conveniently wrapped versions of common xarray methods like <code>.sel</code>, so that you can still select subsets of data in a unit-aware fashion like this:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">distance.pint.sel(time=200 * pint.Unit(&#x27;milliseconds&#x27;))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Out:
&lt;xarray.DataArray &#x27;distance&#x27; ()&gt;
&lt;Quantity(20, &#x27;meter&#x27;)&gt;
Coordinates:
    time     float64 200.0</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Observe how the <code>.pint.sel</code> operation has first converted 200 milliseconds to 0.2 seconds, before finding the distance value that occurs at a time position of 0.2 seconds.</p><p><a target="_blank" rel="noreferrer" href="https://xarray.pydata.org/en/stable/user-guide/duckarrays.html#missing-features" class="">This wrapping is currently necessary</a> for any operation which needs to be aware of the units of a dimension coordinate of the dataarray, or any xarray operation which relies on an external library (such as calling <code>scipy</code> in <code>.integrate</code>).</p><h2 id="cf-compliant-units-for-geosciences-with-cf-xarray" class="relative group"><span class="heading-text">CF-compliant units for geosciences with cf-xarray</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#cf-compliant-units-for-geosciences-with-cf-xarray" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Different fields tend to have different niche conventions about how certain units are defined.
By default, Pint doesn’t understand all the unusual units and conventions we use in geosciences.
But <a target="_blank" rel="noreferrer" href="https://pint.readthedocs.io/en/stable/defining.html" class="">Pint is customisable</a>, and with the help of <a target="_blank" rel="noreferrer" href="https://github.com/xarray-contrib/cf-xarray" class="">cf-xarray</a> we can teach it about these geoscience-specific units.</p><p>If we <code>import cf_xarray.units</code> (before <code>import pint_xarray</code>) then we can <code>quantify</code> example climate data from the <a target="_blank" rel="noreferrer" href="https://pangeo-data.github.io/pangeo-cmip6-cloud/" class="">Pangeo Project’s CMIP6 catalog</a>:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import xarray as xr
import cf_xarray.units
import pint_xarray

ds = xr.open_dataset(&#x27;gs://cmip6/CMIP6/CMIP/NCAR/CESM2-FV2/historical/r2i1p1f1/Amon/sfcWind/gn/v20200226/&#x27;, engine=&#x27;zarr&#x27;)
ds = ds.pint.quantify()

squared_wind = ds[&#x27;sfcWind&#x27;] ** 2
squared_wind.pint.units</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">Out:
&lt;Unit(&#x27;meter ** 2 / second ** 2&#x27;)&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Here (thanks to <code>cf_xarray</code>) pint has successfully interpreted the CF-style units <code>&#x27;m s-1&#x27;</code>, then automatically changed them when we squared the wind speed.</p><h2 id="plotting" class="relative group"><span class="heading-text">Plotting</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plotting" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>We can complete our real-world example by plotting the data in its new units:</p><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm bg-stone-200/10"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import cartopy.crs as ccrs
import matplotlib.pyplot as plt

p = squared_wind.isel(time=&quot;2014-01&quot;).plot(
    subplot_kws=dict(projection=ccrs.Orthographic(-80, 35), facecolor=&quot;gray&quot;),
    transform=ccrs.PlateCarree(),
)
p.axes.set_global()
p.axes.coastlines()
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><img id="zaqWFa03fp" style="margin:0 auto" src="/build/squared_wind-1da222802a48a2daa9fe78238303300a.png" alt="cartopy plot of a quantified dataset" data-canonical-url="/images/squared_wind.png"/><p>where <code>xarray.plot</code> has detected the Pint units automatically.</p><h2 id="conclusion" class="relative group"><span class="heading-text">Conclusion</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#conclusion" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Please have a go! You will need xarray (v2022.03.0+), pint (0.18+), and pint-xarray (0.3+).</p><p>Please also tell us about any bugs you find, or documentation suggestions you have on the <a target="_blank" rel="noreferrer" href="https://github.com/pydata/xarray/issues" class="">Xarray</a> or <a target="_blank" rel="noreferrer" href="https://github.com/xarray-contrib/pint-xarray/issues" class="">pint-xarray issue trackers</a>.
If you have usage questions you can raise them there, on the <a target="_blank" rel="noreferrer" href="https://github.com/pydata/xarray/discussions" class="">Xarray discussions page</a>, or on the <a target="_blank" rel="noreferrer" href="https://discourse.pangeo.io/" class="">Pangeo Discourse forum</a>.</p><p>The work here to allow Xarray to wrap Pint objects is part of a <a target="_blank" rel="noreferrer" href="http://xarray.pydata.org/en/stable/roadmap.html#flexible-arrays" class="">broader effort to generalise Xarray</a> to handle a wide variety of data types (so-called “duck array wrapping”).
Along with the incoming <a target="_blank" rel="noreferrer" href="http://xarray.pydata.org/en/stable/roadmap.html#flexible-indexes" class="">support for flexible indexes</a>, we are excited for all the new features that this will enable for Xarray users!</p><div></div><div class="flex pt-10 mb-10 space-x-4"><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/blog/2022/easy-ipcc-datatree"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="text-xs text-gray-500 dark:text-gray-400">2022</div>Easy IPCC part 1: Multi-Model Datatree</div></div></a><a class="flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700" href="/blog/2020/covid19-model"><div class="flex h-full align-middle"><div class="flex-grow"><div class="text-xs text-gray-500 dark:text-gray-400">2020</div>Coronavirus: The Simplest Model</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/build/_shared/chunk-IZFMW3M4.js"/><link rel="modulepreload" href="/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/build/_shared/chunk-CPTH56EW.js"/><link rel="modulepreload" href="/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/build/_shared/chunk-S4SWV34C.js"/><link rel="modulepreload" href="/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/build/root-QGLRP2PL.js"/><link rel="modulepreload" href="/build/_shared/chunk-CB3BH7WY.js"/><link rel="modulepreload" href="/build/routes/$-7JYT5576.js"/><script>window.__remixContext = {"url":"/blog/2022/pint-xarray","state":{"loaderData":{"root":{"config":{"version":1,"myst":"1.3.25","options":{"favicon":"/build/profile-color-circle-ed8da0be2c156ab6181c071b2ce81a86.png","logo_text":"Tom Nicholas","folders":true},"nav":[{"title":"About","url":"/about"},{"title":"Talks","url":"/talks"},{"title":"Blog","url":"/blog"}],"actions":[],"projects":[{"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"title":"Welcome","thumbnail":"/build/profile-color-circle-17a434cb07f7c7cd017474554e1c5699.png","authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","references":{"ttw":{"url":"https://book.the-turing-way.org"}},"toc":[{"file":"index.md"},{"file":"about.md"},{"file":"talks.md"},{"children":[{"children":[{"pattern":"blog/2025/**{.ipynb,.md}"}],"title":"2025"},{"children":[{"pattern":"blog/2024/**{.ipynb,.md}"}],"title":"2024"},{"children":[{"pattern":"blog/2023/**{.ipynb,.md}"}],"title":"2023"},{"children":[{"pattern":"blog/2022/**{.ipynb,.md}"}],"title":"2022"},{"children":[{"pattern":"blog/2020/**{.ipynb,.md}"}],"title":"2020"},{"children":[{"pattern":"blog/2019/**{.ipynb,.md}"}],"title":"2019"}],"file":"blog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"about","title":"About me","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"talks","title":"Talks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"blog","title":"Blog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":2,"title":"2025"},{"slug":"blog.2025.cloud-optimized-scientific-data","title":"Fundamentals: What is Cloud-Optimized Scientific Data?","description":"The article I wish I could have read back when I first heard of Zarr in 2018. Explains how object storage and conventional filesystems are different, and the key properties that make Zarr work so well in cloud object storage.\n","date":"2025-04-17","thumbnail":"/build/hdf5-layout-2c4216e4d2a574ec9b58200559b84bb9.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["cloud","zarr","netcdf","earthmover","open-science"],"level":3},{"slug":"blog.2025.science-needs-a-social-network","title":"Science needs a social network for sharing big data","description":"Imagine being able to visit one website, search for any scientific dataset from any institution in the world, preview it, then stream the data out at high speed, in the format you prefer. We have the technology - here's what we should build.\n","date":"2025-01-18","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["open-science","frost"],"level":3},{"level":2,"title":"2024"},{"slug":"blog.2024.datatree","title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","description":"How xarray's new DataTree feature came about, and thoughts on how public agencies can support the open-source scientific software that they depend on.\n","date":"2024-12-19","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science"],"level":3},{"level":2,"title":"2023"},{"slug":"blog.2023.cubed-xarray","title":"Cubed: Bounded-memory serverless array processing in xarray","description":"Cubed was designed to address the main problems with Dask, so I integrated it with Xarray. \n","date":"2023-06-01","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","dask","cubed","open-science"],"level":3},{"slug":"blog.2023.dask-distributed","title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","description":"Dask's distributed scheduler algorithm got a major fix after we tested its' limits on a huge oceanography analysis problem.\n","date":"2023-01-04","thumbnail":"/build/f8821db67c2a5f1f07b570e6bed342cc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","dask","open-science"],"level":3},{"level":2,"title":"2022"},{"slug":"blog.2022.easy-ipcc-datatree","title":"Easy IPCC part 1: Multi-Model Datatree","description":"Analysing CMPI6 data as a motivation for xarray DataTree.\n","date":"2022-08-29","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science","climate-science","datatree"],"level":3},{"slug":"blog.2022.pint-xarray","title":"Unit-aware arithmetic in Xarray, via pint","description":"All scientific computations involve units, so let's make our analysis software aware of them.\n","date":"2022-08-30","thumbnail":"/build/df49524368335f9010ca432f9849200d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","pint","open-science","physical-units"],"level":3},{"level":2,"title":"2020"},{"slug":"blog.2020.covid19-model","title":"Coronavirus: The Simplest Model","description":"Solving the simplest possible epidemiological model of the spread of COVID-19.\n","date":"2020-03-20","thumbnail":"/build/SIRD_states-f8d070ce0279e9fd952cd6c245e75350.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","modelling","covid-19"],"level":3},{"slug":"blog.2020.deep-pseudoscience","title":"The faulty science, doomism, and flawed conclusions of Deep Adaptation","description":"Calling out pseudoscience claiming that societal collapse due to climate change is inevitable. \n","date":"2020-07-14","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate-science","misinformation"],"level":3},{"slug":"blog.2020.oxford-divests","title":"Oxford University Divestment Explained","description":"Thought's on Oxford University's fossil fuel divestment motion.\n","date":"2020-04-22","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate","oxford"],"level":3},{"level":2,"title":"2019"},{"slug":"blog.2019.theconversation-fusion","title":"Nuclear Fusion: too late for the climate","description":"Don't let politicians use funding for nuclear fusion research as greenwashing.\n","date":"2019-09-30","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["fusion","energy","climate"],"level":3}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static"},"routes/$":{"config":{"version":1,"myst":"1.3.25","options":{"favicon":"/build/profile-color-circle-ed8da0be2c156ab6181c071b2ce81a86.png","logo_text":"Tom Nicholas","folders":true},"nav":[{"title":"About","url":"/about"},{"title":"Talks","url":"/talks"},{"title":"Blog","url":"/blog"}],"actions":[],"projects":[{"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"title":"Welcome","thumbnail":"/build/profile-color-circle-17a434cb07f7c7cd017474554e1c5699.png","authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","references":{"ttw":{"url":"https://book.the-turing-way.org"}},"toc":[{"file":"index.md"},{"file":"about.md"},{"file":"talks.md"},{"children":[{"children":[{"pattern":"blog/2025/**{.ipynb,.md}"}],"title":"2025"},{"children":[{"pattern":"blog/2024/**{.ipynb,.md}"}],"title":"2024"},{"children":[{"pattern":"blog/2023/**{.ipynb,.md}"}],"title":"2023"},{"children":[{"pattern":"blog/2022/**{.ipynb,.md}"}],"title":"2022"},{"children":[{"pattern":"blog/2020/**{.ipynb,.md}"}],"title":"2020"},{"children":[{"pattern":"blog/2019/**{.ipynb,.md}"}],"title":"2019"}],"file":"blog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"about","title":"About me","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"talks","title":"Talks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"blog","title":"Blog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":2,"title":"2025"},{"slug":"blog.2025.cloud-optimized-scientific-data","title":"Fundamentals: What is Cloud-Optimized Scientific Data?","description":"The article I wish I could have read back when I first heard of Zarr in 2018. Explains how object storage and conventional filesystems are different, and the key properties that make Zarr work so well in cloud object storage.\n","date":"2025-04-17","thumbnail":"/build/hdf5-layout-2c4216e4d2a574ec9b58200559b84bb9.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["cloud","zarr","netcdf","earthmover","open-science"],"level":3},{"slug":"blog.2025.science-needs-a-social-network","title":"Science needs a social network for sharing big data","description":"Imagine being able to visit one website, search for any scientific dataset from any institution in the world, preview it, then stream the data out at high speed, in the format you prefer. We have the technology - here's what we should build.\n","date":"2025-01-18","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["open-science","frost"],"level":3},{"level":2,"title":"2024"},{"slug":"blog.2024.datatree","title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","description":"How xarray's new DataTree feature came about, and thoughts on how public agencies can support the open-source scientific software that they depend on.\n","date":"2024-12-19","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science"],"level":3},{"level":2,"title":"2023"},{"slug":"blog.2023.cubed-xarray","title":"Cubed: Bounded-memory serverless array processing in xarray","description":"Cubed was designed to address the main problems with Dask, so I integrated it with Xarray. \n","date":"2023-06-01","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","dask","cubed","open-science"],"level":3},{"slug":"blog.2023.dask-distributed","title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","description":"Dask's distributed scheduler algorithm got a major fix after we tested its' limits on a huge oceanography analysis problem.\n","date":"2023-01-04","thumbnail":"/build/f8821db67c2a5f1f07b570e6bed342cc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","dask","open-science"],"level":3},{"level":2,"title":"2022"},{"slug":"blog.2022.easy-ipcc-datatree","title":"Easy IPCC part 1: Multi-Model Datatree","description":"Analysing CMPI6 data as a motivation for xarray DataTree.\n","date":"2022-08-29","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science","climate-science","datatree"],"level":3},{"slug":"blog.2022.pint-xarray","title":"Unit-aware arithmetic in Xarray, via pint","description":"All scientific computations involve units, so let's make our analysis software aware of them.\n","date":"2022-08-30","thumbnail":"/build/df49524368335f9010ca432f9849200d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","pint","open-science","physical-units"],"level":3},{"level":2,"title":"2020"},{"slug":"blog.2020.covid19-model","title":"Coronavirus: The Simplest Model","description":"Solving the simplest possible epidemiological model of the spread of COVID-19.\n","date":"2020-03-20","thumbnail":"/build/SIRD_states-f8d070ce0279e9fd952cd6c245e75350.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","modelling","covid-19"],"level":3},{"slug":"blog.2020.deep-pseudoscience","title":"The faulty science, doomism, and flawed conclusions of Deep Adaptation","description":"Calling out pseudoscience claiming that societal collapse due to climate change is inevitable. \n","date":"2020-07-14","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate-science","misinformation"],"level":3},{"slug":"blog.2020.oxford-divests","title":"Oxford University Divestment Explained","description":"Thought's on Oxford University's fossil fuel divestment motion.\n","date":"2020-04-22","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate","oxford"],"level":3},{"level":2,"title":"2019"},{"slug":"blog.2019.theconversation-fusion","title":"Nuclear Fusion: too late for the climate","description":"Don't let politicians use funding for nuclear fusion research as greenwashing.\n","date":"2019-09-30","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["fusion","energy","climate"],"level":3}]}]},"page":{"version":1,"kind":"Notebook","sha256":"24b0b8339b9a717843819956884407a2e8783202ba5ad6a371c734486d7b2ab2","slug":"blog.2022.pint-xarray","location":"/blog/2022/pint-xarray.md","dependencies":[],"frontmatter":{"title":"Unit-aware arithmetic in Xarray, via pint","description":"All scientific computations involve units, so let's make our analysis software aware of them.\n","tags":["code","python","xarray","pint","open-science","physical-units"],"date":"2022-08-30","kernelspec":{"name":"python3","display_name":"Python 3"},"authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"numbering":{"title":{"offset":2}},"edit_url":"https://github.com/TomNicholas/tomnicholas.github.io/blob/main/blog/2022/pint-xarray.md","thumbnail":"/build/df49524368335f9010ca432f9849200d.jpeg","exports":[{"format":"md","filename":"pint-xarray.md","url":"/build/pint-xarray-8aefb9c49437de0bf64b87ce22e131a3.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"(This post was originally published on the ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"gNUMMUsPRr"},{"type":"link","url":"https://xarray.dev/blog/introducing-pint-xarray","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"xarray blog","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"R4cdP10OgI"}],"urlSource":"https://xarray.dev/blog/introducing-pint-xarray","key":"qnujPOC4hW"},{"type":"text","value":".)","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"oz3ZzkPiMm"}],"key":"ILrwfmCAob"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"TLDR: Pint-Xarray supports unit-aware operations by wrapping ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"vWrEzicrjJ"},{"type":"link","url":"https://pint.readthedocs.io/en/stable/","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"pint arrays","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"JJ4Zm0hZo8"}],"urlSource":"https://pint.readthedocs.io/en/stable/","key":"uo47AN8Uct"},{"type":"text","value":", so your code can automatically track the physical units that your data represents:","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"msjJwd5ls3"}],"key":"sM8GD6VjaO"}],"key":"QRGBUhOAov"},{"type":"code","lang":"python","value":"distance = xr.DataArray(10).pint.quantify(\"metres\")\ntime = xr.DataArray(4).pint.quantify(\"seconds\")\n\ndistance / time","position":{"start":{"line":22,"column":1},"end":{"line":27,"column":1}},"key":"SY94B5EIhL"},{"type":"code","lang":"","value":"Out:\n\u003cxarray.DataArray ()\u003e\n\u003cQuantity(2.5, 'meter / second')\u003e","position":{"start":{"line":29,"column":1},"end":{"line":33,"column":1}},"key":"DGOTIanfXT"},{"type":"heading","depth":2,"position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"Units are integral to science","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"F1RZDHz5iV"}],"identifier":"units-are-integral-to-science","label":"Units are integral to science","html_id":"units-are-integral-to-science","implicit":true,"key":"LsBDQJIEYr"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"All quantities in science have units, whether explicitly or implicitly. (And even dimensionless quantities like ratios still technically have units.)","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"fCsk2nq6No"}],"key":"Gr2Dbxf43v"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Getting our units right is finicky, and can very easily go unnoticed in our code.","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"iEH18Tgx8O"}],"key":"DmRVihGrSE"},{"type":"paragraph","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"Even worse, the consequences of getting units wrong can be huge!","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"ydnT7xAlc6"}],"key":"LviHwQF5ed"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"The most famous example of a units error has to be NASA’s $125 million ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"XIYklURQMH"},{"type":"link","url":"https://www.simscale.com/blog/2017/12/nasa-mars-climate-orbiter-metric/","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"Mars Climate Orbiter","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"gh2hjUacpP"}],"urlSource":"https://www.simscale.com/blog/2017/12/nasa-mars-climate-orbiter-metric/","key":"MgXFFS1n9f"},{"type":"text","value":", which in 1999 burned up in the Martian atmosphere instead of successfully entering orbit around Mars.\nA trajectory course correction had gone wrong, and the error was eventually traced back to a units mismatch: the engineers at Lockheed Martin expressed impulse in ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"NDAfQCOem8"},{"type":"link","url":"https://en.wikipedia.org/wiki/Pound_(force)","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"pound-force","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"V0ARjgNMH1"}],"urlSource":"https://en.wikipedia.org/wiki/Pound_(force)","data":{"page":"Pound_(force)","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"dqdaWtmU4w"},{"type":"text","value":" seconds, whereas the engineers at JPL assumed the impulse value their part of the software received was in SI newton seconds.","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"YzlssF74ho"}],"key":"PvT7Nkh475"},{"type":"paragraph","children":[{"type":"image","url":"/build/df49524368335f9010ca432f9849200d.jpeg","key":"F4odqOUyRh","urlSource":"https://web.archive.org/web/20191116161743/https://clqtg10snjb14i85u49wifbv-wpengine.netdna-ssl.com/wp-content/uploads/2017/12/Customers.jpg"}],"key":"m5uQyejdQg"},{"type":"paragraph","children":[{"type":"text","value":"Newspaper cartoon depicting the incongruence in the units used by NASA and Lockheed Martin scientists that led to the Mars Climate Orbiter disaster.","key":"nwAcsEBL5w"}],"key":"Rviasuso3J"},{"type":"paragraph","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"We should take stories like this seriously: If we can automatically track units we can potentially eliminate a whole class of possible errors in our scientific work...","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"Lf4q6Jg9kE"}],"key":"cGWTlXsXRC"},{"type":"heading","depth":2,"position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"Pint tracks units","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"h1Ye1xyco7"}],"identifier":"pint-tracks-units","label":"Pint tracks units","html_id":"pint-tracks-units","implicit":true,"key":"ibNRfMz422"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"There are a few packages for handling units in python (notably ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"moUfAm7Mvy"},{"type":"link","url":"https://github.com/yt-project/unyt","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"unyt","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"hZ5sDoiG7q"}],"urlSource":"https://github.com/yt-project/unyt","error":true,"key":"I5XYQqdQ93"},{"type":"text","value":" and ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"YkxbJJRcrs"},{"type":"link","url":"https://docs.astropy.org/en/stable/units/","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"astropy.units","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"P3UB442vik"}],"urlSource":"https://docs.astropy.org/en/stable/units/","key":"hvjW3eDvmi"},{"type":"text","value":"), but for technical reasons we began units integration in Xarray with ","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"bv44JWIrWG"},{"type":"link","url":"https://pint.readthedocs.io/en/stable/","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"pint","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"trVWP5W8SZ"}],"urlSource":"https://pint.readthedocs.io/en/stable/","key":"gwXrOgOZZs"},{"type":"text","value":".\nThese various packages work by providing a numerical array type that acts similarly to a NumPy array, and is intended to plug in and replace the raw NumPy array (a so-called “duck array type”).","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"OtesJm8tku"}],"key":"DmOMUflrSq"},{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"Pint provides the ","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"fHbNZTf2FN"},{"type":"inlineCode","value":"Quantity","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"iZ9Uj6m0S4"},{"type":"text","value":" object, which is a normal numpy array combined with a ","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"bRjmZl9Tir"},{"type":"inlineCode","value":"pint.Unit","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"jmjJHTqkkR"},{"type":"text","value":":","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"T8lWTwngdO"}],"key":"uCxoqRKPSY"},{"type":"code","lang":"python","value":"q = np.array([6, 7]) * pint.Unit('metres')\nprint(repr(q))","position":{"start":{"line":64,"column":1},"end":{"line":67,"column":1}},"key":"w6AozP7tTC"},{"type":"code","lang":"","value":"Out:\n\u003cQuantity([6 7], 'meter')\u003e","position":{"start":{"line":69,"column":1},"end":{"line":72,"column":1}},"key":"Q22sezlVyX"},{"type":"paragraph","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"text","value":"Pint Quantities act like NumPy arrays, except that the units are carried around with the arrays, propagated through operations, and checked during operations involving multiple quantities.","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"eXkwXXLsGf"}],"key":"Hg9wT5tkE5"},{"type":"heading","depth":2,"position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"Xarray now wraps Pint","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"KC9bCinW4Y"}],"identifier":"xarray-now-wraps-pint","label":"Xarray now wraps Pint","html_id":"xarray-now-wraps-pint","implicit":true,"key":"w9aroDPfXh"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Thanks to the ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"ABOJzPFBOR"},{"type":"link","url":"https://github.com/pydata/xarray/issues/3594","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"tireless work","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"iFRhjD4LfP"}],"urlSource":"https://github.com/pydata/xarray/issues/3594","data":{"kind":"issue","org":"pydata","repo":"xarray","issue_number":"3594"},"internal":false,"protocol":"github","key":"a8xgCwQzBz"},{"type":"text","value":" of Xarray core developer ","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"IPfoET6kon"},{"type":"link","url":"https://github.com/keewis","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"Justus Magin","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"WKX71UaC64"}],"urlSource":"https://github.com/keewis","error":true,"key":"hc6IL84YSj"},{"type":"text","value":", you can now enjoy this automatic unit-handling in Xarray!","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"IgYv8DWL5F"}],"key":"pY4grRqRon"},{"type":"paragraph","position":{"start":{"line":80,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"Once you create a unit-aware Xarray object (see below for how) you can see the units of the data variables displayed as part of the printable representation.\nYou also immediately get the key benefits of Pint:","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"dO8kF0lhim"}],"key":"HOJ2dCA3lD"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":83,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":83,"column":1},"end":{"line":97,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"Units are propagated through arithmetic, and new quantities are built using the units of the inputs:","position":{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},"key":"Ay6vYByntm"}],"key":"lh4xs5BlWx"},{"type":"code","lang":"python","value":"distance = xr.DataArray(10).pint.quantify(\"metres\")\ntime = xr.DataArray(4).pint.quantify(\"seconds\")\n\ndistance / time","position":{"start":{"line":85,"column":1},"end":{"line":90,"column":1}},"key":"KdctmGdzlD"},{"type":"code","lang":"","value":"Out:\n\u003cxarray.DataArray ()\u003e\n\u003cQuantity(2.5, 'meter / second')\u003e","position":{"start":{"line":92,"column":1},"end":{"line":96,"column":1}},"key":"e1P0mchdRm"}],"key":"SaodvlCRYe"},{"type":"listItem","spread":true,"position":{"start":{"line":98,"column":1},"end":{"line":111,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"Dimensionally inconsistent units are caught automatically:","position":{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},"key":"flbWZKAlFu"}],"key":"xKxjpQzfie"},{"type":"code","lang":"python","value":"apples = xr.DataArray(10).pint.quantify(\"kg\")\noranges = xr.DataArray(200).pint.quantify(\"cm^3\")\n\napples + oranges","position":{"start":{"line":100,"column":1},"end":{"line":105,"column":1}},"key":"YJ2mhbvtGO"},{"type":"code","lang":"","value":"Out:\nDimensionalityError: Cannot convert from 'kilogram' ([mass]) to 'centimeter ** 3' ([length] ** 3)","position":{"start":{"line":107,"column":1},"end":{"line":110,"column":1}},"key":"sqwTgk7WrK"}],"key":"lyZXOE8qDQ"},{"type":"listItem","spread":true,"position":{"start":{"line":112,"column":1},"end":{"line":125,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"children":[{"type":"text","value":"Unit conversions become simple:","position":{"start":{"line":112,"column":1},"end":{"line":112,"column":1}},"key":"osJkEtDlDp"}],"key":"g76GyjP3YR"},{"type":"code","lang":"python","value":"walk = xr.DataArray(500).pint.quantify('miles')\n\nwalk.pint.to('parsecs')","position":{"start":{"line":114,"column":1},"end":{"line":118,"column":1}},"key":"ZheKn7EGby"},{"type":"code","lang":"","value":"Out:\n\u003cxarray.DataArray ()\u003e\n\u003cQuantity(2.6077643524162074e-11, 'parsec')\u003e","position":{"start":{"line":120,"column":1},"end":{"line":124,"column":1}},"key":"CYBAIqoFMU"}],"key":"ZsNq1CGjE8"}],"key":"XT4jeuDB22"},{"type":"paragraph","position":{"start":{"line":126,"column":1},"end":{"line":127,"column":1}},"children":[{"type":"text","value":"With these features, you can build code that automatically propagates units and converts them where necessary to stay consistent.\nFor example, the problem of the NASA orbiter could have been prevented by explicitly converting to the correct units at the start","position":{"start":{"line":126,"column":1},"end":{"line":126,"column":1}},"key":"YSKBLBw9Xq"}],"key":"liSbFKEVoA"},{"type":"code","lang":"python","value":"def jpl_trajectory_code(impulse):\n\n    # Defensively check units first\n    impulse = impulse.pint.to(\"Newton * seconds\")\n\n    # This function we called here will only compute the correct result if supplied input in units of Newton-seconds,\n    # but that's fine because we already converted the values to be in the correct units!\n    propagated_position = some_rocket_science(impulse)\n\n    return propagated_position","position":{"start":{"line":129,"column":1},"end":{"line":140,"column":1}},"key":"UM5svsb7u3"},{"type":"paragraph","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"Note: We are adding ","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"r9emOmV3w3"},{"type":"link","url":"https://github.com/xarray-contrib/pint-xarray/pull/143","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"children":[{"type":"text","value":"new features","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"uNXIfwYnak"}],"urlSource":"https://github.com/xarray-contrib/pint-xarray/pull/143","data":{"kind":"issue","org":"xarray-contrib","repo":"pint-xarray","issue_number":"143"},"internal":false,"protocol":"github","key":"PoEW8OvN5M"},{"type":"text","value":" to make specifying the units of parameters of existing library functions more slick.","position":{"start":{"line":142,"column":1},"end":{"line":142,"column":1}},"key":"dXQHEEyhVy"}],"key":"sMHUPKnxwI"},{"type":"paragraph","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"children":[{"type":"text","value":"In the abstract, tracking units like this is useful in the same way that labelling dimensions with Xarray is useful: it helps us avoid errors by relieving us of the burden of remembering arbitrary information about our data.","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"IJm1WcwHXt"}],"key":"veHQug40BS"},{"type":"heading","depth":2,"position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"children":[{"type":"text","value":"Quantifying with pint-xarray","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"AyOFNEfEdU"}],"identifier":"quantifying-with-pint-xarray","label":"Quantifying with pint-xarray","html_id":"quantifying-with-pint-xarray","implicit":true,"key":"mdwgwHqC46"},{"type":"paragraph","position":{"start":{"line":148,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"The easiest way to create a unit-aware Xarray object is to use the helper package we made: ","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"WjlVbYimyc"},{"type":"link","url":"https://github.com/xarray-contrib/pint-xarray","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"text","value":"pint-xarray","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"CGO32XC9jL"}],"urlSource":"https://github.com/xarray-contrib/pint-xarray","error":true,"key":"Yt0P2SMPQv"},{"type":"text","value":".\nOnce you ","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"Ayq8lFYwje"},{"type":"inlineCode","value":"import pint_xarray","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"avAfyZOeC5"},{"type":"text","value":" you can access unit-related functionality via ","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"ik7Nnn19TC"},{"type":"inlineCode","value":".pint","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"oSPEDJmwWT"},{"type":"text","value":" on any ","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"FNZMU4o0HF"},{"type":"inlineCode","value":"DataArray","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"xutrcTCVvz"},{"type":"text","value":" or ","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"Pbxd84cGzL"},{"type":"inlineCode","value":"Dataset","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"CIGUebfG9O"},{"type":"text","value":" (this works via ","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"r9nUz6ArHL"},{"type":"link","url":"https://xarray.pydata.org/en/stable/internals/extending-xarray.html","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"children":[{"type":"text","value":"Xarray’s accessor interface","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"Pg9wPrvQUd"}],"urlSource":"https://xarray.pydata.org/en/stable/internals/extending-xarray.html","key":"hc1DWVw1Co"},{"type":"text","value":").","position":{"start":{"line":148,"column":1},"end":{"line":148,"column":1}},"key":"CzMCQAbItO"}],"key":"xGQN7Jf6Yv"},{"type":"paragraph","position":{"start":{"line":151,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"text","value":"Above we have seen examples of quantifying explicitly, where we specify the units in the call to ","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"lIbVKnGlqj"},{"type":"inlineCode","value":".quantify()","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"r1wZTyg2ii"},{"type":"text","value":".\nWe can do this for multiple variables too, and we can also pass ","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"vhVzdH1VP3"},{"type":"inlineCode","value":"pint.Unit","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"NN1dFYtffY"},{"type":"text","value":" instances:","position":{"start":{"line":151,"column":1},"end":{"line":151,"column":1}},"key":"pIHgZn0jgh"}],"key":"jD5liKHGoN"},{"type":"code","lang":"python","value":"ds = xr.Dataset({'a': 2, 'b': 10})\n\nds.pint.quantify({'a': 'kg',\n                  'b': pint.Unit('moles')})","position":{"start":{"line":154,"column":1},"end":{"line":159,"column":1}},"key":"ZkqDxjoj1w"},{"type":"code","lang":"","value":"Out:\n\u003cxarray.Dataset\u003e\nDimensions:  ()\nData variables:\n    a        int64 [kg] 2\n    b        int64 [mol] 10","position":{"start":{"line":161,"column":1},"end":{"line":168,"column":1}},"key":"ekCWRARTNA"},{"type":"paragraph","position":{"start":{"line":170,"column":1},"end":{"line":171,"column":1}},"children":[{"type":"text","value":"Alternatively, we can quantify from the object’s ","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"wk7lcooJFy"},{"type":"inlineCode","value":".attrs","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"NiroPTUM1X"},{"type":"text","value":", automatically reading the metadata which xarray objects carry around.\nIf nothing is passed to ","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"slFiO6zLTT"},{"type":"inlineCode","value":".quantify()","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"RSgQGqozfw"},{"type":"text","value":", it will attempt to parse the ","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"IUWxPf9lKz"},{"type":"inlineCode","value":".attrs['units']","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"xjg1C5KL7q"},{"type":"text","value":" entry for each data variable.","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"KHBSaApHZm"}],"key":"hOKjo7ARLm"},{"type":"paragraph","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"children":[{"type":"text","value":"This means that for scientific datasets which are stored as files with units in their attributes (which netCDF and Zarr can do for example), using Pint with Xarray becomes as simple as:","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"bY4oIAG9Yj"}],"key":"NCUyWpoV40"},{"type":"code","lang":"python","value":"import pint_xarray\n\nds = open_dataset(filepath).pint.quantify()","position":{"start":{"line":175,"column":1},"end":{"line":179,"column":1}},"key":"wxGSPce4Xs"},{"type":"heading","depth":2,"position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"children":[{"type":"text","value":"Dequantifying","position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"key":"MehGQkLGYZ"}],"identifier":"dequantifying","label":"Dequantifying","html_id":"dequantifying","implicit":true,"key":"cc1pHbYsPY"},{"type":"paragraph","position":{"start":{"line":183,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"To convert our pint arrays back into NumPy arrays, we can use ","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"ktcaYxaKaW"},{"type":"inlineCode","value":".dequantify","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"lKfhxahUeJ"},{"type":"text","value":".\nThis will strip the units from the arrays and replace them into the ","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"uNU5STjBes"},{"type":"inlineCode","value":".attrs['units']","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"GGZkEWBcRU"},{"type":"text","value":" of each variable.\nThis is useful when we want to save our data back to a file, as it means that the current units will be preserved in the attributes of a netCDF file (or Zarr store etc.), as long as we just do ","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"tj7P23J98o"},{"type":"inlineCode","value":"ds.pint.dequantify().to_netcdf(...)","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"c7BspcPWPS"},{"type":"text","value":".","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"otGlKe7UIZ"}],"key":"DIY4RIP5d1"},{"type":"heading","depth":2,"position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"children":[{"type":"text","value":"Dask integration","position":{"start":{"line":187,"column":1},"end":{"line":187,"column":1}},"key":"i7YHtZe2N5"}],"identifier":"dask-integration","label":"Dask integration","html_id":"dask-integration","implicit":true,"key":"hA8AJPUXsj"},{"type":"paragraph","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"children":[{"type":"text","value":"So Xarray can wrap Dask arrays, and now it can wrap Pint quantities… Can we use both together? Yes!","position":{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},"key":"sLTr6VOFrj"}],"key":"TpHATkFRsM"},{"type":"paragraph","position":{"start":{"line":191,"column":1},"end":{"line":193,"column":1}},"children":[{"type":"text","value":"You can get a unit-aware, Dask-backed array either by ","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"kEKr5S0wHh"},{"type":"inlineCode","value":".pint.quantify()","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"yDqoc8J0fN"},{"type":"text","value":"-ing a chunked array, or you can ","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"JO9IXR00aE"},{"type":"inlineCode","value":".pint.chunk()","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"k7e9ONAm7S"},{"type":"text","value":" a quantified array.\n(If you have Dask installed, then ","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"l63YpVl9SG"},{"type":"inlineCode","value":"open_dataset(f, chunks={}).pint.quantify()","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"g0noh0uVDR"},{"type":"text","value":" will already give you a Dask-backed, quantified array.)\nFrom there you can ","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"ItSmlWtff7"},{"type":"inlineCode","value":".compute()","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"Q3govFQ3OC"},{"type":"text","value":" the Dask-backed objects as normal, and the units will be retained.","position":{"start":{"line":191,"column":1},"end":{"line":191,"column":1}},"key":"KxFS0qJr7h"}],"key":"FifPLFfh4e"},{"type":"paragraph","position":{"start":{"line":195,"column":1},"end":{"line":196,"column":1}},"children":[{"type":"text","value":"(Under the hood we now have an ","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"I25aAwFtPg"},{"type":"inlineCode","value":"xarray.DataArray","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"OwBgIHnbUD"},{"type":"text","value":" wrapping a ","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"XyJhYSb0gT"},{"type":"inlineCode","value":"pint.Quantity","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"eU6etEPyYo"},{"type":"text","value":", which wraps a ","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"lsq1RMTOOl"},{"type":"inlineCode","value":"dask.array.Array","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"nqkmMIFPVK"},{"type":"text","value":", which wraps a ","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"LioSsIRi1m"},{"type":"inlineCode","value":"numpy.ndarray","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"up617Xcabo"},{"type":"text","value":".\nThis “multi-nested duck array” approach can be generalised to include other array libraries (e.g. ","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"MBf3Iq54Fz"},{"type":"inlineCode","value":"scipy.sparse","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"MCX1b2T77V"},{"type":"text","value":"), but requires ","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"tKpJQ9T4oo"},{"type":"link","url":"https://github.com/pydata/duck-array-discussion","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"text","value":"coordination","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"VlAIVvcLMJ"}],"urlSource":"https://github.com/pydata/duck-array-discussion","error":true,"key":"K29gkGvLNI"},{"type":"text","value":" between the maintainers of the libraries involved.)","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"pDlBpSLvCI"}],"key":"ssu48CuY0s"},{"type":"heading","depth":2,"position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"Unit-aware indexes","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"Dw5h0EkzO8"}],"identifier":"unit-aware-indexes","label":"Unit-aware indexes","html_id":"unit-aware-indexes","implicit":true,"key":"rioHxJI9j7"},{"type":"paragraph","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"children":[{"type":"text","value":"We would love to be able to promote Xarray indexes to Pint Quantities, as that would allow you to select data subsets in a unit-aware manner like:","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"fCY6r93UOi"}],"key":"AJ6XCYIUwL"},{"type":"code","lang":"python","value":"da = xr.DataArray(name='a', data=[0, 1, 2], dims='x', coords={'x': [1000, 2000, 3000]})\nda = da.pint.quantify({'a': 'Pa', 'x': 'm'})\n\nda.pint.sel(x=2 * 'km')","position":{"start":{"line":202,"column":1},"end":{"line":207,"column":1}},"key":"uigzfr5pni"},{"type":"paragraph","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"children":[{"type":"text","value":"Unfortunately this will not possible until the ongoing work to extend Xarray to support ","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"hxh9z2wCN4"},{"type":"link","url":"https://github.com/pydata/xarray/issues/1603","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"children":[{"type":"text","value":"explicit indexes","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"OYRahDdRFc"}],"urlSource":"https://github.com/pydata/xarray/issues/1603","data":{"kind":"issue","org":"pydata","repo":"xarray","issue_number":"1603"},"internal":false,"protocol":"github","key":"f7soJndrU3"},{"type":"text","value":" is complete.","position":{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},"key":"XFsN2y6WhH"}],"key":"jBhhCNwM7O"},{"type":"paragraph","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"In the meantime pint-xarray offers a workaround. If you tell ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"uf91MEzW9x"},{"type":"inlineCode","value":".quantify","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"hKIeHSI1OR"},{"type":"text","value":" the units you wish an index to have, it will store those in ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"pbmB5JA5wh"},{"type":"inlineCode","value":".attrs[\"units\"]","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"c98ZSLJuWE"},{"type":"text","value":" instead.","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"R2jxZPDmxF"}],"key":"MnpgBfgTiq"},{"type":"code","lang":"python","value":"time = xr.DataArray([0.1, 0.2, 0.3], dims='time')\ndistance = xr.DataArray(name='distance',\n                        data=[10, 20, 25],\n                        dims=['time'],\n                        coords={'time': time})\ndistance = distance.pint.quantify({'distance': 'metres',\n                                   'time': 'seconds'})\nprint(distance.coords['time'].attrs)","position":{"start":{"line":213,"column":1},"end":{"line":222,"column":1}},"key":"o1sjmem7IV"},{"type":"code","lang":"","value":"Out:\n{'units': \u003cUnit('second')\u003e}","position":{"start":{"line":224,"column":1},"end":{"line":227,"column":1}},"key":"KRt08mB6mS"},{"type":"paragraph","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"text","value":"This allows us to provide conveniently wrapped versions of common xarray methods like ","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"psSHqEuzJ7"},{"type":"inlineCode","value":".sel","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"vhgMOabun1"},{"type":"text","value":", so that you can still select subsets of data in a unit-aware fashion like this:","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"hMVg0ftwoJ"}],"key":"oSvooaI4iB"},{"type":"code","lang":"python","value":"distance.pint.sel(time=200 * pint.Unit('milliseconds'))","position":{"start":{"line":231,"column":1},"end":{"line":233,"column":1}},"key":"M7B1GCerhu"},{"type":"code","lang":"","value":"Out:\n\u003cxarray.DataArray 'distance' ()\u003e\n\u003cQuantity(20, 'meter')\u003e\nCoordinates:\n    time     float64 200.0","position":{"start":{"line":235,"column":1},"end":{"line":241,"column":1}},"key":"riJ8pelvus"},{"type":"paragraph","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"Observe how the ","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"BdOHyZw02z"},{"type":"inlineCode","value":".pint.sel","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"cert1L56Mw"},{"type":"text","value":" operation has first converted 200 milliseconds to 0.2 seconds, before finding the distance value that occurs at a time position of 0.2 seconds.","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"TDxMBedTQT"}],"key":"mpKVgSCXP7"},{"type":"paragraph","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"children":[{"type":"link","url":"https://xarray.pydata.org/en/stable/user-guide/duckarrays.html#missing-features","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"children":[{"type":"text","value":"This wrapping is currently necessary","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"RWVYN3ohWZ"}],"urlSource":"https://xarray.pydata.org/en/stable/user-guide/duckarrays.html#missing-features","key":"BdhJtpNnAW"},{"type":"text","value":" for any operation which needs to be aware of the units of a dimension coordinate of the dataarray, or any xarray operation which relies on an external library (such as calling ","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"j0o6u8qRrm"},{"type":"inlineCode","value":"scipy","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"BBxxdf5hxZ"},{"type":"text","value":" in ","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"AxmXOhmGjA"},{"type":"inlineCode","value":".integrate","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"f0IGlPQV29"},{"type":"text","value":").","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"EOc34ANv6Z"}],"key":"FDEl4I2gZT"},{"type":"heading","depth":2,"position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"children":[{"type":"text","value":"CF-compliant units for geosciences with cf-xarray","position":{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},"key":"uzOECZFpDd"}],"identifier":"cf-compliant-units-for-geosciences-with-cf-xarray","label":"CF-compliant units for geosciences with cf-xarray","html_id":"cf-compliant-units-for-geosciences-with-cf-xarray","implicit":true,"key":"RcLCpHEdZG"},{"type":"paragraph","position":{"start":{"line":249,"column":1},"end":{"line":251,"column":1}},"children":[{"type":"text","value":"Different fields tend to have different niche conventions about how certain units are defined.\nBy default, Pint doesn’t understand all the unusual units and conventions we use in geosciences.\nBut ","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"DrtUILqBHy"},{"type":"link","url":"https://pint.readthedocs.io/en/stable/defining.html","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"Pint is customisable","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"nej9dEyuNd"}],"urlSource":"https://pint.readthedocs.io/en/stable/defining.html","key":"bKTLqcoLWp"},{"type":"text","value":", and with the help of ","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"w97nrxnOxA"},{"type":"link","url":"https://github.com/xarray-contrib/cf-xarray","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"cf-xarray","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"fQipc3SCNH"}],"urlSource":"https://github.com/xarray-contrib/cf-xarray","error":true,"key":"uIuuNgLebJ"},{"type":"text","value":" we can teach it about these geoscience-specific units.","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"fZIEgjI8xT"}],"key":"AgVpsIw4rR"},{"type":"paragraph","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"text","value":"If we ","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"wG0pLkFsvd"},{"type":"inlineCode","value":"import cf_xarray.units","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"PuDDBraEe7"},{"type":"text","value":" (before ","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"YST3LXiGRd"},{"type":"inlineCode","value":"import pint_xarray","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"h8gQIsAIrG"},{"type":"text","value":") then we can ","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"oxTW3C07DJ"},{"type":"inlineCode","value":"quantify","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"mWpfym5otY"},{"type":"text","value":" example climate data from the ","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"YH9Ao2CKIq"},{"type":"link","url":"https://pangeo-data.github.io/pangeo-cmip6-cloud/","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"children":[{"type":"text","value":"Pangeo Project’s CMIP6 catalog","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"N5eWsmg8bf"}],"urlSource":"https://pangeo-data.github.io/pangeo-cmip6-cloud/","key":"bxciWuZ6Pk"},{"type":"text","value":":","position":{"start":{"line":253,"column":1},"end":{"line":253,"column":1}},"key":"RtPm60N3Kz"}],"key":"Ij6oEuGVlC"},{"type":"code","lang":"python","value":"import xarray as xr\nimport cf_xarray.units\nimport pint_xarray\n\nds = xr.open_dataset('gs://cmip6/CMIP6/CMIP/NCAR/CESM2-FV2/historical/r2i1p1f1/Amon/sfcWind/gn/v20200226/', engine='zarr')\nds = ds.pint.quantify()\n\nsquared_wind = ds['sfcWind'] ** 2\nsquared_wind.pint.units","position":{"start":{"line":255,"column":1},"end":{"line":265,"column":1}},"key":"g2929gQXVN"},{"type":"code","lang":"","value":"Out:\n\u003cUnit('meter ** 2 / second ** 2')\u003e","position":{"start":{"line":267,"column":1},"end":{"line":270,"column":1}},"key":"lJH66RS6C2"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"Here (thanks to ","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"S3NxOavyss"},{"type":"inlineCode","value":"cf_xarray","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"t8PATQLYfb"},{"type":"text","value":") pint has successfully interpreted the CF-style units ","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"jn83DeHf47"},{"type":"inlineCode","value":"'m s-1'","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"v9IiNP5Uho"},{"type":"text","value":", then automatically changed them when we squared the wind speed.","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"Fv7JkKePUM"}],"key":"dkeSB1wEyx"},{"type":"heading","depth":2,"position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"children":[{"type":"text","value":"Plotting","position":{"start":{"line":274,"column":1},"end":{"line":274,"column":1}},"key":"g00uuc5YhT"}],"identifier":"plotting","label":"Plotting","html_id":"plotting","implicit":true,"key":"N4BebBWup0"},{"type":"paragraph","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"children":[{"type":"text","value":"We can complete our real-world example by plotting the data in its new units:","position":{"start":{"line":276,"column":1},"end":{"line":276,"column":1}},"key":"CL5D2YScjq"}],"key":"tS1UH63lou"},{"type":"code","lang":"python","value":"import cartopy.crs as ccrs\nimport matplotlib.pyplot as plt\n\np = squared_wind.isel(time=\"2014-01\").plot(\n    subplot_kws=dict(projection=ccrs.Orthographic(-80, 35), facecolor=\"gray\"),\n    transform=ccrs.PlateCarree(),\n)\np.axes.set_global()\np.axes.coastlines()\nplt.show()","position":{"start":{"line":278,"column":1},"end":{"line":289,"column":1}},"key":"rEXTVWwKm1"},{"type":"image","url":"/build/squared_wind-1da222802a48a2daa9fe78238303300a.png","alt":"cartopy plot of a quantified dataset","position":{"start":{"line":291,"column":1},"end":{"line":291,"column":1}},"key":"zaqWFa03fp","urlSource":"/images/squared_wind.png"},{"type":"paragraph","position":{"start":{"line":293,"column":1},"end":{"line":293,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":293,"column":1},"end":{"line":293,"column":1}},"key":"sWMSy6LwKu"},{"type":"inlineCode","value":"xarray.plot","position":{"start":{"line":293,"column":1},"end":{"line":293,"column":1}},"key":"BzE8AXAiA1"},{"type":"text","value":" has detected the Pint units automatically.","position":{"start":{"line":293,"column":1},"end":{"line":293,"column":1}},"key":"yaOZukubvx"}],"key":"RIopINWgHM"},{"type":"heading","depth":2,"position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"children":[{"type":"text","value":"Conclusion","position":{"start":{"line":295,"column":1},"end":{"line":295,"column":1}},"key":"Hh7bWHbxJJ"}],"identifier":"conclusion","label":"Conclusion","html_id":"conclusion","implicit":true,"key":"tIJ8uKs936"},{"type":"paragraph","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"children":[{"type":"text","value":"Please have a go! You will need xarray (v2022.03.0+), pint (0.18+), and pint-xarray (0.3+).","position":{"start":{"line":297,"column":1},"end":{"line":297,"column":1}},"key":"AXgHjwCZWd"}],"key":"sa0ooKKhP3"},{"type":"paragraph","position":{"start":{"line":299,"column":1},"end":{"line":300,"column":1}},"children":[{"type":"text","value":"Please also tell us about any bugs you find, or documentation suggestions you have on the ","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"QtowDL4PrA"},{"type":"link","url":"https://github.com/pydata/xarray/issues","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"Xarray","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"OhX1BHxROc"}],"urlSource":"https://github.com/pydata/xarray/issues","error":true,"key":"lDdxI5PN48"},{"type":"text","value":" or ","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"DLIj1xawyt"},{"type":"link","url":"https://github.com/xarray-contrib/pint-xarray/issues","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"pint-xarray issue trackers","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"CPsgiTpVEY"}],"urlSource":"https://github.com/xarray-contrib/pint-xarray/issues","error":true,"key":"Y0yiDdBeaY"},{"type":"text","value":".\nIf you have usage questions you can raise them there, on the ","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"gxevQ55mBU"},{"type":"link","url":"https://github.com/pydata/xarray/discussions","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"Xarray discussions page","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"sFlMd9As7T"}],"urlSource":"https://github.com/pydata/xarray/discussions","error":true,"key":"UFTIBJenRv"},{"type":"text","value":", or on the ","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"lw5aG1K79Q"},{"type":"link","url":"https://discourse.pangeo.io/","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"children":[{"type":"text","value":"Pangeo Discourse forum","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"nTnediVG1r"}],"urlSource":"https://discourse.pangeo.io/","key":"VAEz88Ye1G"},{"type":"text","value":".","position":{"start":{"line":299,"column":1},"end":{"line":299,"column":1}},"key":"ohGsenHtsa"}],"key":"XddyBNDwYg"},{"type":"paragraph","position":{"start":{"line":302,"column":1},"end":{"line":303,"column":1}},"children":[{"type":"text","value":"The work here to allow Xarray to wrap Pint objects is part of a ","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"yKaDW7mzYI"},{"type":"link","url":"http://xarray.pydata.org/en/stable/roadmap.html#flexible-arrays","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"children":[{"type":"text","value":"broader effort to generalise Xarray","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"FWdOHcV9nK"}],"urlSource":"http://xarray.pydata.org/en/stable/roadmap.html#flexible-arrays","key":"wHkbVZ5g4u"},{"type":"text","value":" to handle a wide variety of data types (so-called “duck array wrapping”).\nAlong with the incoming ","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"TjiyFaNt20"},{"type":"link","url":"http://xarray.pydata.org/en/stable/roadmap.html#flexible-indexes","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"children":[{"type":"text","value":"support for flexible indexes","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"xh2oaCytBm"}],"urlSource":"http://xarray.pydata.org/en/stable/roadmap.html#flexible-indexes","key":"FqoSJcnlZb"},{"type":"text","value":", we are excited for all the new features that this will enable for Xarray users!","position":{"start":{"line":302,"column":1},"end":{"line":302,"column":1}},"key":"Qk6kRMWn0f"}],"key":"UICXnY1kzG"}],"key":"mZQCVhGDYc"}],"key":"B6STj4coYu"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Easy IPCC part 1: Multi-Model Datatree","url":"/blog/2022/easy-ipcc-datatree","group":"2022"},"next":{"title":"Coronavirus: The Simplest Model","url":"/blog/2020/covid19-model","group":"2020"}}},"domain":"http://localhost:3000"},"project":{"abbreviations":{"LF":"The Linux Foundation","JF":"The Jupyter Foundation","JEC":"Jupyter Executive Council","JFB":"The Jupyter Foundation Board","SSC":"Software Steering Council","OSPO":"Open Source Program Office"},"title":"Welcome","thumbnail":"/build/profile-color-circle-17a434cb07f7c7cd017474554e1c5699.png","authors":[{"id":"tom","nameParsed":{"literal":"Tom Nicholas","given":"Tom","family":"Nicholas"},"name":"Tom Nicholas","orcid":"0000-0002-2176-0530","github":"TomNicholas","url":"https://tom-nicholas.com"}],"github":"https://github.com/TomNicholas/tomnicholas.github.io","references":{"ttw":{"url":"https://book.the-turing-way.org"}},"toc":[{"file":"index.md"},{"file":"about.md"},{"file":"talks.md"},{"children":[{"children":[{"pattern":"blog/2025/**{.ipynb,.md}"}],"title":"2025"},{"children":[{"pattern":"blog/2024/**{.ipynb,.md}"}],"title":"2024"},{"children":[{"pattern":"blog/2023/**{.ipynb,.md}"}],"title":"2023"},{"children":[{"pattern":"blog/2022/**{.ipynb,.md}"}],"title":"2022"},{"children":[{"pattern":"blog/2020/**{.ipynb,.md}"}],"title":"2020"},{"children":[{"pattern":"blog/2019/**{.ipynb,.md}"}],"title":"2019"}],"file":"blog.md"}],"exports":[],"bibliography":[],"index":"index","pages":[{"slug":"about","title":"About me","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"talks","title":"Talks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"slug":"blog","title":"Blog","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":1},{"level":2,"title":"2025"},{"slug":"blog.2025.cloud-optimized-scientific-data","title":"Fundamentals: What is Cloud-Optimized Scientific Data?","description":"The article I wish I could have read back when I first heard of Zarr in 2018. Explains how object storage and conventional filesystems are different, and the key properties that make Zarr work so well in cloud object storage.\n","date":"2025-04-17","thumbnail":"/build/hdf5-layout-2c4216e4d2a574ec9b58200559b84bb9.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["cloud","zarr","netcdf","earthmover","open-science"],"level":3},{"slug":"blog.2025.science-needs-a-social-network","title":"Science needs a social network for sharing big data","description":"Imagine being able to visit one website, search for any scientific dataset from any institution in the world, preview it, then stream the data out at high speed, in the format you prefer. We have the technology - here's what we should build.\n","date":"2025-01-18","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["open-science","frost"],"level":3},{"level":2,"title":"2024"},{"slug":"blog.2024.datatree","title":"Xarray x NASA: xarray.DataTree for hierarchical data structures","description":"How xarray's new DataTree feature came about, and thoughts on how public agencies can support the open-source scientific software that they depend on.\n","date":"2024-12-19","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science"],"level":3},{"level":2,"title":"2023"},{"slug":"blog.2023.cubed-xarray","title":"Cubed: Bounded-memory serverless array processing in xarray","description":"Cubed was designed to address the main problems with Dask, so I integrated it with Xarray. \n","date":"2023-06-01","thumbnail":"/build/e35ec725ea00fd2a6250d35dd849930e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","dask","cubed","open-science"],"level":3},{"slug":"blog.2023.dask-distributed","title":"Dask.distributed and Pangeo: Better performance for everyone thanks to science / software collaboration","description":"Dask's distributed scheduler algorithm got a major fix after we tested its' limits on a huge oceanography analysis problem.\n","date":"2023-01-04","thumbnail":"/build/f8821db67c2a5f1f07b570e6bed342cc.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","dask","open-science"],"level":3},{"level":2,"title":"2022"},{"slug":"blog.2022.easy-ipcc-datatree","title":"Easy IPCC part 1: Multi-Model Datatree","description":"Analysing CMPI6 data as a motivation for xarray DataTree.\n","date":"2022-08-29","thumbnail":"/build/d1061528b3e546e0e4d674dab265d6e2.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","open-science","climate-science","datatree"],"level":3},{"slug":"blog.2022.pint-xarray","title":"Unit-aware arithmetic in Xarray, via pint","description":"All scientific computations involve units, so let's make our analysis software aware of them.\n","date":"2022-08-30","thumbnail":"/build/df49524368335f9010ca432f9849200d.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","xarray","pint","open-science","physical-units"],"level":3},{"level":2,"title":"2020"},{"slug":"blog.2020.covid19-model","title":"Coronavirus: The Simplest Model","description":"Solving the simplest possible epidemiological model of the spread of COVID-19.\n","date":"2020-03-20","thumbnail":"/build/SIRD_states-f8d070ce0279e9fd952cd6c245e75350.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["code","python","modelling","covid-19"],"level":3},{"slug":"blog.2020.deep-pseudoscience","title":"The faulty science, doomism, and flawed conclusions of Deep Adaptation","description":"Calling out pseudoscience claiming that societal collapse due to climate change is inevitable. \n","date":"2020-07-14","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate-science","misinformation"],"level":3},{"slug":"blog.2020.oxford-divests","title":"Oxford University Divestment Explained","description":"Thought's on Oxford University's fossil fuel divestment motion.\n","date":"2020-04-22","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["climate","oxford"],"level":3},{"level":2,"title":"2019"},{"slug":"blog.2019.theconversation-fusion","title":"Nuclear Fusion: too late for the climate","description":"Don't let politicians use funding for nuclear fusion research as greenwashing.\n","date":"2019-09-30","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["fusion","energy","climate"],"level":3}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/build/manifest-B4831781.js";
import * as route0 from "/build/root-QGLRP2PL.js";
import * as route1 from "/build/routes/$-7JYT5576.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/build/entry.client-UNPC4GT3.js");</script></body></html>